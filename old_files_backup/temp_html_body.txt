</head>
<body>
    <div class="admin-container">
        <!-- 사이드바 -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>관리자 시스템</h2>
                <p>다함식단관리</p>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="icon">📊</span>대시보드
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <span class="icon">👥</span>사용자 관리
                </a>
                <a href="#" class="nav-item" data-page="suppliers">
                    <span class="icon">🚛</span>협력업체 관리
                </a>
                <a href="#" class="nav-item" data-page="business-locations">
                    <span class="icon">🏢</span>사업장 관리
                </a>
                <a href="#" class="nav-item" data-page="supplier-mapping">
                    <span class="icon">🔗</span>매핑 관리
                </a>
                <a href="#" class="nav-item" data-page="meal-pricing" onclick="showMealPricingPage()">
                    <span class="icon">💰</span>식단가 관리
                </a>
                <a href="#" class="nav-item" data-page="ingredients">
                    <span class="icon">📦</span>식자재 관리
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <span class="icon">⚙️</span>시스템 설정
                </a>
                <a href="#" class="nav-item" data-page="logs">
                    <span class="icon">📋</span>로그 관리
                </a>
                
                <!-- 하단 네비게이션 버튼들 -->
                <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid #ddd;">
                    <a href="/" class="nav-item" style="background: #e8f5e8; color: #4caf50;">
                        <span class="icon">🍽️</span>급식관리로 이동
                    </a>
                </div>
            </div>
        </nav>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 헤더 -->
            <div class="header">
                <div class="header-info">
                    <div>
                        <h1 id="page-title">관리자 대시보드</h1>
                        <div class="user-info">
                            관리자님, 안녕하세요! | 마지막 접속: 2025-08-30 12:00
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">로그아웃</button>
                </div>
            </div>

            <!-- 대시보드 페이지 -->
            <div id="dashboard-page" class="page-content">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">👥</span>
                            <span class="card-title">전체 사용자</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="total-users">-</div>
                            <div class="stat-label">활성 사용자</div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">🏢</span>
                            <span class="card-title">사업장 수</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="total-sites">-</div>
                            <div class="stat-label">등록된 사업장</div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">📋</span>
                            <span class="card-title">오늘의 식단</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="today-menus">-</div>
                            <div class="stat-label">오늘 편성된 식단</div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">💰</span>
                            <span class="card-title">단가 업데이트</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="price-updates">-</div>
                            <div class="stat-label">최근 7일간 업데이트</div>
                        </div>
                    </div>
                </div>

                <!-- 최근 활동 로그 -->
                <div class="activity-log">
                    <div class="card-header">
                        <span class="icon">📋</span>
                        <span class="card-title">최근 활동</span>
                    </div>
                    <div id="activity-list">
                        <!-- 동적으로 로드될 활동 로그 -->
                    </div>
                </div>
            </div>

            <!-- 다른 페이지들은 hidden 상태로 시작 -->
            <div id="users-page" class="page-content hidden">
                <!-- 사용자 관리 헤더 -->
                <div class="page-header">
                    <div class="header-actions">
                        <div class="search-box">
                            <input type="text" id="user-search" placeholder="사용자 검색 (이름, 아이디, 부서)">
                            <button onclick="searchUsers()">🔍</button>
                        </div>
                        <button class="btn-primary" onclick="showAddUserModal()">+ 새 사용자</button>
                        <button class="btn-secondary" onclick="initUserExtensions()" style="background: #17a2b8; margin-left: 10px;">⚙️ 기능 확장</button>
                    </div>
                </div>

                <!-- 사용자 목록 테이블 -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>사용자명</th>
                                <th>역할</th>
                                <th>부서</th>
                                <th>전화번호</th>
                                <th>담당 사업장</th>
                                <th>접근 사업장</th>
                                <th>상태</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- 동적으로 로드될 사용자 목록 -->
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination">
                    <button onclick="changePage(-1)">이전</button>
                    <span id="page-info">1 / 1</span>
                    <button onclick="changePage(1)">다음</button>
                </div>
            </div>

            <!-- 업체 추가/수정 모달 -->
            <div id="supplier-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="supplier-modal-title">새 업체 등록</h3>
                        <button class="close-btn" onclick="closeSupplierModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="supplier-form">
                            <input type="hidden" id="supplier-id">
                            
                            <div class="form-group">
                                <label>협력업체명 <span style="color: red;">*</span></label>
                                <input type="text" id="supplier-name" required placeholder="예: CJ프레시웨이, 웰스토리">
                            </div>

                            <div class="form-group">
                                <label>대표자</label>
                                <input type="text" id="supplier-representative" placeholder="대표자명을 입력하세요">
                            </div>

                            <div class="form-group">
                                <label>담당자</label>
                                <input type="text" id="supplier-contact" placeholder="담당자명을 입력하세요">
                            </div>

                            <div class="form-group">
                                <label>팩스번호</label>
                                <input type="text" id="supplier-fax" placeholder="예: 02-1234-5679">
                            </div>

                            <div class="form-group">
                                <label>이메일</label>
                                <input type="email" id="supplier-email" placeholder="예: contact@company.com">
                            </div>

                            <div class="form-group">
                                <label>사업자번호</label>
                                <input type="text" id="supplier-business-number" placeholder="예: 123-45-67890">
                            </div>

                            <div class="form-group">
                                <label>업목</label>
                                <input type="text" id="supplier-business-item" placeholder="주요 취급 품목">
                            </div>

                            <div class="form-group">
                                <label>담당자 연락처</label>
                                <input type="text" id="supplier-manager-name" placeholder="담당자명">
                            </div>

                            <div class="form-group">
                                <label>담당자 전화번호</label>
                                <input type="text" id="supplier-manager-phone" placeholder="담당자 전화번호">
                            </div>
                            
                            <div class="form-group">
                                <label>업체코드 (모코드)</label>
                                <input type="text" id="supplier-parent-code" maxlength="10" placeholder="예: CJ001, 웰스토리001">
                                <small class="form-hint">협력업체에서 부여한 고유코드</small>
                            </div>

                            <div class="form-group">
                                <label>사업장코드</label>
                                <input type="text" id="supplier-site-code" maxlength="20" placeholder="사업장 고유코드">
                            </div>

                            <div class="form-group">
                                <label>사업장명</label>
                                <input type="text" id="supplier-site-name" placeholder="사업장명을 입력하세요">
                            </div>
                            
                            <div class="form-group">
                                <label>업체 유형</label>
                                <select id="supplier-business-type">
                                    <option value="">유형을 선택하세요</option>
                                    <option value="식자재납품">식자재 납품업체</option>
                                    <option value="서비스">서비스 업체</option>
                                    <option value="장비">장비/시설 업체</option>
                                    <option value="기타">기타</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>연락처</label>
                                <input type="text" id="supplier-phone" placeholder="예: 02-1234-5678">
                            </div>
                            
                            <div class="form-group">
                                <label>주소</label>
                                <textarea id="supplier-address" rows="2" placeholder="업체 주소를 입력하세요"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>업데이트 주기</label>
                                <select id="supplier-update-frequency">
                                    <option value="daily">매일</option>
                                    <option value="weekly" selected>주간</option>
                                    <option value="monthly">월간</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="supplier-is-active" checked>
                                    활성 상태
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>비고</label>
                                <textarea id="supplier-notes" rows="2" placeholder="특이사항이나 메모를 입력하세요"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeSupplierModal()">취소</button>
                        <button type="button" class="btn-primary" onclick="saveSupplier()">저장</button>
                    </div>
                </div>
            </div>

            <!-- 사용자 추가/수정 모달 -->
            <div id="user-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-title">새 사용자 추가</h3>
                        <button class="modal-close" onclick="closeUserModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="user-form">
                            <div class="form-group">
                                <label>사용자 ID</label>
                                <input type="text" id="user-username" required>
                            </div>
                            <div class="form-group">
                                <label>비밀번호</label>
                                <input type="password" id="user-password">
                                <small>수정 시 비워두면 변경하지 않음</small>
                            </div>
                            <div class="form-group">
                                <label>역할</label>
                                <select id="user-role" required>
                                    <option value="">선택하세요</option>
                                    <option value="nutritionist">영양사</option>
                                    <option value="admin">관리자</option>
                                    <option value="super_admin">최고관리자</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>연락처</label>
                                <input type="text" id="user-contact">
                            </div>
                            <div class="form-group">
                                <label>부서</label>
                                <input type="text" id="user-department">
                            </div>
                            <div class="form-group">
                                <label>직책</label>
                                <input type="text" id="user-position">
                            </div>
                            <div class="form-group">
                                <label>담당 사업장</label>
                                <select id="user-managed-site">
                                    <option value="">선택하세요</option>
                                    <!-- 동적으로 로드될 사업장 목록 -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>전화번호</label>
                                <input type="tel" id="user-phone" placeholder="010-1234-5678">
                            </div>
                            <div class="form-group">
                                <label>생년월일</label>
                                <input type="date" id="user-birth-date">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="user-is-active" checked>
                                    활성 상태
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="user-operator">
                                    운영자 권한
                                </label>
                            </div>
                            <div class="form-group">
                                <label>접근 가능한 사업장</label>
                                <div id="user-sites-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
                                    <label class="checkbox-label" style="margin-bottom: 10px;">
                                        <input type="checkbox" id="sites-all" onchange="toggleAllSites(this)">
                                        <strong>모든 사업장</strong>
                                    </label>
                                    <div id="sites-list">
                                        <!-- 동적으로 로드될 사업장 체크박스 목록 -->
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="user-semi-operator">
                                    부운영자 권한
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeUserModal()">취소</button>
                        <button type="button" class="btn-primary" onclick="saveUser()">저장</button>
                    </div>
                </div>
            </div>

            <!-- 업체 관리 페이지 -->
            <div id="suppliers-page" class="page-content hidden">
                <!-- 업체 관리 헤더 -->
                <div class="page-header">
                    <div class="header-actions">
                        <div class="search-box">
                            <input type="text" id="supplier-search" placeholder="업체명, 연락처, 이메일로 검색...">
                            <select id="supplier-status-filter" style="margin-left: 10px;">
                                <option value="">전체 상태</option>
                                <option value="1">거래중</option>
                                <option value="0">거래중단</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="showAddSupplierModal()">+ 새 업체 등록</button>
                        <button class="btn-secondary" onclick="initSupplierExtensions()" style="background: #17a2b8; margin-left: 10px;" title="데이터베이스에 새로운 필드를 추가하여 업체 관리 기능을 확장합니다">⚙️ DB 확장</button>
                    </div>
                </div>

                <!-- 업체 목록 테이블 -->
                <div class="content-section">
                    <table id="suppliers-table" class="data-table">
                        <thead>
                            <tr>
                                <th>모코드</th>
                                <th>사업장코드</th>
                                <th>사업장명</th>
                                <th>업체명</th>
                                <th>연락처</th>
                                <th>이메일</th>
                                <th>거래상태</th>
                                <th>사업자번호</th>
                                <th>대표자</th>
                                <th>담당자</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="suppliers-table-body">
                            <tr>
                                <td colspan="11" class="loading">업체 데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="business-locations-page" class="page-content hidden">
                <!-- 사업장 관리 - 완전한 기능으로 연결 -->
                <div style="text-align: center; padding: 50px;">
                    <h2>🏢 사업장 관리</h2>
                    <p style="margin: 20px 0; color: #666;">완전한 사업장 관리 기능을 사용하려면 아래 버튼을 클릭하세요.</p>
                    <button onclick="window.open('/admin/business-locations', '_blank')" 
                            style="padding: 15px 30px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px;">
                        <i class="fas fa-external-link-alt"></i> 사업장 관리 페이지 열기
                    </button>
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; max-width: 600px; margin: 30px auto;">
                        <h3 style="color: #333; margin-bottom: 15px;">🌟 주요 기능</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                            <div>✅ 사업장 등록 및 관리</div>
                            <div>✅ 구분별/유형별 필터링</div>
                            <div>✅ 협력업체 매핑</div>
                            <div>✅ 엑셀 내보내기</div>
                            <div>✅ 실시간 통계</div>
                            <div>✅ 검색 및 정렬</div>
                        </div>
                    </div>
                    <p style="margin-top: 20px; font-size: 14px; color: #888;">
                        향후 업데이트에서 이 페이지에 직접 통합될 예정입니다.
                    </p>
                </div>
            </div>

            <div id="supplier-mapping-page" class="page-content hidden">
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2>🔗 사업장-협력업체 매핑 관리</h2>
                        <button onclick="openMappingModal()" class="btn-primary">
                            <i class="fas fa-plus"></i> 새 매핑 추가
                        </button>
                    </div>

                    <!-- 필터 섹션 -->
                    <div class="filter-section" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end;">
                            <div class="form-group" style="margin: 0;">
                                <label>사업장 필터</label>
                                <select id="mapping-customer-filter" onchange="filterMappings()">
                                    <option value="">전체 사업장</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label>협력업체 필터</label>
                                <select id="mapping-supplier-filter" onchange="filterMappings()">
                                    <option value="">전체 협력업체</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label>상태 필터</label>
                                <select id="mapping-status-filter" onchange="filterMappings()">
                                    <option value="">전체 상태</option>
                                    <option value="true">활성</option>
                                    <option value="false">비활성</option>
                                </select>
                            </div>
                            <div>
                                <button onclick="clearMappingFilters()" class="btn-secondary">필터 초기화</button>
                            </div>
                        </div>
                    </div>

                    <!-- 매핑 테이블 -->
                    <div class="table-container" style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>사업장</th>
                                    <th>사업장코드</th>
                                    <th>사업장상태</th>
                                    <th>협력업체</th>
                                    <th>업체코드</th>
                                    <th>배송코드</th>
                                    <th>우선순위</th>
                                    <th>주요업체</th>
                                    <th>계약시작</th>
                                    <th>계약종료</th>
                                    <th>매핑상태</th>
                                    <th>사업장관리</th>
                                    <th>매핑관리</th>
                                </tr>
                            </thead>
                            <tbody id="mappings-table-body">
                                <tr>
                                    <td colspan="14" class="loading">매핑 데이터를 불러오는 중...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 통계 섹션 -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                        <div class="stat-card">
                            <h3>총 매핑</h3>
                            <div class="stat-value" id="total-mappings">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>활성 매핑</h3>
                            <div class="stat-value" id="active-mappings">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>매핑된 사업장</h3>
                            <div class="stat-value" id="mapped-customers">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>매핑된 협력업체</h3>
                            <div class="stat-value" id="mapped-suppliers">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 사업장 추가/수정 모달 -->
            <div id="site-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="site-modal-title">새 사업장 추가</h3>
                        <button class="modal-close" onclick="closeSiteModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="site-form">
                            <input type="hidden" id="site-parent-id">
                            
                            <div class="form-group">
                                <label>사업장명</label>
                                <input type="text" id="site-name" required>
                            </div>
                            
                            <div class="form-group">
                                <label>구분</label>
                                <select id="site-type" required>
                                    <option value="">선택하세요</option>
                                    <option value="도시락">도시락</option>
                                    <option value="운반">운반</option>
                                    <option value="학교">학교</option>
                                    <option value="요양원">요양원</option>
                                    <option value="위탁">위탁</option>
                                    <option value="일반음식점">일반음식점</option>
                                    <option value="기타">기타</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>담당자</label>
                                <input type="text" id="site-contact-person">
                            </div>
                            
                            <div class="form-group">
                                <label>연락처</label>
                                <input type="text" id="site-contact-phone">
                            </div>
                            
                            <div class="form-group">
                                <label>주소</label>
                                <textarea id="site-address" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>1인당 제공량 (g)</label>
                                <input type="number" id="site-portion-size" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label>설명</label>
                                <textarea id="site-description" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="site-is-active" checked>
                                    활성 상태
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeSiteModal()">취소</button>
                        <button type="button" class="btn-primary" onclick="saveSite()">저장</button>
                    </div>
                </div>
            </div>

            <!-- 매핑 추가/수정 모달 -->
            <div id="mapping-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="mapping-modal-title">새 매핑 추가</h3>
                        <button class="modal-close" onclick="closeMappingModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="mapping-form">
                            <input type="hidden" id="mapping-id">
                            
                            <!-- 사업장 선택 (공통) -->
                            <div class="form-group">
                                <label>사업장 선택 <span style="color: red;">*</span></label>
                                <select id="mapping-customer" required>
                                    <option value="">사업장을 선택하세요</option>
                                </select>
                            </div>
                            
                            <!-- 협력업체 매핑 목록 -->
                            <div class="form-group">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <label>협력업체 매핑 <span style="color: red;">*</span></label>
                                    <button type="button" class="btn-add" onclick="addSupplierRow()" title="협력업체 추가">
                                        <i class="fas fa-plus"></i> 협력업체 추가
                                    </button>
                                </div>
                                
                                <div class="supplier-mapping-container" style="border: 1px solid #ddd; border-radius: 5px; padding: 10px; max-height: 400px; overflow-y: auto;">
                                    <div id="supplier-rows-container">
                                        <!-- 첫 번째 행은 JavaScript로 추가됨 -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 공통 설정 -->
                            <div class="form-group">
                                <label>계약 기간 (모든 협력업체에 공통 적용)</label>
                                <div style="display: flex; gap: 10px;">
                                    <div style="flex: 1;">
                                        <label style="font-size: 12px; color: #666;">시작일</label>
                                        <input type="date" id="mapping-contract-start" style="width: 100%;">
                                    </div>
                                    <div style="flex: 1;">
                                        <label style="font-size: 12px; color: #666;">종료일</label>
                                        <input type="date" id="mapping-contract-end" style="width: 100%;">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>특이사항 (모든 협력업체에 공통 적용)</label>
                                <textarea id="mapping-notes" rows="3" placeholder="계약 조건, 특이사항 등을 입력하세요"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeMappingModal()">취소</button>
                        <button type="button" class="btn-primary" onclick="saveMapping()">저장</button>
                    </div>
                </div>
            </div>


            <!-- 식자재/업체 관리 페이지 -->
            <div id="ingredients-page" class="page-content hidden">
                <div class="page-header">
                    <h2>식자재/업체 관리</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showUploadSection()">
                            <span class="icon">📁</span>파일 업로드
                        </button>
                        <button class="btn btn-secondary" onclick="downloadTemplate()">
                            <span class="icon">📋</span>양식 다운로드
                        </button>
                        <button class="btn btn-secondary" onclick="initSupplierExtensions()" style="background: #17a2b8; margin-left: 10px;">
                            <span class="icon">⚙️</span>업체 관리 확장
                        </button>
                    </div>
                </div>
                
                <!-- 탭 메뉴 -->
                <div class="tab-menu" style="display: flex; margin: 20px 0; border-bottom: 1px solid #ddd;">
                    <button class="tab-button active" onclick="showIngredientTab()" style="padding: 10px 20px; border: none; background: #f8f9fa; cursor: pointer; border-bottom: 2px solid #007bff;">
                        <span class="icon">🥬</span>식자재 관리
                    </button>
                </div>

                <!-- 식자재 관리 탭 -->
                <div id="ingredient-tab-content" class="tab-content">
                    <!-- 업로드 주의사항 -->
                    <div class="upload-notice">
                    <h3>📋 엑셀파일 수정 주의사항!</h3>
                    <div class="notice-content">
                        <p>식자재 등록을 위한 다운로드 양식 및 각 식자재 정보본판만 복사해서 붙여넣기만 합니다. 아래 주의사항 꼭 준수하세요.</p>
                        
                        <div class="warning-item">
                            <strong>1. 첫번째행 수정 금지</strong>
                            <p>컬럼명, 기본 식자재, 고유코드 등... 정성한 양식 기준정보를 수정하면 안됩니다.</p>
                        </div>
                        
                        <div class="warning-item">
                            <strong>2. 시트목적, 시트 추가 등.. 금지</strong>
                            <p>다른 목적의 엑셀과 합본 및 수정 안됩니다 양식을 위한 구조가 변경되면 안됩니다.</p>
                            <p>이 이상은 개발자에게 문의하여 일괄리합니다.</p>
                        </div>
                    </div>
                </div>

                <!-- 파일 업로드 섹션 -->
                <div id="upload-section" class="upload-section" style="display: none;">
                    <div class="upload-container">
                        <div class="upload-area" onclick="document.getElementById('file-input').click()">
                            <div class="upload-icon">📁</div>
                            <div class="upload-text">
                                <h4>파일을 선택하거나 여기로 드래그하세요</h4>
                                <p>지원 형식: .xlsx, .xls (최대 10MB)</p>
                            </div>
                        </div>
                        <input type="file" id="file-input" accept=".xlsx,.xls" multiple style="display: none;">
                        
                        <div class="upload-progress" id="upload-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <div class="progress-text" id="progress-text">업로드 중...</div>
                        </div>
                    </div>
                    
                    <div class="upload-actions">
                        <button class="btn btn-primary" onclick="uploadFiles()" id="upload-btn" disabled>
                            업로드 시작
                        </button>
                        <button class="btn btn-secondary" onclick="clearFiles()">
                            파일 초기화
                        </button>
                    </div>
                </div>

                <!-- 업로드 결과 -->
                <div id="upload-results" class="upload-results" style="display: none;">
                    <h3>업로드 결과</h3>
                    <div class="result-summary">
                        <div class="result-item success">
                            <span class="result-label">성공:</span>
                            <span class="result-count" id="success-count">0</span>개 파일
                        </div>
                        <div class="result-item error">
                            <span class="result-label">실패:</span>
                            <span class="result-count" id="error-count">0</span>개 파일
                        </div>
                    </div>
                    
                    <div class="result-details" id="result-details">
                        <!-- 상세 결과가 여기에 표시됩니다 -->
                    </div>
                </div>

                <!-- 식자재 목록 -->
                <div class="ingredients-list">
                    <h3>등록된 식자재 목록</h3>
                    <div class="list-controls">
                        <input type="text" id="ingredient-search" placeholder="식자재명으로 검색..." class="search-input">
                        <select id="supplier-filter" class="filter-select">
                            <option value="">전체 업체</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadIngredientsList()">새로고침</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>식자재명</th>
                                    <th>업체</th>
                                    <th>단위</th>
                                    <th>단가</th>
                                    <th>최소주문량</th>
                                    <th>등록일</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody id="ingredients-tbody">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #666;">
                                        식자재 목록을 불러오는 중...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
                
            </div>


            <!-- 식수 등록 관리 페이지 -->

            <div id="pricing-page" class="page-content hidden">
                <h2>💰 단가 관리</h2>
                <p style="color: #666; margin-bottom: 30px;">끼니당 판매가와 목표 식재료비를 설정하여 회사 수익을 추정할 수 있습니다.</p>
                
                <div class="pricing-controls" style="margin-bottom: 30px; display: flex; gap: 15px; align-items: center;">
                    <select id="pricing-customer-select" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                        <option value="">사업장 선택</option>
                    </select>
                    <select id="pricing-meal-type-filter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="all">모든 구분</option>
                        <option value="도시락">도시락</option>
                        <option value="운반">운반</option>
                        <option value="학교">학교</option>
                        <option value="요양원">요양원</option>
                        <option value="위탁">위탁</option>
                        <option value="일반음식점">일반음식점</option>
                        <option value="기타">기타</option>
                    </select>
                    <button onclick="loadPricingData()" style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-search"></i> 조회
                    </button>
                    <button onclick="savePricingData()" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-save"></i> 저장
                    </button>
                </div>

                <div class="pricing-table-container" style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="pricing-summary" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">총 설정 항목</div>
                            <div id="total-items" style="font-size: 24px; font-weight: bold; color: #2c3e50;">0</div>
                        </div>
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">평균 판매가</div>
                            <div id="avg-price" style="font-size: 24px; font-weight: bold; color: #27ae60;">0원</div>
                        </div>
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">평균 재료비</div>
                            <div id="avg-cost" style="font-size: 24px; font-weight: bold; color: #f39c12;">0원</div>
                        </div>
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #d1ecf1; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">평균 수익률</div>
                            <div id="avg-margin" style="font-size: 24px; font-weight: bold; color: #17a2b8;">0%</div>
                        </div>
                    </div>

                    <div class="pricing-table-wrapper" style="overflow-x: auto;">
                        <table id="pricing-table" style="width: 100%; border-collapse: collapse; min-width: 800px;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left; font-weight: 600;">사업장명</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left; font-weight: 600;">구분</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left; font-weight: 600;">식사 구분</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">판매가 (원)</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">목표 재료비 (원)</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">수익률 (%)</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">수정일</th>
                                </tr>
                            </thead>
                            <tbody id="pricing-table-body">
                                <tr>
                                    <td colspan="7" style="padding: 40px; text-align: center; color: #666;">
                                        사업장을 선택하고 조회 버튼을 클릭해주세요.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="pricing-help" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                    <h4 style="margin: 0 0 10px 0; color: #2c3e50;">💡 사용 가이드</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #555;">
                        <li>판매가: 해당 끼니의 실제 판매 금액을 입력하세요.</li>
                        <li>목표 재료비: 해당 판매가에 맞는 목표 식재료 비용을 입력하세요.</li>
                        <li>수익률은 자동으로 계산됩니다: ((판매가 - 재료비) / 판매가) × 100</li>
                        <li>빈 값으로 두면 해당 항목은 저장되지 않습니다.</li>
                        <li>이 데이터는 회사의 수익 추정을 위한 자료로 활용됩니다.</li>
                    </ul>
                </div>
            </div>

            <div id="settings-page" class="page-content hidden">
                <h2>시스템 설정 페이지</h2>
                <p>시스템 설정 기능이 여기에 구현될 예정입니다.</p>
            </div>


            <div id="meal-pricing-page" class="page-content hidden">
                <h2>💰 식단가 관리</h2>
                <p style="color: #666; margin-bottom: 30px;">부문별 식단표의 세부식단표별 판매가 및 재료비 가이드라인을 설정합니다.</p>
                
                <!-- 식단표 선택 -->
                <div class="section-card" style="margin-bottom: 30px;">
                    <h3>🍽️ 사업장별 식단표 선택</h3>
                    <div style="display: flex; gap: 15px; align-items: center; margin-top: 15px; flex-wrap: wrap;">
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            <label style="font-size: 12px; color: #666; font-weight: 500;">사업장 선택</label>
                            <select id="businessLocationSelect" onchange="updateMealPlanOptions()" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 200px;">
                                <option value="">사업장을 선택하세요</option>
                            </select>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            <label style="font-size: 12px; color: #666; font-weight: 500;">식단표 타입</label>
                            <select id="mealPlanSelect" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 200px;" disabled>
                                <option value="">먼저 사업장을 선택하세요</option>
                            </select>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            <label style="font-size: 12px; color: transparent; font-weight: 500;">조회</label>
                            <button onclick="onMasterMealPlanChange()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-search"></i> 세부식단표 조회
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 세부식단표 목록 -->
                <div class="section-card">
                    <h3>📋 세부식단표 관리</h3>
                    <div id="detailedMealPlansContainer" style="margin-top: 20px;">
                        <p style="color: #888; text-align: center; padding: 40px;">위에서 식단표를 선택하면 세부식단표 목록이 표시됩니다.</p>
                    </div>
                </div>

                <!-- 세부식단표 가격 및 재료비 관리 -->
                <div class="section-card" style="margin-top: 20px;">
                    <h3>💰 가격 및 재료비 관리</h3>
                    <div id="pricingManagementContainer" style="margin-top: 20px;">
                        <p style="color: #888; text-align: center; padding: 40px;">위에서 세부식단표를 불러온 후 가격 관리가 가능합니다.</p>
                    </div>
                </div>

                <!-- 저장 버튼 -->
                <div style="text-align: center; margin-top: 30px;">
                    <button id="saveMealPricingBtn" onclick="saveMealPricing()" 
                            style="padding: 12px 30px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; display: none;">
                        💾 가격 정보 저장
                    </button>
                </div>
                        <div class="instruction-card" style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #e74c3c;">
                            <h4>🔪 전처리 지시서</h4>
                            <p style="color: #666; margin: 10px 0;">식재료 전처리 작업 지시서를 관리합니다.</p>
                            <div style="margin-top: 15px;">
                                <button onclick="window.open('preprocessing_management.html', '_blank')" style="padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                    관리
                                </button>
                                <button onclick="generatePreprocessingInstruction()" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    일괄생성
                                </button>
                            </div>
                        </div>
                        
                        <div class="instruction-card" style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #f39c12;">
                            <h4>🍳 조리 지시서</h4>
                            <p style="color: #666; margin: 10px 0;">조리 작업 지시서를 관리합니다.</p>
                            <div style="margin-top: 15px;">
                                <button onclick="window.open('cooking_instruction_management.html', '_blank')" style="padding: 8px 16px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                    관리
                                </button>
                                <button onclick="generateCookingInstruction()" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    일괄생성
                                </button>
                            </div>
                        </div>
                        
                        <div class="instruction-card" style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #27ae60;">
                            <h4>📦 소분 지시서</h4>
                            <p style="color: #666; margin: 10px 0;">소분 작업 지시서를 관리합니다.</p>
                            <div style="margin-top: 15px;">
                                <button onclick="window.open('portion_instruction_management.html', '_blank')" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                    관리
                                </button>
                                <button onclick="generatePortionInstruction()" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    일괄생성
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4>🔄 통합 작업 흐름</h4>
                        <p style="color: #666; margin: 10px 0;">마스터 식단표를 기준으로 모든 지시서를 한번에 생성할 수 있습니다.</p>
                        <div style="margin-top: 15px;">
                            <button onclick="generateAllInstructions()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                <i class="fas fa-magic"></i> 모든 지시서 일괄 생성
                            </button>
                            <select id="instruction-date-select" style="padding: 12px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option>생성할 날짜 선택</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 일괄 생성/관리 탭 -->
                <div id="batch-tab" class="meal-plan-tab-content hidden">
                    <h3>🚀 일괄 생성/관리</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin: 20px 0;">
                        <h4>📅 기간별 식단표 일괄 생성</h4>
                        <div style="display: flex; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
                            <div>
                                <label>시작일:</label>
                                <input type="date" id="batch-start-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label>종료일:</label>
                                <input type="date" id="batch-end-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label>대상:</label>
                                <select id="batch-target-type" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">전체</option>
                                    <option value="dosirak">도시락</option>
                                    <option value="transport">운반</option>
                                    <option value="school">학교</option>
                                    <option value="care">요양원</option>
                                </select>
                            </div>
                            <button onclick="batchGenerateMealPlans()" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-rocket"></i> 일괄 생성
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4>📊 템플릿 기반 생성</h4>
                        <p style="color: #666; margin-bottom: 15px;">기존 식단표를 템플릿으로 활용하여 새로운 식단표를 생성합니다.</p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select id="template-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                                <option>템플릿 선택...</option>
                            </select>
                            <input type="date" id="template-target-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <button onclick="createFromTemplate()" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-copy"></i> 템플릿으로 생성
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            <div id="logs-page" class="page-content hidden">
                <h2>로그 관리 페이지</h2>
                <p>로그 관리 기능이 여기에 구현될 예정입니다.</p>
            </div>
        </main>
    </div>

