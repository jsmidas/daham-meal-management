<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ˆ ëŒ€ì‹œë³´ë“œ - ê¸‰ì‹ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">

    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- ê³µí†µ ì‚¬ì´ë“œë°” CSS -->
    <link rel="stylesheet" href="static/css/common-sidebar.css">

    <!-- ëª¨ë“ˆí™”ëœ CSS -->
    <link rel="stylesheet" href="static/css/user/dashboard-styles.css">

    <!-- í´ë°± ìŠ¤íƒ€ì¼ -->
    <style>
        body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; overflow-x: hidden; }

        /* ëŒ€ì‹œë³´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
        .dashboard-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; padding: 15px 20px; border-radius: 8px;
            margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .dashboard-header h1 { margin: 0; font-size: 22px; font-weight: 600; }
        .date-info { font-size: 13px; opacity: 0.9; margin-top: 5px; }

        /* 3x3 ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 100%;
            margin: 0;
        }

        /* ê¸°ë³¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #3498db;
            height: 140px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* ì•Œë¦¼ ì¹´ë“œë“¤ì˜ ë†’ì´ ì¦ê°€ */
        .notice-card, .safety-card, .request-card {
            height: 220px;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .card-header i { font-size: 16px; color: #3498db; margin-right: 8px; }
        .card-header h3 { margin: 0; font-size: 13px; font-weight: 600; color: #2c3e50; }

        .card-content { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .big-number { font-size: 24px; font-weight: 700; color: #2c3e50; line-height: 1; }
        .sub-text { font-size: 11px; color: #7f8c8d; margin: 2px 0; }
        .progress-info { font-size: 10px; color: #95a5a6; }

        /* íŠ¹ë³„ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .stats-card { border-left-color: #3498db; }
        .chart-card { border-left-color: #e67e22; }
        .notice-card { border-left-color: #f39c12; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .health-card { border-left-color: #27ae60; }
        .safety-card { border-left-color: #e74c3c; }
        .request-card { border-left-color: #9b59b6; }

        /* í´ë¦­ ê°€ëŠ¥í•œ ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
        .notice-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* ë¯¸ë‹ˆ ì°¨íŠ¸ */
        .mini-chart { height: 60px; margin-bottom: 5px; }
        .chart-summary { font-size: 11px; color: #27ae60; font-weight: 600; }

        /* ì•Œë¦¼ ì½˜í…ì¸  - ë©”ì¼ í˜•ì‹ */
        .notice-content, .safety-content, .request-content {
            font-size: 11px;
            overflow-y: auto;
            max-height: 170px;
        }
        .mail-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 6px;
            border-left: 3px solid #3498db;
            transition: background 0.2s;
        }
        .mail-item:hover { background: #e8f4fd; }
        .mail-item.unread { background: #fff3cd; border-left-color: #f39c12; }
        .mail-item.urgent { background: #f8d7da; border-left-color: #e74c3c; }

        .mail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        .mail-subject { font-weight: 600; color: #2c3e50; font-size: 11px; }
        .mail-date { font-size: 9px; color: #95a5a6; }
        .mail-author { font-size: 10px; color: #34495e; margin-bottom: 2px; }
        .mail-preview { color: #7f8c8d; font-size: 10px; }

        .mail-count {
            font-size: 10px;
            color: #95a5a6;
            text-align: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }

        /* ë³´ê±´ì¦ ìƒíƒœ */
        .health-status { margin-bottom: 8px; }
        .status-item {
            display: inline-block; margin-right: 8px; padding: 2px 6px;
            border-radius: 10px; font-size: 9px; font-weight: 600;
        }
        .status-item.urgent { background: #ffebee; color: #e74c3c; }
        .status-item.warning { background: #fff3e0; color: #f39c12; }
        .status-item.normal { background: #e8f5e8; color: #27ae60; }
        .next-expire { font-size: 10px; color: #7f8c8d; }

        /* ì•ˆì „ ì•Œë¦¼ */
        .safety-item { display: flex; align-items: center; }
        .safety-icon { margin-right: 8px; font-size: 14px; }
        .safety-text { flex: 1; }
        .priority-high { background: #ffebee; border-left: 3px solid #e74c3c; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .sidebar { width: 200px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="sidebar">
            <div class="logo">
                <h1>ğŸ½ï¸ ê¸‰ì‹ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            </div>

            <!-- ë©”ì¸ ê´€ë¦¬ -->
            <a href="dashboard.html" class="nav-item active"><i class="fas fa-home"></i>ëŒ€ì‹œë³´ë“œ</a>
            <a href="menu_recipe_management.html" class="nav-item"><i class="fas fa-utensils"></i>ë©”ë‰´/ë ˆì‹œí”¼ ê´€ë¦¬</a>
            <a href="meal_plan_management.html" class="nav-item"><i class="fas fa-calendar-alt"></i>ì‹ë‹¨ ê´€ë¦¬</a>
            <a href="meal_count_management.html" class="nav-item"><i class="fas fa-users"></i>ì‹ìˆ˜ ê´€ë¦¬</a>
            <a href="ingredients_management.html" class="nav-item"><i class="fas fa-carrot"></i>ì‹ìì¬ ê´€ë¦¬</a>
            <a href="ordering_management.html" class="nav-item"><i class="fas fa-shopping-cart"></i>ë°œì£¼ ê´€ë¦¬</a>
            <a href="receiving_management.html" class="nav-item"><i class="fas fa-truck"></i>ì…ê³ ëª…ì„¸ì„œ ê´€ë¦¬</a>
            <a href="#" class="nav-item"><i class="fas fa-book"></i>ê°ì¢… ì¼ì§€</a>
            <a href="preprocessing_management.html" class="nav-item"><i class="fas fa-cut"></i>ì „ì²˜ë¦¬ì§€ì‹œì„œ</a>
            <a href="cooking_instruction_management.html" class="nav-item"><i class="fas fa-fire"></i>ì¡°ë¦¬ì§€ì‹œì„œ</a>
            <a href="portion_instruction_management.html" class="nav-item"><i class="fas fa-chart-bar"></i>ì†Œë¶„ì§€ì‹œì„œ</a>
            <div class="nav-divider"></div>
            <a href="admin_dashboard.html" class="nav-item admin-item"><i class="fas fa-cog"></i>ADMIN</a>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ëŒ€ì‹œë³´ë“œ í—¤ë” -->
            <div class="dashboard-header">
                <h1>ğŸ“ˆ ì£¼ìš” í˜„í™© ëŒ€ì‹œë³´ë“œ</h1>
                <div class="date-info">
                    <span id="current-date"></span> | ì‚¬ìš©ì: <span id="current-user">ë¡œë”© ì¤‘...</span>
                </div>
            </div>

            <!-- ì „ì²´ ë‚´ìš©ì„ 3x3 ê·¸ë¦¬ë“œë¡œ ì¬êµ¬ì„± -->
            <div class="dashboard-grid">
                <!-- 1ì—´: ê¸°ë³¸ í˜„í™© -->
                <div class="dashboard-card stats-card">
                    <div class="card-header">
                        <i class="fas fa-carrot"></i>
                        <h3>ì‹ìì¬ ë°ì´í„°</h3>
                    </div>
                    <div class="card-content">
                        <div class="big-number" id="ingredient-count">ë¡œë”© ì¤‘...</div>
                        <div class="sub-text">ì´ ë“±ë¡ ê±´ìˆ˜</div>
                        <div class="progress-info">
                            ë²„ì „: <span id="data-version">ë¡œë”© ì¤‘...</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card stats-card">
                    <div class="card-header">
                        <i class="fas fa-utensils"></i>
                        <h3>ë ˆì‹œí”¼ ë“±ë¡</h3>
                    </div>
                    <div class="card-content">
                        <div class="big-number" id="recipe-count">ë¡œë”© ì¤‘...</div>
                        <div class="sub-text">ì´ ë“±ë¡ ê±´ìˆ˜</div>
                        <div class="progress-info">
                            ì´ë²ˆ ì£¼ ì‹ ê·œ: <span id="new-recipes">ë¡œë”© ì¤‘...</span>ê±´
                        </div>
                    </div>
                </div>

                <div class="dashboard-card stats-card">
                    <div class="card-header">
                        <i class="fas fa-truck"></i>
                        <h3>í˜‘ë ¥ì—…ì²´</h3>
                    </div>
                    <div class="card-content">
                        <div class="big-number" id="supplier-count">ë¡œë”© ì¤‘...</div>
                        <div class="sub-text">í™œì„± ì—…ì²´ ìˆ˜</div>
                        <div class="progress-info">
                            ì£¼ìš”: <span id="main-suppliers">ë¡œë”© ì¤‘...</span>
                        </div>
                    </div>
                </div>

                <!-- 2ì—´: ì‚¬ìš©ì ë° ë¶„ì„ -->
                <div class="dashboard-card stats-card">
                    <div class="card-header">
                        <i class="fas fa-users"></i>
                        <h3>ë¡œê·¸ì¸ ì‚¬ìš©ì</h3>
                    </div>
                    <div class="card-content">
                        <div class="big-number" id="user-count">ë¡œë”© ì¤‘...</div>
                        <div class="sub-text">í™œì„± ì‚¬ìš©ì</div>
                        <div class="progress-info">
                            ì˜¤ëŠ˜ ì ‘ì†: <span id="today-logins">ë¡œë”© ì¤‘...</span>ëª…
                        </div>
                    </div>
                </div>

                <div class="dashboard-card chart-card">
                    <div class="card-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>ìˆœê¸°ë³„ ë‹¨ê°€ ë¶„ì„</h3>
                    </div>
                    <div class="card-content">
                        <div class="mini-chart">
                            <canvas id="priceAnalysisChart"></canvas>
                        </div>
                        <div class="chart-summary">
                            í‰ê·  ìƒìŠ¹ë¥ : <span id="price-trend">ë¡œë”© ì¤‘...</span>%
                        </div>
                    </div>
                </div>

                <div class="dashboard-card health-card">
                    <div class="card-header">
                        <i class="fas fa-id-card"></i>
                        <h3>ë³´ê±´ì¦ ë§Œê¸°ì¼</h3>
                    </div>
                    <div class="card-content">
                        <div class="health-status">
                            <div class="status-item urgent" id="urgent-health">
                                ê¸´ê¸‰: <span>0</span>ê±´
                            </div>
                            <div class="status-item warning" id="warning-health">
                                ì£¼ì˜: <span>0</span>ê±´
                            </div>
                            <div class="status-item normal" id="normal-health">
                                ì •ìƒ: <span>0</span>ê±´
                            </div>
                        </div>
                        <div class="next-expire">
                            ë‹¤ìŒ ë§Œë£Œ: <span id="next-health-expire">ë¡œë”© ì¤‘...</span>
                        </div>
                    </div>
                </div>

                <!-- 3ì—´: ì•Œë¦¼ ë° ê²½ê³  -->
                <div class="dashboard-card notice-card">
                    <div class="card-header">
                        <i class="fas fa-bullhorn"></i>
                        <h3>ì—…ë¬´ì—°ë½</h3>
                    </div>
                    <div class="card-content notice-content" id="notice-list">
                        <!-- ë©”ì¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="mail-count">
                        ì´ <span id="notice-count">0</span>ê±´ | ë¯¸ì½ìŒ <span id="unread-count">0</span>ê±´
                    </div>
                </div>

                <div class="dashboard-card safety-card">
                    <div class="card-header">
                        <i class="fas fa-shield-alt"></i>
                        <h3>[í•„ë…]ìœ„ìƒì•ˆì „ ì•Œë¦¼</h3>
                    </div>
                    <div class="card-content safety-content" id="safety-list">
                        <!-- ì•ˆì „ ì•Œë¦¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="mail-count">
                        ì´ <span id="safety-count">0</span>ê±´ | ë¯¸í™•ì¸ <span id="safety-unread-count">0</span>ê±´
                    </div>
                </div>

                <div class="dashboard-card request-card">
                    <div class="card-header">
                        <i class="fas fa-cogs"></i>
                        <h3>ì‹œìŠ¤í…œ ìš”ì²­ì‚¬í•­</h3>
                    </div>
                    <div class="card-content request-content" id="request-list">
                        <!-- ìš”ì²­ì‚¬í•­ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="mail-count">
                        ì´ <span id="request-count">0</span>ê±´ | ëŒ€ê¸° ì¤‘ <span id="pending-count">0</span>ê±´
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ë¸Œëœë”© ì‹œìŠ¤í…œ -->
    <script src="config.js"></script>
    <script src="static/js/branding.js"></script>

    <!-- ë™ì  ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ì „ì—­ ì„¤ì •
        window.CONFIG = window.CONFIG || {
            API_BASE_URL: 'http://127.0.0.1:8010'
        };

        // ë‚ ì§œ ë° ì‚¬ìš©ì ì •ë³´ ì„¤ì •
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            weekday: 'short'
        });

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        const userInfo = JSON.parse(localStorage.getItem('user_info') || '{}');
        document.getElementById('current-user').textContent = userInfo.username || 'ë¯¸ë¡œê·¸ì¸';

        // API í˜¸ì¶œ í•¨ìˆ˜
        async function fetchDashboardData() {
            try {
                // ë³‘ë ¬ë¡œ ëª¨ë“  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                const [dashboardStats, ingredientsData, recipesData, suppliersData, usersData] = await Promise.all([
                    fetch(`${window.CONFIG.API_BASE_URL}/api/admin/dashboard-stats`).then(r => r.json()),
                    fetch(`${window.CONFIG.API_BASE_URL}/api/admin/ingredients-summary`).then(r => r.json()),
                    fetch(`${window.CONFIG.API_BASE_URL}/api/admin/menu-recipes`).then(r => r.json()),
                    fetch(`${window.CONFIG.API_BASE_URL}/api/admin/suppliers`).then(r => r.json()),
                    fetch(`${window.CONFIG.API_BASE_URL}/api/admin/users`).then(r => r.json())
                ]);

                // ë°ì´í„° ì—…ë°ì´íŠ¸
                updateDashboardCards(dashboardStats, ingredientsData, recipesData, suppliersData, usersData);

            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showErrorState();
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboardCards(dashboardStats, ingredients, recipes, suppliers, users) {
            // ì‹ìì¬ ë°ì´í„° (dashboard-statsì™€ ingredients-summary ë‘˜ ë‹¤ í™œìš©)
            const ingredientCount = dashboardStats.success ? dashboardStats.totalIngredients :
                                  (ingredients.success ? ingredients.summary?.total_ingredients : 84215);
            document.getElementById('ingredient-count').textContent = ingredientCount.toLocaleString() + 'ê±´';
            document.getElementById('data-version').textContent = new Date().toISOString().slice(0, 10);

            // ë ˆì‹œí”¼ ë°ì´í„°
            const recipeCount = recipes.success && recipes.data ? recipes.data.length : 0;
            document.getElementById('recipe-count').textContent = recipeCount.toLocaleString() + 'ê±´';
            document.getElementById('new-recipes').textContent = Math.floor(recipeCount * 0.05); // 5%ë¥¼ ì‹ ê·œë¡œ ê°€ì •

            // í˜‘ë ¥ì—…ì²´ ë°ì´í„° (dashboard-statsì—ì„œ ì´ ê°œìˆ˜, suppliersì—ì„œ ìƒì„¸ ì •ë³´)
            const supplierCount = dashboardStats.success ? dashboardStats.totalSuppliers :
                                (suppliers.success && suppliers.data ? suppliers.data.length : 0);
            document.getElementById('supplier-count').textContent = supplierCount + 'ê°œ';

            // ì£¼ìš” í˜‘ë ¥ì—…ì²´ í‘œì‹œ (suppliers APIì—ì„œ)
            if (suppliers.success && suppliers.data && suppliers.data.length > 0) {
                const mainSuppliers = suppliers.data.slice(0, 3).map(s => s.name).join(', ');
                document.getElementById('main-suppliers').textContent = mainSuppliers;
            } else {
                document.getElementById('main-suppliers').textContent = 'í˜„ëŒ€ê·¸ë¦°í‘¸ë“œ, ë™ì›í™ˆí‘¸ë“œ, CJ';
            }

            // ì‚¬ìš©ì ë°ì´í„° (dashboard-statsì—ì„œ)
            const userCount = dashboardStats.success ? dashboardStats.totalUsers :
                            (users.success && users.data ? users.data.length : 0);
            document.getElementById('user-count').textContent = userCount + 'ëª…';
            document.getElementById('today-logins').textContent = Math.ceil(userCount * 0.7); // 70% í™œì„±ë„ ê°€ì •

            // ê°€ê²© ë¶„ì„ (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ê°œì„ )
            document.getElementById('price-trend').textContent = '+2.3';

            // ì—…ë¬´ì—°ë½ (í˜„ì¬ëŠ” ëª¨ì˜ ë°ì´í„°, ë‚˜ì¤‘ì— ì‹¤ì œ API ì—°ê²°)
            updateWorkNotices();

            // ë³´ê±´ì¦ ë° ì•ˆì „ ì•Œë¦¼ (ëª¨ì˜ ë°ì´í„°)
            updateHealthStatus();
            updateSafetyAlerts();
            updateSystemRequests();
        }

        // ì—…ë¬´ì—°ë½ ì—…ë°ì´íŠ¸ - ë©”ì¼ í˜•ì‹
        function updateWorkNotices() {
            const notices = [
                {
                    subject: 'ì‹ìì¬ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ',
                    author: 'ê´€ë¦¬ì',
                    date: '2025-09-19',
                    preview: 'ì´ 84,215ê±´ì˜ ì‹ìì¬ ë°ì´í„° ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
                    unread: true
                },
                {
                    subject: 'ì‹ ê·œ í˜‘ë ¥ì—…ì²´ ì¶”ê°€ ì•ˆë‚´',
                    author: 'êµ¬ë§¤íŒ€',
                    date: '2025-09-18',
                    preview: 'ì˜ìœ í†µì´ ìƒˆë¡œìš´ í˜‘ë ¥ì—…ì²´ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    unread: true
                },
                {
                    subject: 'ë©”ë‰´ ë ˆì‹œí”¼ ì‹œìŠ¤í…œ ê°œì„ ',
                    author: 'ê°œë°œíŒ€',
                    date: '2025-09-17',
                    preview: 'ë ˆì‹œí”¼ ê´€ë¦¬ ê¸°ëŠ¥ì´ í–¥ìƒë˜ì–´ ë”ìš± í¸ë¦¬í•˜ê²Œ...',
                    unread: false
                },
                {
                    subject: 'ì‹œìŠ¤í…œ ì •ê¸° ì ê²€ ì•ˆë‚´',
                    author: 'ê´€ë¦¬ì',
                    date: '2025-09-16',
                    preview: 'ì›”ê°„ ì •ê¸° ì ê²€ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
                    unread: false
                }
            ];

            let noticeHtml = '';
            let unreadCount = 0;

            notices.forEach(notice => {
                if (notice.unread) unreadCount++;
                noticeHtml += `
                    <div class="mail-item ${notice.unread ? 'unread' : ''}">
                        <div class="mail-header">
                            <div class="mail-subject">${notice.subject}</div>
                            <div class="mail-date">${notice.date}</div>
                        </div>
                        <div class="mail-author">ë³´ë‚¸ì´: ${notice.author}</div>
                        <div class="mail-preview">${notice.preview}</div>
                    </div>
                `;
            });

            document.getElementById('notice-list').innerHTML = noticeHtml;
            document.getElementById('notice-count').textContent = notices.length;
            document.getElementById('unread-count').textContent = unreadCount;
        }

        // ë³´ê±´ì¦ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateHealthStatus() {
            const urgent = Math.floor(Math.random() * 3);
            const warning = Math.floor(Math.random() * 8) + 2;
            const normal = Math.floor(Math.random() * 20) + 15;

            document.querySelector('#urgent-health span').textContent = urgent;
            document.querySelector('#warning-health span').textContent = warning;
            document.querySelector('#normal-health span').textContent = normal;

            const nextExpire = new Date();
            nextExpire.setDate(nextExpire.getDate() + Math.floor(Math.random() * 60) + 30);
            document.getElementById('next-health-expire').textContent =
                nextExpire.toLocaleDateString('ko-KR');
        }

        // ì•ˆì „ ì•Œë¦¼ ì—…ë°ì´íŠ¸ - ë©”ì¼ í˜•ì‹
        function updateSafetyAlerts() {
            const alerts = [
                {
                    subject: '[ê¸´ê¸‰] ì‹ì¤‘ë… ì˜ˆë°© ìˆ˜ì¹™ ì ê²€',
                    author: 'ì•ˆì „ê´€ë¦¬íŒ€',
                    date: '2025-09-19',
                    preview: 'ì—¬ë¦„ì²  ì‹ì¤‘ë… ì˜ˆë°©ì„ ìœ„í•œ íŠ¹ë³„ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                    urgent: true,
                    unread: true
                },
                {
                    subject: 'ëƒ‰ì¥ê³  ì˜¨ë„ ê´€ë¦¬ ê°•í™” ì•ˆë‚´',
                    author: 'ì‹œì„¤ê´€ë¦¬íŒ€',
                    date: '2025-09-18',
                    preview: 'ëª¨ë“  ëƒ‰ì¥ ì‹œì„¤ì˜ ì˜¨ë„ ì ê²€ì„ ê°•í™”í•´ì£¼ì„¸ìš”.',
                    urgent: false,
                    unread: true
                },
                {
                    subject: 'ì¡°ë¦¬ê¸°êµ¬ ì†Œë… ì‹¤ì‹œ ì•ˆë‚´',
                    author: 'ìœ„ìƒê´€ë¦¬íŒ€',
                    date: '2025-09-17',
                    preview: 'ì •ê¸° ì†Œë… ì¼ì •ì— ë”°ë¥¸ ì¡°ë¦¬ê¸°êµ¬ ì†Œë…ì„...',
                    urgent: false,
                    unread: false
                },
                {
                    subject: 'ì›ì¬ë£Œ ë³´ê´€ ìƒíƒœ ì ê²€',
                    author: 'í’ˆì§ˆê´€ë¦¬íŒ€',
                    date: '2025-09-16',
                    preview: 'ì…ê³ ëœ ì›ì¬ë£Œì˜ ë³´ê´€ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.',
                    urgent: false,
                    unread: false
                }
            ];

            let alertHtml = '';
            let unreadCount = 0;

            alerts.forEach(alert => {
                if (alert.unread) unreadCount++;
                alertHtml += `
                    <div class="mail-item ${alert.unread ? 'unread' : ''} ${alert.urgent ? 'urgent' : ''}">
                        <div class="mail-header">
                            <div class="mail-subject">${alert.subject}</div>
                            <div class="mail-date">${alert.date}</div>
                        </div>
                        <div class="mail-author">ë³´ë‚¸ì´: ${alert.author}</div>
                        <div class="mail-preview">${alert.preview}</div>
                    </div>
                `;
            });

            document.getElementById('safety-list').innerHTML = alertHtml;
            document.getElementById('safety-count').textContent = alerts.length;
            document.getElementById('safety-unread-count').textContent = unreadCount;
        }

        // ì‹œìŠ¤í…œ ìš”ì²­ì‚¬í•­ ì—…ë°ì´íŠ¸ - ë©”ì¼ í˜•ì‹
        function updateSystemRequests() {
            const requests = [
                {
                    subject: 'ë©”ë‰´ ê²€ìƒ‰ ê¸°ëŠ¥ ê°•í™” ìš”ì²­',
                    author: 'ì˜ì–‘ì‚¬íŒ€',
                    date: '2025-09-19',
                    preview: 'ë©”ë‰´ ê²€ìƒ‰ ì‹œ ë” ì •í™•í•œ ê²°ê³¼ë¥¼ ìœ„í•œ í•„í„° ê¸°ëŠ¥...',
                    status: 'ê²€í†  ì¤‘',
                    pending: true
                },
                {
                    subject: 'ìƒˆë¡œìš´ í˜‘ë ¥ì—…ì²´ ì¶”ê°€ ìš”ì²­',
                    author: 'êµ¬ë§¤íŒ€',
                    date: '2025-09-18',
                    preview: 'ì§€ì—­ í˜‘ë ¥ì—…ì²´ ì¶”ê°€ë¡œ ë°°ì†¡ë¹„ ì ˆê° íš¨ê³¼ë¥¼...',
                    status: 'ì§„í–‰ ì¤‘',
                    pending: true
                },
                {
                    subject: 'ì›”ë³„ ë¹„ìš© ë¦¬í¬íŠ¸ ê¸°ëŠ¥',
                    author: 'ê´€ë¦¬íŒ€',
                    date: '2025-09-17',
                    preview: 'ì›”ë³„ ì‹ìì¬ ë¹„ìš© ë¶„ì„ ë¦¬í¬íŠ¸ ìë™í™” ìš”ì²­',
                    status: 'ì™„ë£Œ',
                    pending: false
                },
                {
                    subject: 'ì¬ê³  ë¶€ì¡± ì•Œë¦¼ ì‹œìŠ¤í…œ',
                    author: 'ì°½ê³ íŒ€',
                    date: '2025-09-16',
                    preview: 'ì¬ê³ ê°€ ì¼ì • ìˆ˜ì¤€ ì´í•˜ë¡œ ë–¨ì–´ì§ˆ ë•Œ ìë™ ì•Œë¦¼...',
                    status: 'ê²€í†  ì¤‘',
                    pending: true
                }
            ];

            let requestHtml = '';
            let pendingCount = 0;

            requests.forEach(request => {
                if (request.pending) pendingCount++;
                requestHtml += `
                    <div class="mail-item ${request.pending ? 'unread' : ''}">
                        <div class="mail-header">
                            <div class="mail-subject">${request.subject}</div>
                            <div class="mail-date">${request.date}</div>
                        </div>
                        <div class="mail-author">ìš”ì²­ì: ${request.author}</div>
                        <div class="mail-preview">${request.preview}</div>
                    </div>
                `;
            });

            document.getElementById('request-list').innerHTML = requestHtml;
            document.getElementById('request-count').textContent = requests.length;
            document.getElementById('pending-count').textContent = pendingCount;
        }


        // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
        function showErrorState() {
            const errorElements = [
                'ingredient-count', 'recipe-count', 'supplier-count', 'user-count'
            ];
            errorElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = 'ì—°ê²° ì˜¤ë¥˜';
            });
        }

        // ê°€ê²© ë¶„ì„ ì°¨íŠ¸ ìƒì„±
        function createPriceChart() {
            const ctx = document.getElementById('priceAnalysisChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['ì§€ë‚œ ë‹¬', 'ì´ë²ˆ ë‹¬'],
                    datasets: [{
                        data: [100, 102.3],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        // ì´ˆê¸° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            // ë¸Œëœë”© ì‹œìŠ¤í…œ ì ìš©
            if (typeof BrandingManager !== 'undefined') {
                BrandingManager.applyBranding('ê¸‰ì‹ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ');
                console.log('âœ… ë¸Œëœë”© ì‹œìŠ¤í…œ ì ìš© ì™„ë£Œ (ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ)');
            }

            fetchDashboardData();
            createPriceChart();

            // 5ë¶„ë§ˆë‹¤ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            setInterval(fetchDashboardData, 5 * 60 * 1000);
        });
    </script>
</body>
</html>