<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ŒìŠ¤íŠ¸ ê¸‰ì‹ê´€ë¦¬ ì‹œìŠ¤í…œ - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
        }

        .admin-container {
            display: flex;
            height: 100vh;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .sidebar-header {
            text-align: center;
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: #ffd700;
        }

        .nav-item .icon {
            margin-right: 10px;
            font-size: 16px;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
        }

        .header-info {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-top: 10px;
        }

        .user-info {
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #ff5252;
        }

        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œë“¤ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-header .icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .card-content {
            color: #666;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            color: #999;
        }

        /* ìµœê·¼ í™œë™ ë¡œê·¸ */
        .activity-log {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .log-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-time {
            font-size: 12px;
            color: #999;
            margin-right: 15px;
            min-width: 100px;
        }

        .log-message {
            color: #666;
            flex: 1;
        }

        .log-user {
            font-size: 12px;
            color: #667eea;
            margin-left: 10px;
        }

        /* í†µí•© ì‹ë‹¨í‘œ ê´€ë¦¬ íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: #f8f9fa;
            color: #666;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .tab-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .tab-btn:hover {
            background: #e9ecef;
        }
        
        .tab-btn.active:hover {
            background: #5a6fd8;
        }
        
        .meal-plan-tab-content {
            padding: 20px 0;
        }
        
        .overview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15) !important;
            transition: all 0.3s;
        }
        
        .instruction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15) !important;
            transition: all 0.3s;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .meal-plan-tabs {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                margin-bottom: 5px;
            }
            
            .overview-cards {
                grid-template-columns: 1fr !important;
            }
        }

        .hidden {
            display: none !important;
        }

        /* ì‹ìì¬ ì—…ë¡œë“œ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .upload-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .upload-notice h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .notice-content p {
            color: #856404;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .warning-item {
            background: white;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .warning-item strong {
            color: #e67e22;
            display: block;
            margin-bottom: 8px;
        }

        .warning-item p {
            color: #666;
            margin: 5px 0;
            font-size: 14px;
        }

        .upload-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .upload-container {
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed #4a90e2;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover {
            border-color: #357abd;
            background: #e7f3ff;
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #d4edda;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .upload-text p {
            color: #666;
            font-size: 14px;
        }

        .upload-progress {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .upload-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .upload-results {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .upload-results h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .result-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
        }

        .result-item.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result-item.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result-count {
            font-size: 18px;
            font-weight: bold;
        }

        .result-details {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .result-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f8f9fa;
        }

        .result-file:last-child {
            border-bottom: none;
        }

        .result-file.success {
            background: #f8fff9;
        }

        .result-file.error {
            background: #fff5f5;
        }

        .file-name {
            font-weight: 500;
            color: #333;
        }

        .file-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        .file-status.success {
            color: #28a745;
        }

        .file-status.error {
            color: #dc3545;
        }

        .ingredients-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .ingredients-list h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .list-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .search-input, .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .search-input {
            flex: 2;
        }

        .filter-select {
            flex: 1;
        }

        /* ì‹ìˆ˜ ë“±ë¡ ê´€ë¦¬ ì „ìš© ìŠ¤íƒ€ì¼ */
        .meal-count-notice {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .meal-count-notice h3 {
            color: #0056b3;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .notice-content p {
            color: #0056b3;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .notice-rules {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rule-item {
            background: white;
            border-left: 4px solid #007bff;
            padding: 12px 15px;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
        }

        .rule-item strong {
            color: #0056b3;
            margin-right: 8px;
        }

        .meal-count-summary {
            margin-bottom: 20px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #4a90e2;
        }

        .card-header {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .card-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .meal-count-table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .table-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .meal-count-table {
            width: 100%;
            border-collapse: collapse;
        }

        .meal-count-table th,
        .meal-count-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: center;
            font-size: 13px;
        }

        .meal-count-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .meal-count-table tbody tr:hover {
            background: #f8f9fa;
        }

        .delivery-site-cell {
            font-weight: 600;
            color: #4a90e2;
            background: #f0f8ff !important;
        }

        .meal-type-cell {
            font-weight: 500;
        }

        .cost-cell {
            font-weight: 600;
            color: #28a745;
        }

        .count-cell {
            font-weight: 600;
            color: #dc3545;
        }

        .site-detail-row {
            background: #f9f9f9 !important;
            font-size: 12px;
        }

        .date-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin-left: 8px;
        }

        .date-selector {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .date-selector label {
            font-weight: 500;
            color: #333;
        }

        /* ëª¨ë‹¬ í¼ ìŠ¤íƒ€ì¼ */
        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
        }

        .form-group small {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-small.btn-primary {
            background: #4a90e2;
            color: white;
        }

        .btn-small.btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-small.btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .modal {
            display: none;
        }

        /* ì‚¬ìš©ì ê´€ë¦¬ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .page-header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header-actions {
            display: flex;
            justify-content: between;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            outline: none;
        }

        .search-box button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-left: none;
            border-radius: 0 5px 5px 0;
            background: #f8f9fa;
            cursor: pointer;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-edit {
            background: #28a745;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-add {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .btn-add:hover {
            background: #0056b3;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            box-shadow: 0 1px 2px rgba(220,53,69,0.3);
        }

        .btn-remove:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(220,53,69,0.4);
        }

        .supplier-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr auto;
            gap: 15px;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            margin-bottom: 8px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .supplier-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .supplier-row label {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }

        .supplier-row select,
        .supplier-row input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
        }

        .btn-reset {
            background: #ffc107;
            color: black;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-active {
            color: #28a745;
            font-weight: 500;
        }

        .status-inactive {
            color: #dc3545;
            font-weight: 500;
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination {
            text-align: center;
            padding: 20px;
        }

        .pagination button {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .pagination button:hover {
            background: #e9ecef;
        }

        .pagination button:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #dee2e6;
            text-align: right;
        }

        .modal-footer button {
            margin-left: 10px;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #667eea;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #6c757d;
            font-size: 12px;
        }

        .checkbox-label {
            display: flex !important;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto !important;
            margin-right: 8px;
        }

        /* ì‚¬ì—…ì¥ ê´€ë¦¬ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .sites-container {
            display: flex;
            gap: 20px;
        }

        .sites-tree {
            flex: 2;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .site-details-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .panel-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .panel-header h3 {
            margin: 0;
            color: #333;
        }

        .panel-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #999;
        }

        .panel-close:hover {
            color: #333;
        }

        /* íŠ¸ë¦¬ ë…¸ë“œ ìŠ¤íƒ€ì¼ */
        .tree-node {
            margin: 5px 0;
            user-select: none;
        }

        .tree-node-content {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .tree-node-content:hover {
            background: #f8f9fa;
        }

        .tree-node-content.selected {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
        }

        .tree-node-content.head-site {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
        }

        .tree-node-content.detail-site {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
        }

        .tree-node-content.period-site {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .tree-expand-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 5px;
            border-radius: 3px;
        }

        .tree-expand-btn:hover {
            background: #e9ecef;
        }

        .tree-expand-btn.expanded::before {
            content: 'â–¼';
        }

        .tree-expand-btn.collapsed::before {
            content: 'â–¶';
        }

        .tree-expand-btn.no-children {
            visibility: hidden;
        }

        .tree-node-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .tree-node-label {
            flex: 1;
            font-weight: 500;
            color: #333;
        }

        .tree-node-status {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .tree-node-status.active {
            background: #d4edda;
            color: #155724;
        }

        .tree-node-status.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .tree-node-actions {
            display: none;
            margin-left: 10px;
            gap: 5px;
        }

        .tree-node-content:hover .tree-node-actions {
            display: flex;
        }

        .tree-action-btn {
            padding: 2px 6px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tree-action-btn.add {
            background: #d4edda;
            color: #155724;
        }

        .tree-action-btn.edit {
            background: #cce5ff;
            color: #004085;
        }

        .tree-action-btn.delete {
            background: #f8d7da;
            color: #721c24;
        }

        .tree-action-btn:hover {
            opacity: 0.8;
        }

        /* ìì‹ ë…¸ë“œ ë“¤ì—¬ì“°ê¸° */
        .tree-children {
            margin-left: 25px;
            border-left: 1px solid #dee2e6;
            padding-left: 10px;
        }

        .tree-children.hidden {
            display: none;
        }

        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
        .tree-node-content {
            cursor: move;
            transition: all 0.2s ease;
        }

        .tree-node-content.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .tree-node-content.drag-over {
            background: #e3f2fd;
            border: 2px dashed #2196F3;
            transform: scale(1.02);
        }

        .tree-node-content.drop-invalid {
            background: #ffebee;
            border: 2px dashed #f44336;
        }

        .drag-indicator {
            position: absolute;
            height: 2px;
            background: #2196F3;
            left: 0;
            right: 0;
            pointer-events: none;
            z-index: 1000;
        }

        /* ì‚¬ì—…ì¥ ìƒì„¸ ì •ë³´ ìŠ¤íƒ€ì¼ */
        .site-info-group {
            margin-bottom: 15px;
        }

        .site-info-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .site-info-value {
            color: #333;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
        }

        .site-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
        .tree-node-content.dragging {
            opacity: 0.5;
        }

        .tree-node-content.drop-target {
            background: #e7f3ff;
            border: 2px dashed #007bff;
        }
        
        /* í•„ìˆ˜ í•„ë“œ ë³„í‘œ ìŠ¤íƒ€ì¼ */
        .required {
            color: #e74c3c;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(231, 76, 60, 0.3);
            margin-left: 3px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ê´€ë¦¬ì ì‹œìŠ¤í…œ</h2>
                <p>í…ŒìŠ¤íŠ¸ ê¸‰ì‹ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="icon">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <span class="icon">ğŸ‘¥</span>ì‚¬ìš©ì ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="suppliers">
                    <span class="icon">ğŸš›</span>í˜‘ë ¥ì—…ì²´ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="business-locations">
                    <span class="icon">ğŸ¢</span>ì‚¬ì—…ì¥ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="supplier-mapping">
                    <span class="icon">ğŸ”—</span>í˜‘ë ¥ì—…ì²´ ë§¤í•‘
                </a>
                <a href="#" class="nav-item" data-page="meal-pricing">
                    <span class="icon">ğŸ’°</span>ì‹ë‹¨ê°€ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="ingredients">
                    <span class="icon">ğŸ“¦</span>ì‹ìì¬ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <span class="icon">âš™ï¸</span>ì‹œìŠ¤í…œ ì„¤ì •
                </a>
                <a href="#" class="nav-item" data-page="logs">
                    <span class="icon">ğŸ“‹</span>ë¡œê·¸ ê´€ë¦¬
                </a>
                
                <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤ -->
                <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid #ddd;">
                    <a href="/" class="nav-item" style="background: #e8f5e8; color: #4caf50;">
                        <span class="icon">ğŸ½ï¸</span>ê¸‰ì‹ê´€ë¦¬ë¡œ ì´ë™
                    </a>
                </div>
            </div>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <div class="header">
                <div class="header-info">
                    <div>
                        <h1 id="page-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                        <div class="user-info">
                            ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”! | ë§ˆì§€ë§‰ ì ‘ì†: 2025-08-30 12:00
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
            <div id="dashboard-page" class="page-content">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">ğŸ‘¥</span>
                            <span class="card-title">ì „ì²´ ì‚¬ìš©ì</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="total-users">-</div>
                            <div class="stat-label">í™œì„± ì‚¬ìš©ì</div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">ğŸ¢</span>
                            <span class="card-title">ì‚¬ì—…ì¥ ìˆ˜</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="total-sites">-</div>
                            <div class="stat-label">ë“±ë¡ëœ ì‚¬ì—…ì¥</div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">ğŸ“‹</span>
                            <span class="card-title">ì˜¤ëŠ˜ì˜ ì‹ë‹¨</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="today-menus">-</div>
                            <div class="stat-label">ì˜¤ëŠ˜ í¸ì„±ëœ ì‹ë‹¨</div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="icon">ğŸ’°</span>
                            <span class="card-title">ë‹¨ê°€ ì—…ë°ì´íŠ¸</span>
                        </div>
                        <div class="card-content">
                            <div class="stat-number" id="price-updates">-</div>
                            <div class="stat-label">ìµœê·¼ 7ì¼ê°„ ì—…ë°ì´íŠ¸</div>
                        </div>
                    </div>
                </div>

                <!-- ìµœê·¼ í™œë™ ë¡œê·¸ -->
                <div class="activity-log">
                    <div class="card-header">
                        <span class="icon">ğŸ“‹</span>
                        <span class="card-title">ìµœê·¼ í™œë™</span>
                    </div>
                    <div id="activity-list">
                        <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë  í™œë™ ë¡œê·¸ -->
                    </div>
                </div>
            </div>

            <!-- ë‹¤ë¥¸ í˜ì´ì§€ë“¤ì€ hidden ìƒíƒœë¡œ ì‹œì‘ -->
            <div id="users-page" class="page-content hidden">
                <div class="page-header">
                    <div class="header-actions">
                        <div class="search-box">
                            <input type="text" id="user-search" placeholder="ì‚¬ìš©ì ê²€ìƒ‰ (ì´ë¦„, ì•„ì´ë””, ë¶€ì„œ)">
                            <button onclick="searchUsers()">ğŸ”</button>
                        </div>
                        <button class="btn-primary" onclick="showAddUserModal()">+ ìƒˆ ì‚¬ìš©ì</button>
                        <button class="btn-secondary" onclick="initUserExtensions()" style="background: #17a2b8; margin-left: 10px;">âš™ï¸ ê¸°ëŠ¥ í™•ì¥</button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì‚¬ìš©ìëª…</th>
                                <th>ì—­í• </th>
                                <th>ë¶€ì„œ</th>
                                <th>ì „í™”ë²ˆí˜¸</th>
                                <th>ë‹´ë‹¹ ì‚¬ì—…ì¥</th>
                                <th>ì ‘ê·¼ ì‚¬ì—…ì¥</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë  ì‚¬ìš©ì ëª©ë¡ -->
                        </tbody>
                    </table>
                </div>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination">
                    <button onclick="changePage(-1)">ì´ì „</button>
                    <span id="page-info">1 / 1</span>
                    <button onclick="changePage(1)">ë‹¤ìŒ</button>
                </div>
            </div>

            <div id="supplier-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="supplier-modal-title">ìƒˆ ì—…ì²´ ë“±ë¡</h3>
                        <button class="close-btn" onclick="closeSupplierModal()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <form id="supplier-form">
                            <input type="hidden" id="supplier-id">
                            
                            <div class="form-group">
                                <label>í˜‘ë ¥ì—…ì²´ëª… <span style="color: red;">*</span></label>
                                <input type="text" id="supplier-name" required placeholder="ì˜ˆ: CJí”„ë ˆì‹œì›¨ì´, ì›°ìŠ¤í† ë¦¬">
                            </div>

                            <div class="form-group">
                                <label>ëŒ€í‘œì</label>
                                <input type="text" id="supplier-representative" placeholder="ëŒ€í‘œìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>

                            <div class="form-group">
                                <label>ë‹´ë‹¹ì</label>
                                <input type="text" id="supplier-contact" placeholder="ë‹´ë‹¹ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>

                            <div class="form-group">
                                <label>íŒ©ìŠ¤ë²ˆí˜¸</label>
                                <input type="text" id="supplier-fax" placeholder="ì˜ˆ: 02-1234-5679">
                            </div>

                            <div class="form-group">
                                <label>ì´ë©”ì¼</label>
                                <input type="email" id="supplier-email" placeholder="ì˜ˆ: contact@company.com">
                            </div>

                            <div class="form-group">
                                <label>ì‚¬ì—…ìë²ˆí˜¸</label>
                                <input type="text" id="supplier-business-number" placeholder="ì˜ˆ: 123-45-67890">
                            </div>

                            <div class="form-group">
                                <label>ì—…ëª©</label>
                                <input type="text" id="supplier-business-item" placeholder="ì£¼ìš” ì·¨ê¸‰ í’ˆëª©">
                            </div>

                            <div class="form-group">
                                <label>ë‹´ë‹¹ì ì—°ë½ì²˜</label>
                                <input type="text" id="supplier-manager-name" placeholder="ë‹´ë‹¹ìëª…">
                            </div>

                            <div class="form-group">
                                <label>ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸</label>
                                <input type="text" id="supplier-manager-phone" placeholder="ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸">
                            </div>
                            
                            <div class="form-group">
                                <label>ì—…ì²´ì½”ë“œ (ëª¨ì½”ë“œ)</label>
                                <input type="text" id="supplier-parent-code" maxlength="10" placeholder="ì˜ˆ: CJ001, ì›°ìŠ¤í† ë¦¬001">
                                <small class="form-hint">í˜‘ë ¥ì—…ì²´ì—ì„œ ë¶€ì—¬í•œ ê³ ìœ ì½”ë“œ</small>
                            </div>

                            <div class="form-group">
                                <label>ì‚¬ì—…ì¥ì½”ë“œ</label>
                                <input type="text" id="supplier-site-code" maxlength="20" placeholder="ì‚¬ì—…ì¥ ê³ ìœ ì½”ë“œ">
                            </div>

                            <div class="form-group">
                                <label>ì‚¬ì—…ì¥ëª…</label>
                                <input type="text" id="supplier-site-name" placeholder="ì‚¬ì—…ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            
                            <div class="form-group">
                                <label>ì—…ì²´ ìœ í˜•</label>
                                <select id="supplier-business-type">
                                    <option value="">ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì‹ìì¬ë‚©í’ˆ">ì‹ìì¬ ë‚©í’ˆì—…ì²´</option>
                                    <option value="ì„œë¹„ìŠ¤">ì„œë¹„ìŠ¤ ì—…ì²´</option>
                                    <option value="ì¥ë¹„">ì¥ë¹„/ì‹œì„¤ ì—…ì²´</option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>ì—°ë½ì²˜</label>
                                <input type="text" id="supplier-phone" placeholder="ì˜ˆ: 02-1234-5678">
                            </div>
                            
                            <div class="form-group">
                                <label>ì£¼ì†Œ</label>
                                <textarea id="supplier-address" rows="2" placeholder="ì—…ì²´ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>ì—…ë°ì´íŠ¸ ì£¼ê¸°</label>
                                <select id="supplier-update-frequency">
                                    <option value="daily">ë§¤ì¼</option>
                                    <option value="weekly" selected>ì£¼ê°„</option>
                                    <option value="monthly">ì›”ê°„</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="supplier-is-active" checked>
                                    í™œì„± ìƒíƒœ
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>ë¹„ê³ </label>
                                <textarea id="supplier-notes" rows="2" placeholder="íŠ¹ì´ì‚¬í•­ì´ë‚˜ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeSupplierModal()">ì·¨ì†Œ</button>
                        <button type="button" class="btn-primary" onclick="saveSupplier()">ì €ì¥</button>
                    </div>
                </div>
            </div>

            <div id="user-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-title">ìƒˆ ì‚¬ìš©ì ì¶”ê°€</h3>
                        <button class="modal-close" onclick="closeUserModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="user-form">
                            <div class="form-group">
                                <label>ì´ë¦„ *</label>
                                <input type="text" id="user-name" placeholder="í™ê¸¸ë™" required>
                            </div>
                            <div class="form-group">
                                <label>ì‚¬ìš©ì ID *</label>
                                <input type="text" id="user-username" placeholder="hong123" required>
                            </div>
                            <div class="form-group">
                                <label>ë¹„ë°€ë²ˆí˜¸</label>
                                <input type="password" id="user-password">
                                <small>ìˆ˜ì • ì‹œ ë¹„ì›Œë‘ë©´ ë³€ê²½í•˜ì§€ ì•ŠìŒ</small>
                            </div>
                            <div class="form-group">
                                <label>ì—­í• </label>
                                <select id="user-role" required>
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="nutritionist">ì˜ì–‘ì‚¬</option>
                                    <option value="admin">ê´€ë¦¬ì</option>
                                    <option value="super_admin">ìµœê³ ê´€ë¦¬ì</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì—°ë½ì²˜</label>
                                <input type="text" id="user-contact">
                            </div>
                            <div class="form-group">
                                <label>ë¶€ì„œ</label>
                                <input type="text" id="user-department">
                            </div>
                            <div class="form-group">
                                <label>ì§ì±…</label>
                                <input type="text" id="user-position">
                            </div>
                            <div class="form-group">
                                <label>ë‹´ë‹¹ ì‚¬ì—…ì¥</label>
                                <select id="user-managed-site">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë  ì‚¬ì—…ì¥ ëª©ë¡ -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì „í™”ë²ˆí˜¸</label>
                                <input type="tel" id="user-phone" placeholder="010-1234-5678">
                            </div>
                            <div class="form-group">
                                <label>ìƒë…„ì›”ì¼</label>
                                <input type="date" id="user-birth-date">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="user-is-active" checked>
                                    í™œì„± ìƒíƒœ
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="user-operator">
                                    ìš´ì˜ì ê¶Œí•œ
                                </label>
                            </div>
                            <div class="form-group">
                                <label>ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ì—…ì¥</label>
                                <div id="user-sites-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
                                    <label class="checkbox-label" style="margin-bottom: 10px;">
                                        <input type="checkbox" id="sites-all" onchange="toggleAllSites(this)">
                                        <strong>ëª¨ë“  ì‚¬ì—…ì¥</strong>
                                    </label>
                                    <div id="sites-list">
                                        <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë  ì‚¬ì—…ì¥ ì²´í¬ë°•ìŠ¤ ëª©ë¡ -->
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="user-semi-operator">
                                    ë¶€ìš´ì˜ì ê¶Œí•œ
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeUserModal()">ì·¨ì†Œ</button>
                        <button type="button" class="btn-primary" onclick="testCreateUser()">ì €ì¥</button>
                    </div>
                </div>
            </div>

            <div id="suppliers-page" class="page-content hidden">
                <div class="page-header">
                    <div class="header-actions">
                        <div class="search-box">
                            <input type="text" id="supplier-search" placeholder="ì—…ì²´ëª…, ì—°ë½ì²˜, ì´ë©”ì¼ë¡œ ê²€ìƒ‰...">
                            <select id="supplier-status-filter" style="margin-left: 10px;">
                                <option value="">ì „ì²´ ìƒíƒœ</option>
                                <option value="1">ê±°ë˜ì¤‘</option>
                                <option value="0">ê±°ë˜ì¤‘ë‹¨</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="showAddSupplierModal()">+ ìƒˆ ì—…ì²´ ë“±ë¡</button>
                        <button class="btn-secondary" onclick="initSupplierExtensions()" style="background: #17a2b8; margin-left: 10px;" title="ë°ì´í„°ë² ì´ìŠ¤ì— ìƒˆë¡œìš´ í•„ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ì—…ì²´ ê´€ë¦¬ ê¸°ëŠ¥ì„ í™•ì¥í•©ë‹ˆë‹¤">âš™ï¸ DB í™•ì¥</button>
                    </div>
                </div>

                <div class="content-section">
                    <table id="suppliers-table" class="data-table">
                        <thead>
                            <tr>
                                <th>ëª¨ì½”ë“œ</th>
                                <th>ì‚¬ì—…ì¥ì½”ë“œ</th>
                                <th>ì‚¬ì—…ì¥ëª…</th>
                                <th>ì—…ì²´ëª…</th>
                                <th>ì—°ë½ì²˜</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ê±°ë˜ìƒíƒœ</th>
                                <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                                <th>ëŒ€í‘œì</th>
                                <th>ë‹´ë‹¹ì</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="suppliers-table-body">
                            <tr>
                                <td colspan="11" class="loading">ì—…ì²´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="business-locations-page" class="page-content hidden">
                <div class="page-header">
                    <h3>ì‚¬ì—…ì¥ ê´€ë¦¬</h3>
                    <button class="btn-primary" onclick="showAddSiteModal('ì¼ë°˜')">+ ì‚¬ì—…ì¥ ì¶”ê°€</button>
                    <button class="btn-secondary" onclick="loadSitesTable()" style="margin-left: 10px;">í…Œì´ë¸” ë·°</button>
                    <button class="btn-secondary" onclick="loadSitesTree()" style="margin-left: 10px;">íŠ¸ë¦¬ ë·°</button>
                </div>
                <div class="sites-container">
                    <div class="sites-tree">
                        <div id="sites-tree">
                            <!-- ì‚¬ì—…ì¥ íŠ¸ë¦¬ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <div class="sites-list">
                        <div id="sites-list">
                            <!-- ì‚¬ì—…ì¥ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="supplier-mapping-page" class="page-content hidden">
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2>ğŸ”— í˜‘ë ¥ì—…ì²´ ë§¤í•‘ ê´€ë¦¬</h2>
                        <button onclick="openMappingModal()" class="btn-primary">
                            <i class="fas fa-plus"></i> ìƒˆ ë§¤í•‘ ì¶”ê°€
                        </button>
                    </div>

                    <!-- í•„í„° ì„¹ì…˜ -->
                    <div class="filter-section" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end;">
                            <div class="form-group" style="margin: 0;">
                                <label>ì‚¬ì—…ì¥ í•„í„°</label>
                                <select id="mapping-customer-filter" onchange="filterMappings()">
                                    <option value="">ì „ì²´ ì‚¬ì—…ì¥</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label>í˜‘ë ¥ì—…ì²´ í•„í„°</label>
                                <select id="mapping-supplier-filter" onchange="filterMappings()">
                                    <option value="">ì „ì²´ í˜‘ë ¥ì—…ì²´</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label>ìƒíƒœ í•„í„°</label>
                                <select id="mapping-status-filter" onchange="filterMappings()">
                                    <option value="">ì „ì²´ ìƒíƒœ</option>
                                    <option value="true">í™œì„±</option>
                                    <option value="false">ë¹„í™œì„±</option>
                                </select>
                            </div>
                            <div>
                                <button onclick="clearMappingFilters()" class="btn-secondary">í•„í„° ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    </div>

                    <!-- ë§¤í•‘ í…Œì´ë¸” -->
                    <div class="table-container" style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 15%">ì‚¬ì—…ì¥</th>
                                    <th style="width: 25%">í˜‘ë ¥ì—…ì²´</th>
                                    <th style="width: 20%">ë°°ì†¡ì½”ë“œ</th>
                                    <th style="width: 15%">ê±°ë˜ìƒíƒœ</th>
                                    <th style="width: 25%">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="mappings-table-body">
                                <tr>
                                    <td colspan="5" class="loading">ë§¤í•‘ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- í†µê³„ ì„¹ì…˜ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                        <div class="stat-card">
                            <h3>ì´ ë§¤í•‘</h3>
                            <div class="stat-value" id="total-mappings">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>í™œì„± ë§¤í•‘</h3>
                            <div class="stat-value" id="active-mappings">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>ë§¤í•‘ëœ ì‚¬ì—…ì¥</h3>
                            <div class="stat-value" id="mapped-customers">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>ë§¤í•‘ëœ í˜‘ë ¥ì—…ì²´</h3>
                            <div class="stat-value" id="mapped-suppliers">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì‚¬ì—…ì¥ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
            <div id="site-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="site-modal-title">ìƒˆ ì‚¬ì—…ì¥ ì¶”ê°€</h3>
                        <button class="modal-close" onclick="closeSiteModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="site-form">
                            <input type="hidden" id="site-parent-id">
                            
                            <div class="form-group">
                                <label>ì‚¬ì—…ì¥ëª…</label>
                                <input type="text" id="site-name" required>
                            </div>
                            
                            <div class="form-group">
                                <label>êµ¬ë¶„</label>
                                <select id="site-type" required>
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ë„ì‹œë½">ë„ì‹œë½</option>
                                    <option value="ìš´ë°˜">ìš´ë°˜</option>
                                    <option value="í•™êµ">í•™êµ</option>
                                    <option value="ìš”ì–‘ì›">ìš”ì–‘ì›</option>
                                    <option value="ìœ„íƒ">ìœ„íƒ</option>
                                    <option value="ì¼ë°˜ìŒì‹ì ">ì¼ë°˜ìŒì‹ì </option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>ë‹´ë‹¹ì</label>
                                <input type="text" id="site-contact-person">
                            </div>
                            
                            <div class="form-group">
                                <label>ì—°ë½ì²˜</label>
                                <input type="text" id="site-contact-phone">
                            </div>
                            
                            <div class="form-group">
                                <label>ì£¼ì†Œ</label>
                                <textarea id="site-address" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>1ì¸ë‹¹ ì œê³µëŸ‰ (g)</label>
                                <input type="number" id="site-portion-size" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label>ì„¤ëª…</label>
                                <textarea id="site-description" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="site-is-active" checked>
                                    í™œì„± ìƒíƒœ
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeSiteModal()">ì·¨ì†Œ</button>
                        <button type="button" class="btn-primary" onclick="saveSite()">ì €ì¥</button>
                    </div>
                </div>
            </div>

            <!-- ë§¤í•‘ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
            <div id="mapping-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="mapping-modal-title">ìƒˆ ë§¤í•‘ ì¶”ê°€</h3>
                        <button class="modal-close" onclick="closeMappingModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="mapping-form">
                            <input type="hidden" id="mapping-id">
                            
                            <!-- ì‚¬ì—…ì¥ ì„ íƒ (ê³µí†µ) -->
                            <div class="form-group">
                                <label>ì‚¬ì—…ì¥ ì„ íƒ <span style="color: red;">*</span></label>
                                <select id="mapping-customer" required>
                                    <option value="">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <label>í˜‘ë ¥ì—…ì²´ ë§¤í•‘ <span style="color: red;">*</span></label>
                                    <button type="button" class="btn-add" onclick="addSupplierRow()" title="í˜‘ë ¥ì—…ì²´ ì¶”ê°€">
                                        <i class="fas fa-plus"></i> í˜‘ë ¥ì—…ì²´ ì¶”ê°€
                                    </button>
                                </div>
                                
                                <div class="supplier-mapping-container" style="border: 1px solid #ddd; border-radius: 5px; padding: 10px; max-height: 400px; overflow-y: auto;">
                                    <div id="supplier-rows-container">
                                        <!-- ì²« ë²ˆì§¸ í–‰ì€ JavaScriptë¡œ ì¶”ê°€ë¨ -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ê³µí†µ ì„¤ì • -->
                            
                            <div class="form-group">
                                <label>íŠ¹ì´ì‚¬í•­ (ëª¨ë“  í˜‘ë ¥ì—…ì²´ì— ê³µí†µ ì ìš©)</label>
                                <textarea id="mapping-notes" rows="3" placeholder="ê³„ì•½ ì¡°ê±´, íŠ¹ì´ì‚¬í•­ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeMappingModal()">ì·¨ì†Œ</button>
                        <button type="button" class="btn-primary" onclick="saveMapping()">ì €ì¥</button>
                    </div>
                </div>
            </div>

            <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
            <div id="image-modal" class="modal hidden">
                <div class="modal-content" style="max-width: 90vw; max-height: 90vh; overflow: auto;">
                    <div class="modal-header">
                        <h3 id="image-modal-title">ì´ë¯¸ì§€ ë³´ê¸°</h3>
                        <button class="modal-close" onclick="closeImageModal()">&times;</button>
                    </div>
                    <div class="modal-body" style="text-align: center; padding: 0;">
                        <img id="image-modal-img" src="" alt="" style="width: 100%; height: auto; max-width: 100%; display: block;">
                    </div>
                </div>
            </div>

            <div id="ingredients-page" class="page-content hidden">
                <div class="page-header">
                    <h2>ì‹ìì¬/ì—…ì²´ ê´€ë¦¬</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showUploadSection()">
                            <span class="icon">ğŸ“</span>íŒŒì¼ ì—…ë¡œë“œ
                        </button>
                        <button class="btn btn-secondary" onclick="downloadTemplate()">
                            <span class="icon">ğŸ“‹</span>ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button class="btn btn-secondary" onclick="showUploadHistory()" style="background: #28a745; margin-left: 10px;">
                            <span class="icon">ğŸ“Š</span>ì—…ë¡œë“œ ê²°ê³¼ ì¡°íšŒ
                        </button>
                        <button class="btn btn-secondary" onclick="initSupplierExtensions()" style="background: #17a2b8; margin-left: 10px;">
                            <span class="icon">âš™ï¸</span>ì—…ì²´ ê´€ë¦¬ í™•ì¥
                        </button>
                    </div>
                </div>
                
                <!-- íƒ­ ë©”ë‰´ -->
                <div class="tab-menu" style="display: flex; margin: 20px 0; border-bottom: 1px solid #ddd;">
                    <button class="tab-button active" onclick="showIngredientTab()" style="padding: 10px 20px; border: none; background: #f8f9fa; cursor: pointer; border-bottom: 2px solid #007bff;">
                        <span class="icon">ğŸ¥¬</span>ì‹ìì¬ ê´€ë¦¬
                    </button>
                </div>

                <div id="ingredient-tab-content" class="tab-content">
                    <!-- ìƒ˜í”Œ ì´ë¯¸ì§€ í‘œì‹œ -->
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="flex: 1;">
                            <h3 style="margin-top: 0; color: #007bff;">ğŸ“Š ì—…ë¡œë“œ ì–‘ì‹ ì˜ˆì‹œ</h3>
                            <div style="border: 2px solid #ddd; border-radius: 5px; overflow: hidden; background: white; cursor: pointer; position: relative;" onclick="openImageModal('/static/sample data/ì‹œìŠ¤í…œ32.JPG', 'ì‹ìì¬ ì—…ë¡œë“œ ì–‘ì‹ ì˜ˆì‹œ')">
                                <img src="/static/sample data/ì‹œìŠ¤í…œ32.JPG" alt="ì‹ìì¬ ì—…ë¡œë“œ ì–‘ì‹ ì˜ˆì‹œ" 
                                     style="width: 100%; height: 400px; object-fit: contain; display: block; transition: transform 0.2s;" 
                                     onmouseover="this.style.transform='scale(1.02)'"
                                     onmouseout="this.style.transform='scale(1)'"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div style="display: none; padding: 20px; text-align: center; color: #666;">
                                    <p>ğŸ–¼ï¸ ìƒ˜í”Œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                                    <p>ê²½ë¡œ: /static/sample data/ì‹œìŠ¤í…œ32.JPG</p>
                                </div>
                                <div style="position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 3px; font-size: 12px;">
                                    ğŸ” í´ë¦­í•˜ë©´ í¬ê²Œ ë³´ê¸°
                                </div>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="margin-top: 0; color: #28a745;">ğŸ“‹ ì—…ë¡œë“œ ì–‘ì‹ í•­ëª©ë³„ ì„¤ëª…</h3>
                            <div style="background: white; padding: 15px; border-radius: 5px; border: 1px solid #e9ecef;">
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ë¶„ë¥˜:</strong> í…ìŠ¤íŠ¸ ëª¨ë‘ í—ˆìš©
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ê¸°ë³¸ ì‹ìì¬(ì„¸ë¶„ë¥˜):</strong> í…ìŠ¤íŠ¸ ëª¨ë‘ í—ˆìš©
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ê³ ìœ ì½”ë“œ:</strong> <span style="color: #dc3545;">ì˜ë¬¸+ìˆ«ìë§Œ</span>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ì‹ìì¬ëª…:</strong> í…ìŠ¤íŠ¸ ëª¨ë‘ í—ˆìš©
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ì›ì‚°ì§€:</strong> ë¹ˆê°’í—ˆìš©, í…ìŠ¤íŠ¸+ìˆ«ì
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ê²Œì‹œìœ ë¬´:</strong> ìœ (ê²Œì‹œ), ë¬´(ì£¼ë¬¸ë¶ˆê°€), ë¹ˆê°’í—ˆìš©
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ë©´ì„¸:</strong> Full tax(ê³¼ì„¸), No tax(ë©´ì„¸), ë¹ˆê°’í—ˆìš©
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #495057;">ì„ ë°œì£¼ì¼:</strong> D-1,1,+1â†’'1', D-2,2,+2â†’'2', D-3,3,+3â†’'3'
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì—…ë¡œë“œ ê²°ê³¼ ì¡°íšŒ ì„¹ì…˜ -->
                    <div id="upload-history-section" class="upload-history-section" style="display: none; background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #007bff;">ğŸ“Š ì—…ë¡œë“œ ê²°ê³¼ ì¡°íšŒ</h3>
                            <button onclick="hideUploadHistory()" style="background: #6c757d; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
                                âœ– ë‹«ê¸°
                            </button>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                            <div>
                                <label style="font-weight: bold; margin-right: 10px;">ì—…ì²´ë³„ ì¡°íšŒ:</label>
                                <select id="supplier-filter" onchange="filterUploadHistory()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; margin-right: 15px;">
                                    <option value="">ì „ì²´ ì—…ì²´</option>
                                    <option value="ì›°ìŠ¤í† ë¦¬">ì›°ìŠ¤í† ë¦¬</option>
                                    <option value="ì‚¼ì„±ì›°ìŠ¤í† ë¦¬">ì‚¼ì„±ì›°ìŠ¤í† ë¦¬</option>
                                    <option value="ê¸°íƒ€ì—…ì²´">ê¸°íƒ€ì—…ì²´</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-weight: bold; margin-right: 10px;">ê¸°ê°„:</label>
                                <input type="date" id="date-from" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 5px;">
                                <span>~</span>
                                <input type="date" id="date-to" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-left: 5px;">
                            </div>
                            <button onclick="searchUploadHistory()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                ğŸ” ì¡°íšŒ
                            </button>
                        </div>
                        
                        <!-- ì—…ë¡œë“œ ê²°ê³¼ í…Œì´ë¸” -->
                        <div style="overflow-x: auto;">
                            <table id="upload-history-table" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ì—…ë¡œë“œì¼</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ê±°ë˜ì²˜ëª…</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">íŒŒì¼ëª…</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ì´ í•­ëª©ìˆ˜</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ì„±ê³µ</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ì‹¤íŒ¨</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ìƒíƒœ</th>
                                        <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">ìƒì„¸</th>
                                    </tr>
                                </thead>
                                <tbody id="upload-history-tbody">
                                    <!-- ìƒ˜í”Œ ë°ì´í„° -->
                                    <tr>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">2024-12-10</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">ì›°ìŠ¤í† ë¦¬</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px;">food_sample_20241210.xls</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">150</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center; color: #28a745; font-weight: bold;">148</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center; color: #dc3545; font-weight: bold;">2</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                                            <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì™„ë£Œ</span>
                                        </td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                                            <button onclick="showUploadDetails(1)" style="padding: 4px 8px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                                ìƒì„¸ë³´ê¸°
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">2024-12-08</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">ì‚¼ì„±ì›°ìŠ¤í† ë¦¬</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px;">samsung_ingredients.xlsx</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">200</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center; color: #28a745; font-weight: bold;">195</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center; color: #dc3545; font-weight: bold;">5</td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                                            <span style="background: #ffc107; color: #212529; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì¼ë¶€ì‹¤íŒ¨</span>
                                        </td>
                                        <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                                            <button onclick="showUploadDetails(2)" style="padding: 4px 8px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                                ìƒì„¸ë³´ê¸°
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- ì—…ë¡œë“œ ì ê²€ ê²°ê³¼ ìƒì„¸ -->
                        <div id="upload-details-section" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
                            <h4 style="color: #007bff; margin-top: 0;">ğŸ“‹ ì—…ë¡œë“œ ì ê²€ ê²°ê³¼</h4>
                            <div id="upload-details-content">
                                <!-- ìƒì„¸ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì—…ë¡œë“œ ì£¼ì˜ì‚¬í•­ -->
                    <div class="upload-notice" style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #856404; margin-top: 0;">âš ï¸ ì—‘ì…€íŒŒì¼ ìˆ˜ì • ì£¼ì˜ì‚¬í•­!</h3>
                        <div class="notice-content">
                            <p style="margin-bottom: 15px;">ì‹ìì¬ ë“±ë¡ì„ ìœ„í•œ ë‹¤ìš´ë¡œë“œ ì–‘ì‹ ë° ê° ì‹ìì¬ ì •ë³´ë§Œ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°í•©ë‹ˆë‹¤. ì•„ë˜ ì£¼ì˜ì‚¬í•­ì„ ê¼­ ì¤€ìˆ˜í•˜ì„¸ìš”.</p>
                            <div style="margin-top: 15px;">
                                <a href="/ingredient_registration_management" class="btn btn-primary" style="padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
                                    <i class="fas fa-leaf"></i> ì‹ìì¬ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
                                </a>
                            </div>
                            
                            <div class="warning-item" style="margin-bottom: 15px; padding-left: 20px;">
                                <strong style="color: #721c24;">1. ì²«ë²ˆì§¸í–‰ ìˆ˜ì • ê¸ˆì§€</strong>
                                <p style="margin: 5px 0;">ì»¬ëŸ¼ëª…, ê¸°ë³¸ ì‹ìì¬, ê³ ìœ ì½”ë“œ ë“± ì •í™•í•œ ì–‘ì‹ ê¸°ì¤€ì •ë³´ë¥¼ ìˆ˜ì •í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.</p>
                            </div>
                            
                            <div class="warning-item" style="margin-bottom: 15px; padding-left: 20px;">
                                <strong style="color: #721c24;">2. ì‹œíŠ¸ëª…ì¹­, ì‹œíŠ¸ ì¶”ê°€ ë“± ê¸ˆì§€</strong>
                                <p style="margin: 5px 0;">ë‹¤ë¥¸ ëª©ì ì˜ ì—‘ì…€ê³¼ í•©ë³¸ ë° ìˆ˜ì • ì•ˆë©ë‹ˆë‹¤. ì–‘ì‹ì„ ìœ„í•œ êµ¬ì¡°ê°€ ë³€ê²½ë˜ë©´ ì•ˆë©ë‹ˆë‹¤.</p>
                                <p style="margin: 5px 0; font-style: italic;">êµ¬ì¡° ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ì—¬ ì¼ê´„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
                            </div>
                            
                            <div class="warning-item" style="padding-left: 20px;">
                                <strong style="color: #721c24;">3. ì—…ë¡œë“œ ì£¼ê¸° ì•ˆë‚´</strong>
                                <p style="margin: 5px 0;">â€¢ ëŒ€ë¶€ë¶„ì˜ ì‹ì¬ë£Œì—…ì²´: <span style="color: #007bff; font-weight: bold;">2ì£¼ë§ˆë‹¤</span> ë‹¨ê°€ ì—…ë¡œë“œ</p>
                                <p style="margin: 5px 0;">â€¢ ì‚¼ì„±ì›°ìŠ¤í† ë¦¬: <span style="color: #007bff; font-weight: bold;">3ì£¼ë§ˆë‹¤</span> ë‹¨ê°€ ì—…ë¡œë“œ</p>
                            </div>
                        </div>
                    </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
                <div id="upload-section" class="upload-section" style="display: none;">
                    <div class="upload-container">
                        <div class="upload-area" onclick="document.getElementById('file-input').click()">
                            <div class="upload-icon">ğŸ“</div>
                            <div class="upload-text">
                                <h4>íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”</h4>
                                <p>ì§€ì› í˜•ì‹: .xlsx, .xls (ìµœëŒ€ 10MB)</p>
                            </div>
                        </div>
                        <input type="file" id="file-input" accept=".xlsx,.xls" multiple style="display: none;" onchange="handleFileSelect(event)">
                        
                        <div class="upload-progress" id="upload-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <div class="progress-text" id="progress-text">ì—…ë¡œë“œ ì¤‘...</div>
                        </div>
                        
                        <div id="selected-files-list" style="margin-top: 20px;">
                            <p style="color: #666; text-align: center; padding: 20px;">ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                    
                    <div class="upload-actions">
                        <button class="btn btn-primary" onclick="uploadFiles()" id="upload-btn" disabled>
                            ì—…ë¡œë“œ ì‹œì‘
                        </button>
                        <button class="btn btn-secondary" onclick="clearFiles()">
                            íŒŒì¼ ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>

                <!-- ì—…ë¡œë“œ ê²°ê³¼ -->
                <div id="upload-results" class="upload-results" style="display: none;">
                    <h3>ì—…ë¡œë“œ ê²°ê³¼</h3>
                    <div class="result-summary">
                        <div class="result-item success">
                            <span class="result-label">ì„±ê³µ:</span>
                            <span class="result-count" id="success-count">0</span>ê°œ íŒŒì¼
                        </div>
                        <div class="result-item error">
                            <span class="result-label">ì‹¤íŒ¨:</span>
                            <span class="result-count" id="error-count">0</span>ê°œ íŒŒì¼
                        </div>
                    </div>
                    
                    <div class="result-details" id="result-details">
                        <!-- ìƒì„¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <div class="ingredients-list" style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">ë“±ë¡ëœ ì‹ìì¬ ëª©ë¡</h3>
                    <p style="margin-bottom: 15px; color: #666;">ë“±ë¡ëœ ì‹ìì¬ ëª©ë¡ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    <div style="display: flex; gap: 10px;">
                        <a href="/ingredients" target="_blank" class="btn btn-primary" style="padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
                            <i class="fas fa-list"></i> ì‹ìì¬ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
                        </a>
                        <button class="btn btn-secondary" onclick="window.open('/ingredients', '_blank')" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-external-link-alt"></i> ìƒˆ ì°½ì—ì„œ ì—´ê¸°
                        </button>
                    </div>
                    <p style="margin-top: 15px; font-size: 12px; color: #999;">
                        â€» ì‹ìì¬ ëª©ë¡ í˜ì´ì§€ì—ì„œ ê²€ìƒ‰, í•„í„°ë§, í˜ì´ì§€ë„¤ì´ì…˜ ë“± ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                </div>
                
            </div>


            <!-- ì‹ìˆ˜ ë“±ë¡ ê´€ë¦¬ í˜ì´ì§€ -->

            <div id="pricing-page" class="page-content hidden">
                <h2>ğŸ’° ë‹¨ê°€ ê´€ë¦¬</h2>
                <p style="color: #666; margin-bottom: 30px;">ë¼ë‹ˆë‹¹ íŒë§¤ê°€ì™€ ëª©í‘œ ì‹ì¬ë£Œë¹„ë¥¼ ì„¤ì •í•˜ì—¬ íšŒì‚¬ ìˆ˜ìµì„ ì¶”ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                
                <div class="pricing-controls" style="margin-bottom: 30px; display: flex; gap: 15px; align-items: center;">
                    <select id="pricing-customer-select" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                        <option value="">ì‚¬ì—…ì¥ ì„ íƒ</option>
                    </select>
                    <select id="pricing-meal-type-filter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="all">ëª¨ë“  êµ¬ë¶„</option>
                        <option value="ë„ì‹œë½">ë„ì‹œë½</option>
                        <option value="ìš´ë°˜">ìš´ë°˜</option>
                        <option value="í•™êµ">í•™êµ</option>
                        <option value="ìš”ì–‘ì›">ìš”ì–‘ì›</option>
                        <option value="ìœ„íƒ">ìœ„íƒ</option>
                        <option value="ì¼ë°˜ìŒì‹ì ">ì¼ë°˜ìŒì‹ì </option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                    <button onclick="loadPricingData()" style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-search"></i> ì¡°íšŒ
                    </button>
                    <button onclick="savePricingData()" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-save"></i> ì €ì¥
                    </button>
                </div>

                <div class="pricing-table-container" style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="pricing-summary" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">ì´ ì„¤ì • í•­ëª©</div>
                            <div id="total-items" style="font-size: 24px; font-weight: bold; color: #2c3e50;">0</div>
                        </div>
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">í‰ê·  íŒë§¤ê°€</div>
                            <div id="avg-price" style="font-size: 24px; font-weight: bold; color: #27ae60;">0ì›</div>
                        </div>
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">í‰ê·  ì¬ë£Œë¹„</div>
                            <div id="avg-cost" style="font-size: 24px; font-weight: bold; color: #f39c12;">0ì›</div>
                        </div>
                        <div class="summary-card" style="text-align: center; padding: 15px; background: #d1ecf1; border-radius: 6px;">
                            <div style="font-size: 14px; color: #666;">í‰ê·  ìˆ˜ìµë¥ </div>
                            <div id="avg-margin" style="font-size: 24px; font-weight: bold; color: #17a2b8;">0%</div>
                        </div>
                    </div>

                    <div class="pricing-table-wrapper" style="overflow-x: auto;">
                        <table id="pricing-table" style="width: 100%; border-collapse: collapse; min-width: 800px;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left; font-weight: 600;">ì‚¬ì—…ì¥ëª…</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left; font-weight: 600;">êµ¬ë¶„</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left; font-weight: 600;">ì‹ì‚¬ êµ¬ë¶„</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">íŒë§¤ê°€ (ì›)</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">ëª©í‘œ ì¬ë£Œë¹„ (ì›)</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">ìˆ˜ìµë¥  (%)</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: 600;">ìˆ˜ì •ì¼</th>
                                </tr>
                            </thead>
                            <tbody id="pricing-table-body">
                                <tr>
                                    <td colspan="7" style="padding: 40px; text-align: center; color: #666;">
                                        ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ê³  ì¡°íšŒ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="pricing-help" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                    <h4 style="margin: 0 0 10px 0; color: #2c3e50;">ğŸ’¡ ì‚¬ìš© ê°€ì´ë“œ</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #555;">
                        <li>íŒë§¤ê°€: í•´ë‹¹ ë¼ë‹ˆì˜ ì‹¤ì œ íŒë§¤ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.</li>
                        <li>ëª©í‘œ ì¬ë£Œë¹„: í•´ë‹¹ íŒë§¤ê°€ì— ë§ëŠ” ëª©í‘œ ì‹ì¬ë£Œ ë¹„ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</li>
                        <li>ìˆ˜ìµë¥ ì€ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤: ((íŒë§¤ê°€ - ì¬ë£Œë¹„) / íŒë§¤ê°€) Ã— 100</li>
                        <li>ë¹ˆ ê°’ìœ¼ë¡œ ë‘ë©´ í•´ë‹¹ í•­ëª©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                        <li>ì´ ë°ì´í„°ëŠ” íšŒì‚¬ì˜ ìˆ˜ìµ ì¶”ì •ì„ ìœ„í•œ ìë£Œë¡œ í™œìš©ë©ë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>

            <div id="settings-page" class="page-content hidden">
                <h2>ì‹œìŠ¤í…œ ì„¤ì • í˜ì´ì§€</h2>
                <p>ì‹œìŠ¤í…œ ì„¤ì • ê¸°ëŠ¥ì´ ì—¬ê¸°ì— êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>


            <div id="meal-pricing-page" class="page-content hidden">
                <h2>ğŸ’° ì‹ë‹¨ê°€ ê´€ë¦¬</h2>
                <p style="color: #666; margin-bottom: 30px;">ë¶€ë¬¸ë³„ ì‹ë‹¨í‘œì˜ ì„¸ë¶€ì‹ë‹¨í‘œë³„ íŒë§¤ê°€ ë° ì¬ë£Œë¹„ ê°€ì´ë“œë¼ì¸ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                
                <!-- ì‚¬ì—…ì¥ ì„ íƒ -->
                <div class="section-card" style="margin-bottom: 30px;">
                    <h3>ğŸ¢ ì‚¬ì—…ì¥ ì„ íƒ</h3>
                    <div style="display: flex; gap: 15px; align-items: center; margin-top: 15px; flex-wrap: wrap;">
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            <label style="font-size: 12px; color: #666; font-weight: 500;">ì‚¬ì—…ì¥ ì„ íƒ</label>
                            <select id="businessLocationSelect" onchange="loadMealPlansForLocation()" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 200px;">
                                <option value="">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ì„¸ë¶€ì‹ë‹¨í‘œ ê´€ë¦¬ -->
                <div class="section-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ“‹ ì„¸ë¶€ì‹ë‹¨í‘œ ê´€ë¦¬</h3>
                        <button id="addMealPlanBtn" onclick="addNewMealPlan()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; display: none;">
                            <i class="fas fa-plus"></i> ì‹ë‹¨í‘œ ì¶”ê°€
                        </button>
                    </div>
                    
                    <div id="mealPlansContainer" style="margin-top: 20px;">
                        <p style="color: #888; text-align: center; padding: 40px;">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ë©´ ì„¸ë¶€ì‹ë‹¨í‘œ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>

                <!-- ì €ì¥ ë²„íŠ¼ -->
                <div style="text-align: center; margin-top: 30px;">
                    <button id="saveMealPricingBtn" onclick="saveMealPricing()" 
                            style="padding: 12px 30px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">
                        ğŸ’¾ ê°€ê²© ì •ë³´ ì €ì¥
                    </button>
                </div>
                
                <div class="section-card" style="margin-top: 30px;">
                    <h3>ğŸ“‹ ë“±ë¡ëœ ì‹ë‹¨ê°€ ëª©ë¡</h3>
                    <div id="meal-pricing-list" style="margin-top: 15px;">
                        <p style="color: #888;">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
                        <div class="instruction-card" style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #e74c3c;">
                            <h4>ğŸ”ª ì „ì²˜ë¦¬ ì§€ì‹œì„œ</h4>
                            <p style="color: #666; margin: 10px 0;">ì‹ì¬ë£Œ ì „ì²˜ë¦¬ ì‘ì—… ì§€ì‹œì„œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                            <div style="margin-top: 15px;">
                                <button onclick="window.open('preprocessing_management.html', '_blank')" style="padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                    ê´€ë¦¬
                                </button>
                                <button onclick="generatePreprocessingInstruction()" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    ì¼ê´„ìƒì„±
                                </button>
                            </div>
                        </div>
                        
                        <div class="instruction-card" style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #f39c12;">
                            <h4>ğŸ³ ì¡°ë¦¬ ì§€ì‹œì„œ</h4>
                            <p style="color: #666; margin: 10px 0;">ì¡°ë¦¬ ì‘ì—… ì§€ì‹œì„œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                            <div style="margin-top: 15px;">
                                <button onclick="window.open('cooking_instruction_management.html', '_blank')" style="padding: 8px 16px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                    ê´€ë¦¬
                                </button>
                                <button onclick="generateCookingInstruction()" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    ì¼ê´„ìƒì„±
                                </button>
                            </div>
                        </div>
                        
                        <div class="instruction-card" style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #27ae60;">
                            <h4>ğŸ“¦ ì†Œë¶„ ì§€ì‹œì„œ</h4>
                            <p style="color: #666; margin: 10px 0;">ì†Œë¶„ ì‘ì—… ì§€ì‹œì„œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                            <div style="margin-top: 15px;">
                                <button onclick="window.open('portion_instruction_management.html', '_blank')" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                    ê´€ë¦¬
                                </button>
                                <button onclick="generatePortionInstruction()" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    ì¼ê´„ìƒì„±
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4>ğŸ”„ í†µí•© ì‘ì—… íë¦„</h4>
                        <p style="color: #666; margin: 10px 0;">ë§ˆìŠ¤í„° ì‹ë‹¨í‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ì§€ì‹œì„œë¥¼ í•œë²ˆì— ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <div style="margin-top: 15px;">
                            <button onclick="generateAllInstructions()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                                <i class="fas fa-magic"></i> ëª¨ë“  ì§€ì‹œì„œ ì¼ê´„ ìƒì„±
                            </button>
                            <select id="instruction-date-select" style="padding: 12px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option>ìƒì„±í•  ë‚ ì§œ ì„ íƒ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ì¼ê´„ ìƒì„±/ê´€ë¦¬ íƒ­ -->
                <div id="batch-tab" class="meal-plan-tab-content hidden">
                    <h3>ğŸš€ ì¼ê´„ ìƒì„±/ê´€ë¦¬</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin: 20px 0;">
                        <h4>ğŸ“… ê¸°ê°„ë³„ ì‹ë‹¨í‘œ ì¼ê´„ ìƒì„±</h4>
                        <div style="display: flex; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
                            <div>
                                <label>ì‹œì‘ì¼:</label>
                                <input type="date" id="batch-start-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label>ì¢…ë£Œì¼:</label>
                                <input type="date" id="batch-end-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label>ëŒ€ìƒ:</label>
                                <select id="batch-target-type" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">ì „ì²´</option>
                                    <option value="dosirak">ë„ì‹œë½</option>
                                    <option value="transport">ìš´ë°˜</option>
                                    <option value="school">í•™êµ</option>
                                    <option value="care">ìš”ì–‘ì›</option>
                                </select>
                            </div>
                            <button onclick="batchGenerateMealPlans()" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-rocket"></i> ì¼ê´„ ìƒì„±
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4>ğŸ“Š í…œí”Œë¦¿ ê¸°ë°˜ ìƒì„±</h4>
                        <p style="color: #666; margin-bottom: 15px;">ê¸°ì¡´ ì‹ë‹¨í‘œë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ í™œìš©í•˜ì—¬ ìƒˆë¡œìš´ ì‹ë‹¨í‘œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select id="template-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                                <option>í…œí”Œë¦¿ ì„ íƒ...</option>
                            </select>
                            <input type="date" id="template-target-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <button onclick="createFromTemplate()" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-copy"></i> í…œí”Œë¦¿ìœ¼ë¡œ ìƒì„±
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            <div id="logs-page" class="page-content hidden">
                <h2>ë¡œê·¸ ê´€ë¦¬ í˜ì´ì§€</h2>
                <p>ë¡œê·¸ ê´€ë¦¬ ê¸°ëŠ¥ì´ ì—¬ê¸°ì— êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>
        </main>
    </div>

    <script>
        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ê´€ë¦¬
        function showPage(pageName) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // ì„ íƒëœ í˜ì´ì§€ ë³´ì´ê¸°
            const targetPage = document.getElementById(`${pageName}-page`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
            
            // ë„¤ë¹„ê²Œì´ì…˜ í™œì„± ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[data-page="${pageName}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // í˜ì´ì§€ ì œëª© ë³€ê²½
            const titles = {
                'dashboard': 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ',
                'users': 'ì‚¬ìš©ì ê´€ë¦¬',
                'suppliers': 'ì—…ì²´ ê´€ë¦¬',
                'business-locations': 'ì‚¬ì—…ì¥ ê´€ë¦¬',
                'supplier-mapping': 'í˜‘ë ¥ì—…ì²´ ë§¤í•‘',
                'meal-pricing': 'ì‹ë‹¨ê°€ ê´€ë¦¬',
                'ingredients': 'ì‹ìì¬ ê´€ë¦¬',
                'pricing': 'ë‹¨ê°€ ê´€ë¦¬',
                'settings': 'ì‹œìŠ¤í…œ ì„¤ì •',
                'logs': 'ë¡œê·¸ ê´€ë¦¬'
            };
            
            document.getElementById('page-title').textContent = titles[pageName] || 'ê´€ë¦¬ì ì‹œìŠ¤í…œ';
        }


        // ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                // target="_blank"ê°€ ìˆëŠ” ë§í¬ëŠ” ìƒˆ íƒ­ì—ì„œ ì—´ë¦¬ë„ë¡ í—ˆìš©
                if (e.currentTarget.getAttribute('target') === '_blank') {
                    return; // ê¸°ë³¸ ë™ì‘ í—ˆìš©
                }
                
                // hrefê°€ ìˆëŠ” ì™¸ë¶€ ë§í¬(í˜‘ë ¥ì—…ì²´ ê´€ë¦¬, ì‚¬ì—…ì¥ ê´€ë¦¬, ê¸‰ì‹ê´€ë¦¬ë¡œ ì´ë™)ëŠ” ê¸°ë³¸ ë™ì‘ í—ˆìš©
                const href = e.currentTarget.getAttribute('href');
                if (href && (href.startsWith('/admin/suppliers') || href.startsWith('/admin/business-locations') || href === '/')) {
                    return; // ê¸°ë³¸ ë™ì‘ í—ˆìš©
                }
                
                e.preventDefault();
                const pageName = e.currentTarget.getAttribute('data-page');
                showPage(pageName);
                
                // í˜ì´ì§€ë³„ ì´ˆê¸°í™”
                if (pageName === 'users') {
                    loadUsers();
                    loadManagedSites();
                } else if (pageName === 'suppliers') {
                    loadSuppliers();
                } else if (pageName === 'business-locations') {
                    loadSitesTree();
                } else if (pageName === 'meal-pricing') {
                    // ì‹ë‹¨ê°€ ê´€ë¦¬ í˜ì´ì§€ ì´ˆê¸°í™”
                    if (typeof loadBusinessLocationsForMealPricing === 'function') {
                        loadBusinessLocationsForMealPricing();
                    } else {
                        // í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ì§ì ‘ ì‹¤í–‰
                        loadBusinessLocationsForMealPricingDirect();
                    }
                } else if (pageName === 'ingredients') {
                    // ì‹ìì¬ ê´€ë¦¬ í˜ì´ì§€ ì´ˆê¸°í™”
                    // ì‹ìì¬ ëª©ë¡ì€ ë³„ë„ í˜ì´ì§€(/ingredients)ì—ì„œ ê´€ë¦¬
                    loadUploadHistory();
                    if (window.initializeIngredientsPage) {
                        window.initializeIngredientsPage();
                    }
                }
            });
        });

        // ì´ë¯¸ì§€ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function openImageModal(imageSrc, title) {
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('image-modal-img');
            const modalTitle = document.getElementById('image-modal-title');
            
            modalImg.src = imageSrc;
            modalImg.alt = title;
            modalTitle.textContent = title;
            modal.classList.remove('hidden');
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', handleImageModalEsc);
        }
        
        function closeImageModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.add('hidden');
            
            // ESC í‚¤ ì´ë²¤íŠ¸ ì œê±°
            document.removeEventListener('keydown', handleImageModalEsc);
        }
        
        function handleImageModalEsc(event) {
            if (event.key === 'Escape') {
                closeImageModal();
            }
        }
        
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('image-modal');
            if (event.target === modal) {
                closeImageModal();
            }
        });

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const response = await fetch('/api/auth/logout', {
                        method: 'POST',
                        credentials: 'include'  // ì¿ í‚¤ í¬í•¨
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        window.location.href = result.redirect || '/login';
                    } else {
                        console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', result.message);
                        window.location.href = '/login';  // ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    }
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
                    window.location.href = '/login';  // ì˜¤ë¥˜ ì‹œì—ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                }
            }
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        async function loadDashboardData() {
            try {
                // í†µê³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/admin/dashboard-stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('total-users').textContent = data.totalUsers || 0;
                    document.getElementById('total-sites').textContent = data.totalSites || 0;
                    document.getElementById('today-menus').textContent = data.todayMenus || 0;
                    document.getElementById('price-updates').textContent = data.priceUpdates || 0;
                }
            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ìµœê·¼ í™œë™ ë¡œê·¸ ë¡œë“œ
        async function loadRecentActivity() {
            try {
                const response = await fetch('/api/admin/recent-activity');
                const result = await response.json();
                const activities = result.activities || result.data || [];
                
                const activityList = document.getElementById('activity-list');
                if (activities.length === 0) {
                    activityList.innerHTML = '<div class="log-item">ìµœê·¼ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                activityList.innerHTML = activities.map(activity => `
                    <div class="log-item">
                        <div class="log-time">${activity.time}</div>
                        <div class="log-message">${activity.message}</div>
                        <div class="log-user">${activity.user}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('í™œë™ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('activity-list').innerHTML = 
                    '<div class="log-item">í™œë™ ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì „ì—­ ë³€ìˆ˜ë“¤
        let pageInitialized = false;
        let allowModalDisplay = false;

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            console.log('í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');
            
            // ê°•ì œë¡œ ëª¨ë“  ëª¨ë‹¬ ìˆ¨ê¹€ ì²˜ë¦¬
            setTimeout(() => {
                const userModal = document.getElementById('user-modal');
                const siteModal = document.getElementById('site-modal');
                
                if (userModal) {
                    userModal.style.display = 'none';
                    userModal.classList.add('hidden');
                    console.log('ì‚¬ìš©ì ëª¨ë‹¬ ê°•ì œ ìˆ¨ê¹€');
                }
                if (siteModal) {
                    siteModal.style.display = 'none';
                    siteModal.classList.add('hidden');
                    console.log('ì‚¬ì—…ì¥ ëª¨ë‹¬ ê°•ì œ ìˆ¨ê¹€');
                }
                
                // ë³€ìˆ˜ ì´ˆê¸°í™”
                if (typeof currentEditUserId !== 'undefined') {
                    currentEditUserId = null;
                }
                if (typeof currentEditSiteId !== 'undefined') {
                    currentEditSiteId = null;
                }
                
                console.log('ëª¨ë“  ëª¨ë‹¬ ìˆ¨ê¹€ ì²˜ë¦¬ ì™„ë£Œ');
                
                // ì´ˆê¸°í™” ì™„ë£Œ í›„ 1ì´ˆ ë’¤ì— ëª¨ë‹¬ í‘œì‹œ í—ˆìš©
                setTimeout(() => {
                    pageInitialized = true;
                    allowModalDisplay = true;
                    console.log('ëª¨ë‹¬ í‘œì‹œ í—ˆìš©ë¨');
                }, 1000);
            }, 100);
            
            // ê¸°ë³¸ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ í‘œì‹œ
            console.log('ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ í‘œì‹œ');
            showPage('dashboard');
            loadDashboardData();
            loadRecentActivity();
        });

        // ì‚¬ìš©ì ê´€ë¦¬ ê´€ë ¨ ë³€ìˆ˜
        let currentPage = 1;
        let totalPages = 1;
        let currentEditUserId = null;

        // ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤

        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ (í¬íŠ¸ 8002 ì„œë²„ ì‚¬ìš©)
        async function loadUsers() {
            try {
                console.log('[LoadUsers] ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹œì‘...');
                const response = await fetch('http://127.0.0.1:8001/api/admin/users');
                const data = await response.json();
                
                if (data.success) {
                    displayUsers(data.users);
                    updatePagination(data.currentPage, data.totalPages);
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('users-table-body').innerHTML = 
                    '<tr><td colspan="8">ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        // ì‚¬ìš©ì ëª©ë¡ í‘œì‹œ
        function displayUsers(users) {
            const tbody = document.getElementById('users-table-body');
            
            if (!users || users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map((user, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td><strong>${user.name || user.username}</strong><br><small>${user.username}</small></td>
                    <td>${user.role}</td>
                    <td>${user.department || '-'}</td>
                    <td>-</td>
                    <td>-</td>
                    <td>${user.created_at || '-'}</td>
                    <td>
                        <button class="btn-small btn-edit">ìˆ˜ì •</button>
                        <button class="btn-small btn-delete">ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
        }

        // ì—­í•  í‘œì‹œëª… ë³€í™˜
        function getRoleDisplay(role) {
            const roleMap = {
                'nutritionist': 'ì˜ì–‘ì‚¬',
                'admin': 'ê´€ë¦¬ì', 
                'super_admin': 'ìµœê³ ê´€ë¦¬ì'
            };
            return roleMap[role] || role;
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
        function updatePagination(current, total) {
            currentPage = current;
            totalPages = total;
            document.getElementById('page-info').textContent = `${current} / ${total}`;
        }

        // í˜ì´ì§€ ë³€ê²½
        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                loadUsers();
            }
        }

        // ì‚¬ìš©ì ê²€ìƒ‰
        function searchUsers() {
            const keyword = document.getElementById('user-search').value;
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ê²€ìƒ‰ API í˜¸ì¶œ
            console.log('ê²€ìƒ‰ í‚¤ì›Œë“œ:', keyword);
            loadUsers(); // ì„ì‹œë¡œ ì „ì²´ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
        }

        // ë‹´ë‹¹ ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ
        async function loadManagedSites() {
            try {
                const response = await fetch('/api/admin/sites');
                const result = await response.json();
                const sites = result.sites || result.data || [];
                
                const select = document.getElementById('user-managed-site');
                select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
                
                sites.forEach(site => {
                    select.innerHTML += `<option value="${site.name}">${site.name}</option>`;
                });
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ìƒˆ ì‚¬ìš©ì ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ - ëª¨ë“ˆì—ì„œ ì²˜ë¦¬
        /* function showAddUserModal() {
            currentEditUserId = null;
            document.getElementById('modal-title').textContent = 'ìƒˆ ì‚¬ìš©ì ì¶”ê°€';
            document.getElementById('user-form').reset();
            document.getElementById('user-modal').classList.remove('hidden');
        } */

        // ì‚¬ìš©ì ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
        async function editUser(userId) {
            try {
                const response = await fetch(`/api/admin/users/${userId}`);
                const result = await response.json();
                const user = result.user || result;
                
                if (user) {
                    currentEditUserId = userId;
                    document.getElementById('modal-title').textContent = 'ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •';
                    
                    // í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
                    document.getElementById('user-username').value = user.username;
                    document.getElementById('user-password').value = ''; // ë¹„ë°€ë²ˆí˜¸ëŠ” ë¹„ì›€
                    document.getElementById('user-role').value = user.role;
                    document.getElementById('user-contact').value = user.contact_info || '';
                    document.getElementById('user-department').value = user.department || '';
                    document.getElementById('user-position').value = user.position || '';
                    document.getElementById('user-managed-site').value = user.managed_site || '';
                    document.getElementById('user-operator').checked = user.operator || false;
                    document.getElementById('user-semi-operator').checked = user.semi_operator || false;
                    
                    document.getElementById('user-modal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ëª¨ë‹¬ ë‹«ê¸°
        function closeUserModal() {
            document.getElementById('user-modal').classList.add('hidden');
            currentEditUserId = null;
        }

        // ì‚¬ìš©ì ì €ì¥
        async function saveUser() {
            const userData = {
                username: document.getElementById('user-username').value,
                password: document.getElementById('user-password').value,
                role: document.getElementById('user-role').value,
                contact_info: document.getElementById('user-contact').value,
                department: document.getElementById('user-department').value,
                position: document.getElementById('user-position').value,
                managed_site: document.getElementById('user-managed-site').value,
                operator: document.getElementById('user-operator').checked,
                semi_operator: document.getElementById('user-semi-operator').checked
            };

            try {
                const url = currentEditUserId ? 
                    `/api/admin/users/${currentEditUserId}` : 
                    '/api/admin/users';
                
                const method = currentEditUserId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(currentEditUserId ? 'ì‚¬ìš©ìê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ìƒˆ ì‚¬ìš©ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeUserModal();
                    loadUsers();
                } else {
                    alert(result.message || 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
        async function resetPassword(userId) {
            if (!confirm('ì´ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}/reset-password`, {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(`ë¹„ë°€ë²ˆí˜¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ ë¹„ë°€ë²ˆí˜¸: ${result.newPassword}`);
                } else {
                    alert('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                alert('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ì‚­ì œ
        async function deleteUser(userId) {
            if (!confirm('ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadUsers();
                } else {
                    alert('ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ì—…ì¥ ê´€ë¦¬ ê´€ë ¨ ë³€ìˆ˜
        let sitesData = [];
        let selectedSiteId = null;
        let currentEditSiteId = null;

        // ì‚¬ì—…ì¥ íŠ¸ë¦¬ ë¡œë“œ
        async function loadSitesTree() {
            try {
                const response = await fetch('/api/admin/sites/tree');
                const data = await response.json();
                
                if (data.success) {
                    sitesData = data.sites || [];
                    renderSitesTree();
                } else {
                    console.error('API ì‘ë‹µ ì˜¤ë¥˜:', data.message);
                    const container = document.getElementById('sites-tree');
                    if (container) {
                        container.innerHTML = '<div class="text-center">ì‚¬ì—…ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                }
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ íŠ¸ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                const container = document.getElementById('sites-tree');
                if (container) {
                    container.innerHTML = '<div class="text-center">ì‚¬ì—…ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
        }

        // ì‚¬ì—…ì¥ íŠ¸ë¦¬ ë Œë”ë§
        function renderSitesTree() {
            const pageContainer = document.querySelector('#business-locations-page .sites-container');
            if (pageContainer) {
                // í˜ì´ì§€ ë‚´ sites-containerì— sites-tree ìƒì„±
                pageContainer.innerHTML = '<div class="sites-tree" id="sites-tree"></div>';
            }
            
            const container = document.getElementById('sites-tree');
            if (!container) {
                console.log('sites-tree ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜„ì¬ í˜ì´ì§€ì—ì„œëŠ” ì‚¬ì—…ì¥ íŠ¸ë¦¬ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            container.innerHTML = '';
            
            if (!Array.isArray(sitesData) || sitesData.length === 0) {
                container.innerHTML = '<div class="text-center">ë“±ë¡ëœ ì‚¬ì—…ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ëª¨ë“  ì‚¬ì—…ì¥ ë Œë”ë§ (í—¤ë“œ êµ¬ë¶„ ì—†ì´)
            sitesData.forEach(site => {
                container.appendChild(createTreeNode(site));
            });
        }

        // íŠ¸ë¦¬ ë…¸ë“œ ìƒì„±
        function createTreeNode(site) {
            const nodeDiv = document.createElement('div');
            nodeDiv.className = 'tree-node';
            nodeDiv.dataset.siteId = site.id;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = `tree-node-content ${site.site_type}-site`;
            contentDiv.onclick = () => selectSite(site.id);
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì¶”ê°€
            setupDragAndDrop(contentDiv, site);
            
            // í™•ì¥/ì¶•ì†Œ ë²„íŠ¼
            const expandBtn = document.createElement('button');
            expandBtn.className = 'tree-expand-btn';
            const hasChildren = site.children && site.children.length > 0;
            
            if (hasChildren) {
                expandBtn.className += ' expanded';
                expandBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleNode(site.id);
                };
            } else {
                expandBtn.className += ' no-children';
            }
            
            // ì•„ì´ì½˜
            const iconSpan = document.createElement('span');
            iconSpan.className = 'tree-node-icon';
            iconSpan.textContent = getSiteIcon(site.site_type || 'ì¼ë°˜');
            
            // ë¼ë²¨
            const labelSpan = document.createElement('span');
            labelSpan.className = 'tree-node-label';
            labelSpan.textContent = site.name;
            
            // ìƒíƒœ
            const statusSpan = document.createElement('span');
            statusSpan.className = `tree-node-status ${site.is_active ? 'active' : 'inactive'}`;
            statusSpan.textContent = site.is_active ? 'í™œì„±' : 'ë¹„í™œì„±';
            
            // ì•¡ì…˜ ë²„íŠ¼ë“¤
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'tree-node-actions';
            
            if (site.site_type === 'head') {
                const addDetailBtn = document.createElement('button');
                addDetailBtn.className = 'tree-action-btn add';
                addDetailBtn.textContent = '+ ì„¸ë¶€';
                addDetailBtn.onclick = (e) => {
                    e.stopPropagation();
                    showAddSiteModal('detail', site.id);
                };
                actionsDiv.appendChild(addDetailBtn);
            } else if (site.site_type === 'detail') {
                const addPeriodBtn = document.createElement('button');
                addPeriodBtn.className = 'tree-action-btn add';
                addPeriodBtn.textContent = '+ ê¸°ê°„';
                addPeriodBtn.onclick = (e) => {
                    e.stopPropagation();
                    showAddSiteModal('period', site.id);
                };
                actionsDiv.appendChild(addPeriodBtn);
            }
            
            const editBtn = document.createElement('button');
            editBtn.className = 'tree-action-btn edit';
            editBtn.textContent = 'ìˆ˜ì •';
            editBtn.onclick = (e) => {
                e.stopPropagation();
                editSite(site.id);
            };
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'tree-action-btn delete';
            deleteBtn.textContent = 'ì‚­ì œ';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                deleteSite(site.id);
            };
            
            actionsDiv.appendChild(editBtn);
            actionsDiv.appendChild(deleteBtn);
            
            // ì»¨í…ì¸  ì¡°ë¦½
            contentDiv.appendChild(expandBtn);
            contentDiv.appendChild(iconSpan);
            contentDiv.appendChild(labelSpan);
            contentDiv.appendChild(statusSpan);
            contentDiv.appendChild(actionsDiv);
            
            nodeDiv.appendChild(contentDiv);
            
            // ìì‹ ë…¸ë“œë“¤
            if (hasChildren) {
                const childrenDiv = document.createElement('div');
                childrenDiv.className = 'tree-children';
                site.children.forEach(child => {
                    childrenDiv.appendChild(createTreeNode(child));
                });
                nodeDiv.appendChild(childrenDiv);
            }
            
            return nodeDiv;
        }

        // ì‚¬ì—…ì¥ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸°
        function getSiteIcon(siteType) {
            switch (siteType) {
                case 'head': return 'ğŸ¢';
                case 'detail': return 'ğŸ«';
                case 'period': return 'ğŸ“…';
                default: return 'ğŸ“';
            }
        }

        // ë…¸ë“œ í™•ì¥/ì¶•ì†Œ
        function toggleNode(siteId) {
            const node = document.querySelector(`[data-site-id="${siteId}"]`);
            if (!node) return;
            
            const expandBtn = node.querySelector('.tree-expand-btn');
            const childrenDiv = node.querySelector('.tree-children');
            
            if (!childrenDiv) return;
            
            if (expandBtn.classList.contains('expanded')) {
                expandBtn.className = expandBtn.className.replace('expanded', 'collapsed');
                childrenDiv.classList.add('hidden');
            } else {
                expandBtn.className = expandBtn.className.replace('collapsed', 'expanded');
                childrenDiv.classList.remove('hidden');
            }
        }

        // ëª¨ë“  ë…¸ë“œ í™•ì¥
        function expandAllSites() {
            document.querySelectorAll('.tree-expand-btn.collapsed').forEach(btn => {
                btn.className = btn.className.replace('collapsed', 'expanded');
            });
            document.querySelectorAll('.tree-children.hidden').forEach(children => {
                children.classList.remove('hidden');
            });
        }

        // ëª¨ë“  ë…¸ë“œ ì¶•ì†Œ
        function collapseAllSites() {
            document.querySelectorAll('.tree-expand-btn.expanded').forEach(btn => {
                btn.className = btn.className.replace('expanded', 'collapsed');
            });
            document.querySelectorAll('.tree-children').forEach(children => {
                children.classList.add('hidden');
            });
        }

        // ì‚¬ì—…ì¥ ì„ íƒ
        function selectSite(siteId) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.tree-node-content.selected').forEach(node => {
                node.classList.remove('selected');
            });
            
            // ìƒˆ ì„ íƒ
            const node = document.querySelector(`[data-site-id="${siteId}"] .tree-node-content`);
            if (node) {
                node.classList.add('selected');
                selectedSiteId = siteId;
                showSiteDetails(siteId);
            }
        }

        // ì‚¬ì—…ì¥ ìƒì„¸ì •ë³´ í‘œì‹œ
        async function showSiteDetails(siteId) {
            try {
                const response = await fetch(`/api/admin/sites/${siteId}`);
                const site = await response.json();
                
                const panel = document.getElementById('site-details-panel');
                const content = document.getElementById('site-details-content');
                
                content.innerHTML = `
                    <div class="site-info-group">
                        <div class="site-info-label">ì‚¬ì—…ì¥ëª…</div>
                        <div class="site-info-value">${site.name}</div>
                    </div>
                    <div class="site-info-group">
                        <div class="site-info-label">êµ¬ë¶„</div>
                        <div class="site-info-value">${getSiteTypeDisplay(site.site_type)}</div>
                    </div>
                    <div class="site-info-group">
                        <div class="site-info-label">ë‹´ë‹¹ì</div>
                        <div class="site-info-value">${site.contact_person || '-'}</div>
                    </div>
                    <div class="site-info-group">
                        <div class="site-info-label">ì—°ë½ì²˜</div>
                        <div class="site-info-value">${site.contact_phone || '-'}</div>
                    </div>
                    <div class="site-info-group">
                        <div class="site-info-label">ì£¼ì†Œ</div>
                        <div class="site-info-value">${site.address || '-'}</div>
                    </div>
                    <div class="site-info-group">
                        <div class="site-info-label">1ì¸ë‹¹ ì œê³µëŸ‰</div>
                        <div class="site-info-value">${site.portion_size || 0}g</div>
                    </div>
                    <div class="site-stats">
                        <div class="stat-box">
                            <div class="stat-number">${site.menu_count || 0}</div>
                            <div class="stat-label">ë“±ë¡ëœ ì‹ë‹¨</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">${site.children_count || 0}</div>
                            <div class="stat-label">í•˜ìœ„ ì‚¬ì—…ì¥</div>
                        </div>
                    </div>
                `;
                
                panel.classList.remove('hidden');
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ìƒì„¸ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ì—…ì¥ êµ¬ë¶„ í‘œì‹œëª…
        function getSiteTypeDisplay(siteType) {
            switch (siteType) {
                case 'ë„ì‹œë½': return 'ë„ì‹œë½';
                case 'ìš´ë°˜': return 'ìš´ë°˜';
                case 'í•™êµ': return 'í•™êµ';
                case 'ìš”ì–‘ì›': return 'ìš”ì–‘ì›';
                case 'ìœ„íƒ': return 'ìœ„íƒ';
                case 'ì¼ë°˜ìŒì‹ì ': return 'ì¼ë°˜ìŒì‹ì ';
                case 'ê¸°íƒ€': return 'ê¸°íƒ€';
                // ì´ì „ ë²„ì „ê³¼ì˜ í˜¸í™˜ì„±
                case 'head': return 'í—¤ë“œ ì‚¬ì—…ì¥';
                case 'detail': return 'ì„¸ë¶€ ì‚¬ì—…ì¥';
                case 'period': return 'ê¸°ê°„ë³„ ì‚¬ì—…ì¥';
                default: return siteType || 'ë¯¸ë¶„ë¥˜';
            }
        }

        // ==============================================================================
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
        // ==============================================================================
        
        let draggedElement = null;
        let draggedSite = null;

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
        function setupDragAndDrop(element, site) {
            element.draggable = true;
            
            element.addEventListener('dragstart', (e) => {
                draggedElement = element;
                draggedSite = site;
                element.classList.add('dragging');
                
                // ë“œë˜ê·¸ ë°ì´í„° ì„¤ì •
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', site.id);
                
                console.log('ë“œë˜ê·¸ ì‹œì‘:', site.name);
            });
            
            element.addEventListener('dragend', (e) => {
                element.classList.remove('dragging');
                // ëª¨ë“  ë“œë¡­ ì¸ë””ì¼€ì´í„° ì œê±°
                clearDropIndicators();
                draggedElement = null;
                draggedSite = null;
                
                console.log('ë“œë˜ê·¸ ì¢…ë£Œ');
            });
            
            element.addEventListener('dragover', (e) => {
                if (!draggedSite || draggedSite.id === site.id) return;
                
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                // ìœ íš¨í•œ ë“œë¡­ ëŒ€ìƒì¸ì§€ í™•ì¸
                if (canDropOn(draggedSite, site)) {
                    element.classList.add('drag-over');
                } else {
                    element.classList.add('drop-invalid');
                }
            });
            
            element.addEventListener('dragleave', (e) => {
                element.classList.remove('drag-over', 'drop-invalid');
            });
            
            element.addEventListener('drop', (e) => {
                e.preventDefault();
                element.classList.remove('drag-over', 'drop-invalid');
                
                if (!draggedSite || draggedSite.id === site.id) return;
                
                // ìœ íš¨í•œ ë“œë¡­ì¸ì§€ í™•ì¸
                if (canDropOn(draggedSite, site)) {
                    handleDrop(draggedSite, site);
                } else {
                    console.log('ìœ íš¨í•˜ì§€ ì•Šì€ ë“œë¡­:', draggedSite.name, '->', site.name);
                }
            });
        }

        // ë“œë¡­ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        function canDropOn(draggedSite, targetSite) {
            // ìê¸° ìì‹ ì—ê²ŒëŠ” ë“œë¡­ ë¶ˆê°€
            if (draggedSite.id === targetSite.id) return false;
            
            // ê³„ì¸µ êµ¬ì¡° ê·œì¹™ í™•ì¸
            // head -> detail ë˜ëŠ” detail -> periodë§Œ ê°€ëŠ¥
            if (draggedSite.site_type === 'head') {
                // headëŠ” ì´ë™ ë¶ˆê°€
                return false;
            } else if (draggedSite.site_type === 'detail') {
                // detailì€ headì—ë§Œ ë“œë¡­ ê°€ëŠ¥
                return targetSite.site_type === 'head';
            } else if (draggedSite.site_type === 'period') {
                // periodëŠ” detailì—ë§Œ ë“œë¡­ ê°€ëŠ¥
                return targetSite.site_type === 'detail';
            }
            
            return false;
        }

        // ë“œë¡­ ì²˜ë¦¬
        async function handleDrop(draggedSite, targetSite) {
            console.log(`ë“œë¡­ ì²˜ë¦¬: ${draggedSite.name} -> ${targetSite.name}`);
            
            // í™•ì¸ ëŒ€í™”ìƒì
            const message = `"${draggedSite.name}"ì„(ë¥¼) "${targetSite.name}" í•˜ìœ„ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            if (!confirm(message)) {
                return;
            }
            
            try {
                // ì„œë²„ì— ì´ë™ ìš”ì²­
                const response = await fetch(`/api/admin/sites/${draggedSite.id}/move`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        new_parent_id: targetSite.id
                    }),
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('ì´ë™ ì„±ê³µ:', result.message);
                    // íŠ¸ë¦¬ ìƒˆë¡œê³ ì¹¨
                    loadSitesTree();
                } else {
                    console.error('ì´ë™ ì‹¤íŒ¨:', result.message);
                    alert(`ì´ë™ ì‹¤íŒ¨: ${result.message}`);
                }
            } catch (error) {
                console.error('ì´ë™ ìš”ì²­ ì˜¤ë¥˜:', error);
                alert('ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë“œë¡­ ì¸ë””ì¼€ì´í„° ì •ë¦¬
        function clearDropIndicators() {
            document.querySelectorAll('.tree-node-content').forEach(el => {
                el.classList.remove('drag-over', 'drop-invalid');
            });
        }

        // ìƒì„¸ì •ë³´ íŒ¨ë„ ë‹«ê¸°
        function closeSiteDetails() {
            document.getElementById('site-details-panel').classList.add('hidden');
            selectedSiteId = null;
            
            // ì„ íƒ í•´ì œ
            document.querySelectorAll('.tree-node-content.selected').forEach(node => {
                node.classList.remove('selected');
            });
        }

        // ì‚¬ì—…ì¥ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        function showAddSiteModal(siteType, parentId = null) {
            console.log('showAddSiteModal í˜¸ì¶œë¨:', siteType, parentId, 'allowModalDisplay:', allowModalDisplay);
            
            // í˜ì´ì§€ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
            if (!allowModalDisplay) {
                console.log('í˜ì´ì§€ ì´ˆê¸°í™” ì¤‘ì´ë¯€ë¡œ ëª¨ë‹¬ í‘œì‹œ ì·¨ì†Œ');
                return;
            }
            
            currentEditSiteId = null;
            
            const modal = document.getElementById('site-modal');
            if (!modal) {
                console.error('ì‚¬ì—…ì¥ ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            document.getElementById('site-modal-title').textContent = `ìƒˆ ${getSiteTypeDisplay(siteType)} ì¶”ê°€`;
            document.getElementById('site-form').reset();
            document.getElementById('site-parent-id').value = parentId || '';
            document.getElementById('site-type').value = siteType;
            document.getElementById('site-is-active').checked = true;
            
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
            console.log('ì‚¬ì—…ì¥ ëª¨ë‹¬ í‘œì‹œë¨');
        }

        // ì‚¬ì—…ì¥ ìˆ˜ì •
        async function editSite(siteId) {
            try {
                const response = await fetch(`/api/admin/sites/${siteId}`);
                const site = await response.json();
                
                currentEditSiteId = siteId;
                document.getElementById('site-modal-title').textContent = 'ì‚¬ì—…ì¥ ì •ë³´ ìˆ˜ì •';
                
                // í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('site-name').value = site.name;
                document.getElementById('site-contact-person').value = site.contact_person || '';
                document.getElementById('site-contact-phone').value = site.contact_phone || '';
                document.getElementById('site-address').value = site.address || '';
                document.getElementById('site-portion-size').value = site.portion_size || '';
                document.getElementById('site-description').value = site.description || '';
                document.getElementById('site-is-active').checked = site.is_active;
                
                document.getElementById('site-modal').classList.remove('hidden');
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ì—…ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ì—…ì¥ ì‚­ì œ
        async function deleteSite(siteId) {
            if (!confirm('ì´ ì‚¬ì—…ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? í•˜ìœ„ ì‚¬ì—…ì¥ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/sites/${siteId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('ì‚¬ì—…ì¥ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadSitesTree();
                    closeSiteDetails();
                } else {
                    alert('ì‚¬ì—…ì¥ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ì—…ì¥ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ì—…ì¥ ëª¨ë‹¬ ë‹«ê¸°
        function closeSiteModal() {
            console.log('closeSiteModal í˜¸ì¶œë¨');
            const modal = document.getElementById('site-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.add('hidden');
                console.log('ì‚¬ì—…ì¥ ëª¨ë‹¬ ì™„ì „íˆ ìˆ¨ê¹€');
            }
            currentEditSiteId = null;
        }

        // ì‚¬ì—…ì¥ ì €ì¥
        async function saveSite() {
            const siteData = {
                name: document.getElementById('site-name').value,
                contact_person: document.getElementById('site-contact-person').value,
                contact_phone: document.getElementById('site-contact-phone').value,
                address: document.getElementById('site-address').value,
                portion_size: parseInt(document.getElementById('site-portion-size').value) || null,
                description: document.getElementById('site-description').value,
                is_active: document.getElementById('site-is-active').checked
            };

            if (!currentEditSiteId) {
                // ìƒˆ ì‚¬ì—…ì¥ ì¶”ê°€
                siteData.site_type = document.getElementById('site-type').value;
                siteData.parent_id = document.getElementById('site-parent-id').value || null;
            }

            try {
                const url = currentEditSiteId ? 
                    `/api/admin/sites/${currentEditSiteId}` : 
                    '/api/admin/sites';
                
                const method = currentEditSiteId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(siteData)
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert(currentEditSiteId ? 'ì‚¬ì—…ì¥ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ìƒˆ ì‚¬ì—…ì¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        closeSiteModal();
                        loadSitesTree();
                    } else {
                        alert('âŒ ' + (result.message || 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
                    }
                } else {
                    const errorText = await response.text();
                    console.error('Server error:', errorText);
                    alert(`âŒ ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${errorText}`);
                }
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‚¬ì—…ì¥ í…Œì´ë¸” ë·° ë¡œë“œ
        async function loadSitesTable() {
            try {
                const response = await fetch('/api/admin/sites/debug');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'ì‚¬ì—…ì¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
                
                // í…Œì´ë¸” HTML ìƒì„±
                let tableHtml = `
                    <div id="sites-table-container" style="margin-top: 20px;">
                        <h4>ëª¨ë“  ì‚¬ì—…ì¥ ëª©ë¡</h4>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background-color: #f5f5f5; border-bottom: 2px solid #ddd;">
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ID</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì½”ë“œ</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì´ë¦„</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì¢…ë¥˜</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ìƒìœ„ID</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ë ˆë²¨</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">í™œì„±</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì—°ë½ì²˜</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                // ê° ì‚¬ì—…ì¥ ë°ì´í„° ë Œë”ë§
                data.sites.forEach(site => {
                    tableHtml += `
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.id}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.code || '-'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.name}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.site_type || '-'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.parent_id || '-'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.level}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${site.contact_person || '-'}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <button class="btn-small btn-primary" onclick="editSite(${site.id})" style="margin-right: 5px; padding: 4px 8px; font-size: 12px;">ìˆ˜ì •</button>
                                <button class="btn-small btn-danger" onclick="deleteSite(${site.id})" style="padding: 4px 8px; font-size: 12px;">ì‚­ì œ</button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                // sites-containerì˜ ë‚´ìš©ì„ í…Œì´ë¸”ë¡œ êµì²´
                const sitesContainer = document.querySelector('.sites-container');
                if (sitesContainer) {
                    sitesContainer.innerHTML = tableHtml;
                } else {
                    console.error('sites-containerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ í…Œì´ë¸” ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ì—…ì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ===== ì‹ìì¬ ì—…ë¡œë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤ =====
        
        let selectedFiles = [];
        
        // ì—…ë¡œë“œ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¸°ê¸°
        function showUploadSection() {
            const uploadSection = document.getElementById('upload-section');
            const isVisible = uploadSection.style.display !== 'none';
            uploadSection.style.display = isVisible ? 'none' : 'block';
        }

        // ì‹ìì¬ ê´€ë¦¬ í•¨ìˆ˜ë“¤ì€ modules/ingredients/ingredients.jsë¡œ ì´ë™ë¨

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('file-input');
            const uploadArea = document.querySelector('.upload-area');
            
            if (fileInput && uploadArea) {
                // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
                fileInput.addEventListener('change', handleFileSelect);
                
                // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
                uploadArea.addEventListener('dragover', handleDragOver);
                uploadArea.addEventListener('drop', handleDrop);
                uploadArea.addEventListener('dragleave', handleDragLeave);
            }
        });

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            addFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            const files = Array.from(event.dataTransfer.files);
            addFiles(files);
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function addFiles(files) {
            // íŒŒì¼ í˜•ì‹ ê²€ì¦
            const validFiles = files.filter(file => {
                const isValidType = file.type.includes('sheet') || file.name.endsWith('.xlsx') || file.name.endsWith('.xls');
                const isValidSize = file.size <= 10 * 1024 * 1024; // 10MB
                
                if (!isValidType) {
                    alert(`${file.name}ì€(ëŠ”) ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.`);
                    return false;
                }
                
                if (!isValidSize) {
                    alert(`${file.name}ì€(ëŠ”) íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                    return false;
                }
                
                return true;
            });

            // ì¤‘ë³µ íŒŒì¼ ì²´í¬
            validFiles.forEach(file => {
                const isDuplicate = selectedFiles.some(selectedFile => 
                    selectedFile.name === file.name && selectedFile.size === file.size
                );
                
                if (!isDuplicate) {
                    selectedFiles.push(file);
                }
            });

            updateFileList();
            updateUploadButton();
        }

        function updateFileList() {
            const uploadText = document.querySelector('.upload-text h4');
            const uploadBtn = document.getElementById('upload-btn');
            
            if (selectedFiles.length > 0) {
                uploadText.textContent = `${selectedFiles.length}ê°œ íŒŒì¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`;
                uploadBtn.disabled = false;
            } else {
                uploadText.textContent = 'íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”';
                uploadBtn.disabled = true;
            }
        }

        function updateUploadButton() {
            const uploadBtn = document.getElementById('upload-btn');
            uploadBtn.disabled = selectedFiles.length === 0;
        }

        function clearFiles() {
            selectedFiles = [];
            document.getElementById('file-input').value = '';
            updateFileList();
            updateUploadButton();
            hideResults();
        }

        function hideResults() {
            document.getElementById('upload-results').style.display = 'none';
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì‹¤í–‰ í•¨ìˆ˜ëŠ” modules/ingredients/ingredients.jsë¡œ ì´ë™ë¨

        function showUploadResults(successCount, errorCount, results) {
            document.getElementById('success-count').textContent = successCount;
            document.getElementById('error-count').textContent = errorCount;
            
            const resultDetails = document.getElementById('result-details');
            resultDetails.innerHTML = '';
            
            results.forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.className = `result-file ${result.status}`;
                
                resultDiv.innerHTML = `
                    <div class="file-name">${result.fileName}</div>
                    <div class="file-status ${result.status}">
                        <span>${result.status === 'success' ? 'âœ“' : 'âœ—'}</span>
                        <span>${result.message}</span>
                    </div>
                `;
                
                resultDetails.appendChild(resultDiv);
            });
            
            document.getElementById('upload-results').style.display = 'block';
        }

        // ì‹ìì¬ ëª©ë¡ì€ ì´ì œ ë³„ë„ í˜ì´ì§€(/ingredients)ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤
        // loadIngredientsList í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

        // ê³µê¸‰ì—…ì²´ í•„í„° ë¡œë“œ
        async function loadSupplierFilter() {
            try {
                const response = await fetch('/api/admin/suppliers/enhanced');
                const result = await response.json();
                const suppliers = result.suppliers || result.data || [];
                
                const supplierFilter = document.getElementById('supplier-filter');
                supplierFilter.innerHTML = '<option value="">ì „ì²´ ì—…ì²´</option>';
                
                suppliers.forEach(supplier => {
                    const option = document.createElement('option');
                    option.value = supplier.id;
                    option.textContent = supplier.name;
                    supplierFilter.appendChild(option);
                });
                
            } catch (error) {
                console.error('ê³µê¸‰ì—…ì²´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‹ìì¬ ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ì€ /ingredients í˜ì´ì§€ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤

        // ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ ë¡œë“œ
        async function loadUploadHistory() {
            try {
                const response = await fetch('/api/admin/ingredient-upload-history');
                const result = await response.json();
                
                if (result.success) {
                    const tbody = document.getElementById('upload-history-tbody');
                    tbody.innerHTML = '';
                    
                    if (result.histories.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #666;">ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                        return;
                    }
                    
                    result.histories.forEach(history => {
                        const statusBadge = getStatusBadge(history.status);
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">${new Date(history.upload_date).toLocaleDateString()}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">${history.uploaded_by}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px;">${history.filename}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">${history.total_rows}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center; color: #28a745; font-weight: bold;">${history.processed_count + history.updated_count}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center; color: #dc3545; font-weight: bold;">${history.error_count}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">${statusBadge}</td>
                            <td style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">
                                <button onclick="showUploadDetails(${history.id})" style="padding: 4px 8px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                    ìƒì„¸ë³´ê¸°
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    console.error('ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', result.message);
                }
            } catch (error) {
                console.error('ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                document.getElementById('upload-history-tbody').innerHTML = 
                    '<tr><td colspan="8" style="text-align: center; color: #dc3545;">ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        // ìƒíƒœ ë°°ì§€ ìƒì„±
        function getStatusBadge(status) {
            switch (status) {
                case 'completed':
                    return '<span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì™„ë£Œ</span>';
                case 'completed_with_errors':
                    return '<span style="background: #ffc107; color: #212529; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì¼ë¶€ì‹¤íŒ¨</span>';
                case 'failed':
                    return '<span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì‹¤íŒ¨</span>';
                case 'processing':
                    return '<span style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì²˜ë¦¬ì¤‘</span>';
                default:
                    return '<span style="background: #6c757d; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ì•Œ ìˆ˜ ì—†ìŒ</span>';
            }
        }

        // ì—…ë¡œë“œ ìƒì„¸ ë³´ê¸°
        function showUploadDetails(historyId) {
            // ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ êµ¬í˜„ (ì¶”í›„)
            alert(`ì—…ë¡œë“œ ID ${historyId}ì˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ ê¸°ëŠ¥ì€ ê³§ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.`);
        }

        // ===== ì‹ìˆ˜ ë“±ë¡ ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ =====
        
        // ì‹ìˆ˜ ë“±ë¡ í˜ì´ì§€ ì´ˆê¸°í™”
        function initMealCountsPage() {
            // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('meal-count-date').value = today;
            document.getElementById('form-meal-date').value = today;
        }

        // ì‹ìˆ˜ ë°ì´í„° ë¡œë“œ
        async function loadMealCounts() {
            try {
                const selectedDate = document.getElementById('meal-count-date').value;
                const url = selectedDate ? `/api/admin/meal-counts?date=${selectedDate}` : '/api/admin/meal-counts';
                
                const response = await fetch(url);
                const mealCounts = await response.json();
                
                updateMealCountsSummary(mealCounts);
                updateMealCountsTable(mealCounts);
                
            } catch (error) {
                console.error('ì‹ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('meal-counts-tbody').innerHTML = 
                    '<tr><td colspan="8" style="text-align: center; color: #dc3545;">ì‹ìˆ˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        // ì‹ìˆ˜ í˜„í™© ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateMealCountsSummary(mealCounts) {
            let totalCount = 0;
            let totalCost = 0;
            let deliverySites = new Set();
            
            mealCounts.forEach(item => {
                totalCount += item.total_count || 0;
                totalCost += (item.target_material_cost || 0) * (item.total_count || 0);
                deliverySites.add(item.delivery_site);
            });
            
            document.getElementById('total-meal-count').textContent = `${totalCount.toLocaleString()}ëª…`;
            document.getElementById('avg-material-cost').textContent = 
                totalCount > 0 ? `${Math.round(totalCost / totalCount).toLocaleString()}ì›` : '0ì›';
            document.getElementById('delivery-sites-count').textContent = `${deliverySites.size}ê°œì†Œ`;
            document.getElementById('estimated-total-cost').textContent = `${totalCost.toLocaleString()}ì›`;
        }

        // ì‹ìˆ˜ ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateMealCountsTable(mealCounts) {
            const tbody = document.getElementById('meal-counts-tbody');
            tbody.innerHTML = '';
            
            if (mealCounts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #666;">ë“±ë¡ëœ ì‹ìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            mealCounts.forEach((item, index) => {
                // ë©”ì¸ í–‰
                const mainRow = document.createElement('tr');
                mainRow.innerHTML = `
                    <td class="delivery-site-cell" rowspan="${item.site_details.length + 1}">${item.delivery_site}</td>
                    <td class="meal-type-cell" rowspan="${item.site_details.length + 1}">${item.meal_type}</td>
                    <td class="cost-cell" rowspan="${item.site_details.length + 1}">${(item.target_material_cost || 0).toLocaleString()}ì›</td>
                    <td class="count-cell" rowspan="${item.site_details.length + 1}">${(item.total_count || 0).toLocaleString()}ëª…</td>
                    <td colspan="3" style="background: #f0f8ff; font-weight: 500;">${item.menu_info || '-'}</td>
                    <td rowspan="${item.site_details.length + 1}">
                        <div class="btn-group">
                            <button class="btn-small btn-primary" onclick="editMealCount(${item.id})">ìˆ˜ì •</button>
                            <button class="btn-small btn-warning" onclick="duplicateMealCount(${item.id})">ë³µì‚¬</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(mainRow);
                
                // ì‚¬ì—…ì¥ë³„ ìƒì„¸ í–‰ë“¤
                item.site_details.forEach(site => {
                    const detailRow = document.createElement('tr');
                    detailRow.className = 'site-detail-row';
                    detailRow.innerHTML = `
                        <td>${site.site_name}</td>
                        <td class="count-cell">${site.count}ëª…</td>
                        <td>${site.notes || '-'}</td>
                    `;
                    tbody.appendChild(detailRow);
                });
            });
        }

        // ì‹ìˆ˜ ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ
        function showAddMealCountModal() {
            document.getElementById('meal-count-modal-title').textContent = 'ì‹ìˆ˜ ë“±ë¡';
            document.getElementById('meal-count-form').reset();
            document.getElementById('meal-count-id').value = '';
            
            // ì„ íƒëœ ë‚ ì§œë¥¼ í¼ì—ë„ ë°˜ì˜
            const selectedDate = document.getElementById('meal-count-date').value;
            document.getElementById('form-meal-date').value = selectedDate;
            
            document.getElementById('meal-count-modal').classList.remove('hidden');
        }

        // ì‹ìˆ˜ ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeMealCountModal() {
            document.getElementById('meal-count-modal').classList.add('hidden');
        }

        // ì‹ìˆ˜ ë°ì´í„° ì €ì¥
        async function saveMealCount() {
            try {
                const formData = {
                    meal_date: document.getElementById('form-meal-date').value,
                    delivery_site: document.getElementById('form-delivery-site').value.trim(),
                    meal_type: document.getElementById('form-meal-type').value,
                    target_material_cost: parseInt(document.getElementById('form-target-cost').value) || 0,
                    menu_info: document.getElementById('form-menu-info').value.trim(),
                    site_counts: document.getElementById('form-site-counts').value.trim(),
                    notes: document.getElementById('form-notes').value.trim()
                };

                // ìœ íš¨ì„± ê²€ì‚¬
                if (!formData.meal_date || !formData.delivery_site || !formData.meal_type) {
                    alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!formData.site_counts) {
                    alert('ì‚¬ì—…ì¥ë³„ ì‹ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const mealCountId = document.getElementById('meal-count-id').value;
                const url = mealCountId ? `/api/admin/meal-counts/${mealCountId}` : '/api/admin/meal-counts';
                const method = mealCountId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    alert(mealCountId ? 'ì‹ìˆ˜ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì‹ìˆ˜ ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeMealCountModal();
                    loadMealCounts();
                } else {
                    alert(result.message || 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ì‹ìˆ˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹ìˆ˜ ë°ì´í„° ìˆ˜ì •
        async function editMealCount(mealCountId) {
            try {
                const response = await fetch(`/api/admin/meal-counts/${mealCountId}`);
                const mealCount = await response.json();
                
                if (mealCount) {
                    document.getElementById('meal-count-modal-title').textContent = 'ì‹ìˆ˜ ìˆ˜ì •';
                    document.getElementById('meal-count-id').value = mealCount.id;
                    document.getElementById('form-meal-date').value = mealCount.meal_date;
                    document.getElementById('form-delivery-site').value = mealCount.delivery_site;
                    document.getElementById('form-meal-type').value = mealCount.meal_type;
                    document.getElementById('form-target-cost').value = mealCount.target_material_cost;
                    document.getElementById('form-menu-info').value = mealCount.menu_info || '';
                    document.getElementById('form-notes').value = mealCount.notes || '';
                    
                    // ì‚¬ì—…ì¥ë³„ ì‹ìˆ˜ ë°ì´í„° ë³€í™˜
                    const siteCountsText = mealCount.site_details.map(site => 
                        `${site.site_name}:${site.count}`
                    ).join(',');
                    document.getElementById('form-site-counts').value = siteCountsText;
                    
                    document.getElementById('meal-count-modal').classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('ì‹ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‹ìˆ˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹ìˆ˜ ë°ì´í„° ë³µì‚¬
        async function duplicateMealCount(mealCountId) {
            try {
                const response = await fetch(`/api/admin/meal-counts/${mealCountId}`);
                const mealCount = await response.json();
                
                if (mealCount) {
                    document.getElementById('meal-count-modal-title').textContent = 'ì‹ìˆ˜ ë³µì‚¬ ë“±ë¡';
                    document.getElementById('meal-count-id').value = ''; // ìƒˆë¡œìš´ ë“±ë¡ì´ë¯€ë¡œ ID ë¹„ì›€
                    
                    // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('form-meal-date').value = today;
                    
                    document.getElementById('form-delivery-site').value = mealCount.delivery_site;
                    document.getElementById('form-meal-type').value = mealCount.meal_type;
                    document.getElementById('form-target-cost').value = mealCount.target_material_cost;
                    document.getElementById('form-menu-info').value = mealCount.menu_info || '';
                    document.getElementById('form-notes').value = '';
                    
                    // ì‚¬ì—…ì¥ë³„ ì‹ìˆ˜ ë°ì´í„° ë³€í™˜
                    const siteCountsText = mealCount.site_details.map(site => 
                        `${site.site_name}:${site.count}`
                    ).join(',');
                    document.getElementById('form-site-counts').value = siteCountsText;
                    
                    document.getElementById('meal-count-modal').classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('ì‹ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‹ìˆ˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹ìˆ˜ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshMealCounts() {
            loadMealCounts();
        }

        // ë°œì£¼ì„œ ì¶œë ¥ (ì¶”í›„ êµ¬í˜„)
        function exportMealCounts() {
            alert('ë°œì£¼ì„œ ì¶œë ¥ ê¸°ëŠ¥ì€ ê³§ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        // ë‚ ì§œ ë³€ê²½ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            const mealCountDateInput = document.getElementById('meal-count-date');
            if (mealCountDateInput) {
                mealCountDateInput.addEventListener('change', loadMealCounts);
            }
        });

        // ===================
        // ì‚¬ìš©ì ê´€ë¦¬ í™•ì¥ ê¸°ëŠ¥
        // ===================
        
        // ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
        async function resetPassword(userId) {
            if (!confirm('ì´ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/users/${userId}/reset-password`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`ë¹„ë°€ë²ˆí˜¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\nìƒˆ ë¹„ë°€ë²ˆí˜¸: ${result.new_password}\nì‚¬ìš©ìì—ê²Œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì „ë‹¬í•´ì£¼ì„¸ìš”.`);
                } else {
                    alert('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì‚¬ìš©ì í™œì„± ìƒíƒœ í† ê¸€
        async function toggleUserStatus(userId, newStatus) {
            const statusText = newStatus ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
            if (!confirm(`ì´ ì‚¬ìš©ìë¥¼ ${statusText}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_active: newStatus })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`ì‚¬ìš©ìê°€ ${statusText}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    loadUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì‚¬ì—…ì¥ ê´€ë¦¬ ëª¨ë‹¬ í‘œì‹œ
        async function manageSites(userId) {
            try {
                // ì‚¬ìš©ì ì‚¬ì—…ì¥ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/admin/users/${userId}/sites`);
                const data = await response.json();
                
                // ëª¨ë“  ì‚¬ì—…ì¥ ì²´í¬ë°•ìŠ¤ ìƒì„±
                const sitesList = document.getElementById('sites-list');
                sitesList.innerHTML = '';
                
                data.all_sites.forEach(site => {
                    const isAssigned = data.assigned_site_ids.includes(site.id);
                    const siteDiv = document.createElement('div');
                    siteDiv.innerHTML = `
                        <label class="checkbox-label" style="margin-bottom: 5px;">
                            <input type="checkbox" 
                                   value="${site.id}" 
                                   ${isAssigned ? 'checked' : ''} 
                                   onchange="updateSitesAllStatus()">
                            ${site.name} (${site.location})
                        </label>
                    `;
                    sitesList.appendChild(siteDiv);
                });
                
                // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateSitesAllStatus();
                
                // ëª¨ë‹¬ì— ì‚¬ìš©ì ID ì €ì¥
                document.getElementById('user-sites-container').setAttribute('data-user-id', userId);
                
                // ì‚¬ì—…ì¥ ê´€ë¦¬ ëª¨ë‹¬ í‘œì‹œ
                showSitesModal();
                
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ì‚¬ì—…ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì‚¬ì—…ì¥ ê´€ë¦¬ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showSitesModal() {
            // ê°„ë‹¨í•œ ëª¨ë‹¬ HTML ìƒì„± (ê¸°ì¡´ ëª¨ë‹¬ ì¬ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŒ)
            const modalHtml = `
                <div id="sites-modal" class="modal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>ì‚¬ì—…ì¥ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬</h3>
                            <button class="modal-close" onclick="closeSitesModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ì—…ì¥</label>
                                <div id="user-sites-container-modal" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
                                    <label class="checkbox-label" style="margin-bottom: 10px;">
                                        <input type="checkbox" id="sites-all-modal" onchange="toggleAllSitesModal(this)">
                                        <strong>ëª¨ë“  ì‚¬ì—…ì¥</strong>
                                    </label>
                                    <div id="sites-list-modal">
                                        ${document.getElementById('sites-list').innerHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-primary" onclick="saveSitesAssignment()">ì €ì¥</button>
                            <button class="btn-secondary" onclick="closeSitesModal()">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>
            `;
            
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±° í›„ ìƒˆ ëª¨ë‹¬ ì¶”ê°€
            const existingModal = document.getElementById('sites-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // ì‚¬ì—…ì¥ ëª¨ë‹¬ ë‹«ê¸°
        function closeSitesModal() {
            const modal = document.getElementById('sites-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ëª¨ë“  ì‚¬ì—…ì¥ ì„ íƒ/í•´ì œ
        function toggleAllSites(checkbox) {
            const sitesList = document.getElementById('sites-list');
            const siteCheckboxes = sitesList.querySelectorAll('input[type="checkbox"]');
            
            siteCheckboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });
        }
        
        // ëª¨ë“  ì‚¬ì—…ì¥ ì„ íƒ/í•´ì œ (ëª¨ë‹¬ìš©)
        function toggleAllSitesModal(checkbox) {
            const sitesList = document.getElementById('sites-list-modal');
            const siteCheckboxes = sitesList.querySelectorAll('input[type="checkbox"]');
            
            siteCheckboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });
        }
        
        // ì „ì²´ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSitesAllStatus() {
            const sitesList = document.getElementById('sites-list');
            const allCheckbox = document.getElementById('sites-all');
            
            if (!sitesList || !allCheckbox) return;
            
            const siteCheckboxes = sitesList.querySelectorAll('input[type="checkbox"]');
            const checkedCount = Array.from(siteCheckboxes).filter(cb => cb.checked).length;
            
            allCheckbox.checked = checkedCount === siteCheckboxes.length && siteCheckboxes.length > 0;
        }
        
        // ì‚¬ì—…ì¥ í• ë‹¹ ì €ì¥
        async function saveSitesAssignment() {
            const userId = document.getElementById('user-sites-container').getAttribute('data-user-id');
            const sitesList = document.getElementById('sites-list-modal');
            const checkedSites = Array.from(sitesList.querySelectorAll('input[type="checkbox"]:checked'))
                                       .map(cb => parseInt(cb.value));
            
            try {
                const response = await fetch(`/api/admin/users/${userId}/sites`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ site_ids: checkedSites })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ì‚¬ì—…ì¥ í• ë‹¹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeSitesModal();
                    loadUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ì‚¬ì—…ì¥ í• ë‹¹ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ í• ë‹¹ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥ ì´ˆê¸°í™”
        async function initUserExtensions() {
            if (!confirm('ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì„ í™•ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸)')) {
                return;
            }
            
            try {
                const response = await fetch('/api/admin/init_user_extensions', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì´ í™•ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                    window.location.reload();
                } else {
                    alert('ê¸°ëŠ¥ í™•ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê¸°ëŠ¥ í™•ì¥ ì˜¤ë¥˜:', error);
                alert('ê¸°ëŠ¥ í™•ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ===========================================
        // ê³µê¸‰ì—…ì²´ ê´€ë¦¬ í™•ì¥ ê¸°ëŠ¥
        // ===========================================
        
        // íƒ­ ì „í™˜ í•¨ìˆ˜ë“¤
        function showIngredientTab() {
            document.getElementById('ingredient-tab-content').classList.remove('hidden');
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
            const tabButton = document.querySelector('.tab-button');
            if (tabButton) {
                tabButton.style.borderBottomColor = '#007bff';
                tabButton.style.backgroundColor = '#f8f9fa';
            }
        }
        
        
        // ê³µê¸‰ì—…ì²´ ê¸°ëŠ¥ í™•ì¥ ì´ˆê¸°í™”
        async function initSupplierExtensions() {
            if (!confirm('ê³µê¸‰ì—…ì²´ ê´€ë¦¬ ê¸°ëŠ¥ì„ í™•ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸)')) {
                return;
            }
            
            try {
                const response = await fetch('/api/admin/init_supplier_extensions', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(result.message + '\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                    window.location.reload();
                } else {
                    alert('ê¸°ëŠ¥ í™•ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.message);
                }
            } catch (error) {
                console.error('ê¸°ëŠ¥ í™•ì¥ ì˜¤ë¥˜:', error);
                alert('ê¸°ëŠ¥ í™•ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê³µê¸‰ì—…ì²´ ê´€ë¦¬ ë³€ìˆ˜ë“¤
        let currentSupplierPage = 1;
        let totalSupplierPages = 1;
        let currentEditSupplierId = null;
        
        // ê³µê¸‰ì—…ì²´ ëª©ë¡ ë¡œë“œ
        async function loadSuppliers() {
            try {
                const search = document.getElementById('supplier-search')?.value || '';
                const page = currentSupplierPage || 1;
                const response = await fetch(`/api/admin/suppliers/enhanced?page=${page}&limit=20&search=${encodeURIComponent(search)}`);
                const data = await response.json();
                
                if (data.suppliers) {
                    displaySuppliers(data.suppliers);
                    updateSupplierPagination(data.page, data.total_pages);
                }
            } catch (error) {
                console.error('ê³µê¸‰ì—…ì²´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('suppliers-table-body').innerHTML = 
                    '<tr><td colspan="11">ê³µê¸‰ì—…ì²´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }
        
        // ê³µê¸‰ì—…ì²´ ëª©ë¡ í‘œì‹œ
        function displaySuppliers(suppliers) {
            const tbody = document.getElementById('suppliers-table-body');
            
            if (!suppliers || suppliers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11">ë“±ë¡ëœ ê³µê¸‰ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = suppliers.map(supplier => `
                <tr>
                    <td><strong>${supplier.parent_code || '-'}</strong></td>
                    <td><strong>${supplier.site_code || '-'}</strong></td>
                    <td>${supplier.site_name || '-'}</td>
                    <td><strong>${supplier.name || '-'}</strong></td>
                    <td>${supplier.phone || supplier.contact || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td><span class="${supplier.is_active ? 'status-active' : 'status-inactive'}">
                        ${supplier.is_active ? 'ê±°ë˜ì¤‘' : 'ì¤‘ë‹¨'}
                    </span></td>
                    <td>${supplier.business_number || '-'}</td>
                    <td>${supplier.representative || '-'}</td>
                    <td>${supplier.manager_name || '-'}</td>
                    <td>
                        <button class="btn-small btn-edit" onclick="editSupplier(${supplier.id})" style="background: #28a745; margin-right: 5px;">ìˆ˜ì •</button>
                        <button class="btn-small btn-toggle" onclick="toggleSupplierStatus(${supplier.id}, ${!supplier.is_active})" 
                                style="background: ${supplier.is_active ? '#dc3545' : '#17a2b8'}; margin-right: 5px;">
                            ${supplier.is_active ? 'ì¤‘ë‹¨' : 'ì¬ê°œ'}
                        </button>
                        <button class="btn-small btn-delete" onclick="deleteSupplier(${supplier.id})" style="background: #6c757d;">ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // ê³µê¸‰ì—…ì²´ í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
        function updateSupplierPagination(currentPage, totalPages) {
            currentSupplierPage = currentPage;
            totalSupplierPages = totalPages;
            const pageInfoElement = document.getElementById('supplier-page-info');
            if (pageInfoElement) {
                pageInfoElement.textContent = `${currentPage} / ${totalPages}`;
            }
        }
        
        // ê³µê¸‰ì—…ì²´ í˜ì´ì§€ ë³€ê²½
        function changeSupplierPage(direction) {
            const newPage = currentSupplierPage + direction;
            if (newPage >= 1 && newPage <= totalSupplierPages) {
                currentSupplierPage = newPage;
                loadSuppliers();
            }
        }
        
        // ê³µê¸‰ì—…ì²´ ê²€ìƒ‰
        function searchSuppliers() {
            currentSupplierPage = 1;
            loadSuppliers();
        }
        
        // ê³µê¸‰ì—…ì²´ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        function showAddSupplierModal() {
            currentEditSupplierId = null;
            document.getElementById('supplier-modal-title').textContent = 'ìƒˆ ì—…ì²´ ë“±ë¡';
            clearSupplierForm();
            document.getElementById('supplier-modal').classList.remove('hidden');
        }
        
        // ê³µê¸‰ì—…ì²´ ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
        async function editSupplier(supplierId) {
            try {
                const response = await fetch(`/api/admin/suppliers/${supplierId}/detail`);
                const result = await response.json();
                const supplier = result.supplier || result;
                
                if (!response.ok) {
                    throw new Error('ê³µê¸‰ì—…ì²´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                currentEditSupplierId = supplierId;
                document.getElementById('supplier-modal-title').textContent = 'ì—…ì²´ ì •ë³´ ìˆ˜ì •';
                
                // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('supplier-name').value = supplier.name || '';
                document.getElementById('supplier-parent-code').value = supplier.parent_code || '';
                document.getElementById('supplier-site-code').value = supplier.site_code || '';
                document.getElementById('supplier-site-name').value = supplier.site_name || '';
                document.getElementById('supplier-representative').value = supplier.representative || '';
                document.getElementById('supplier-contact').value = supplier.contact || '';
                document.getElementById('supplier-phone').value = supplier.phone || '';
                document.getElementById('supplier-fax').value = supplier.fax || '';
                document.getElementById('supplier-email').value = supplier.email || '';
                document.getElementById('supplier-address').value = supplier.address || '';
                document.getElementById('supplier-business-number').value = supplier.business_number || '';
                document.getElementById('supplier-business-type').value = supplier.business_type || '';
                document.getElementById('supplier-business-item').value = supplier.business_item || '';
                document.getElementById('supplier-manager-name').value = supplier.manager_name || '';
                document.getElementById('supplier-manager-phone').value = supplier.manager_phone || '';
                document.getElementById('supplier-update-frequency').value = supplier.update_frequency || 'weekly';
                document.getElementById('supplier-is-active').checked = supplier.is_active !== false;
                document.getElementById('supplier-notes').value = supplier.notes || '';
                
                document.getElementById('supplier-modal').classList.remove('hidden');
                
            } catch (error) {
                console.error('ê³µê¸‰ì—…ì²´ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ê³µê¸‰ì—…ì²´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê³µê¸‰ì—…ì²´ í¼ ì´ˆê¸°í™”
        function clearSupplierForm() {
            document.getElementById('supplier-form').reset();
            document.getElementById('supplier-is-active').checked = true;
        }
        
        // ê³µê¸‰ì—…ì²´ ì €ì¥
        async function saveSupplier() {
            const supplierData = {
                name: document.getElementById('supplier-name').value.trim(),
                parent_code: document.getElementById('supplier-parent-code').value.trim(),
                site_code: document.getElementById('supplier-site-code').value.trim(),
                site_name: document.getElementById('supplier-site-name').value.trim(),
                representative: document.getElementById('supplier-representative').value,
                contact: document.getElementById('supplier-contact').value,
                phone: document.getElementById('supplier-phone').value.trim(),
                fax: document.getElementById('supplier-fax').value,
                email: document.getElementById('supplier-email').value.trim(),
                address: document.getElementById('supplier-address').value.trim(),
                business_number: document.getElementById('supplier-business-number').value,
                business_type: document.getElementById('supplier-business-type').value,
                business_item: document.getElementById('supplier-business-item').value,
                manager_name: document.getElementById('supplier-manager-name').value,
                manager_phone: document.getElementById('supplier-manager-phone').value,
                update_frequency: document.getElementById('supplier-update-frequency').value,
                is_active: document.getElementById('supplier-is-active').checked,
                notes: document.getElementById('supplier-notes').value
            };
            
            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            const parentCode = document.getElementById('supplier-parent-code').value.trim();
            const siteName = document.getElementById('supplier-site-name').value.trim();
            const siteCode = document.getElementById('supplier-site-code').value.trim();
            
            
            if (!supplierData.name) {
                alert('ì‹ìì¬ì—…ì²´ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            if (!supplierData.address) {
                alert('ì£¼ì†ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            if (!supplierData.phone && !supplierData.email) {
                alert('ì—°ë½ì²˜ ë˜ëŠ” ì´ë©”ì¼ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
            supplierData.parent_code = parentCode;
            supplierData.site_name = siteName;
            supplierData.site_code = siteCode;
            
            try {
                const url = currentEditSupplierId 
                    ? `/api/admin/suppliers/${currentEditSupplierId}/update`
                    : '/api/admin/suppliers/create';
                const method = currentEditSupplierId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(supplierData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(currentEditSupplierId ? 'ì—…ì²´ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ìƒˆ ì—…ì²´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeSupplierModal();
                    loadSuppliers();
                } else {
                    alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                console.error('ê³µê¸‰ì—…ì²´ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê³µê¸‰ì—…ì²´ ê±°ë˜ ìƒíƒœ í† ê¸€
        async function toggleSupplierStatus(supplierId, newStatus) {
            const statusText = newStatus ? 'ê±°ë˜ë¥¼ ì¬ê°œ' : 'ê±°ë˜ë¥¼ ì¤‘ë‹¨';
            if (!confirm(`ì´ ì—…ì²´ì™€ì˜ ${statusText}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/suppliers/${supplierId}/update`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_active: newStatus })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`ì—…ì²´ ê±°ë˜ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    loadSuppliers();
                } else {
                    alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê³µê¸‰ì—…ì²´ ì‚­ì œ
        async function deleteSupplier(supplierId) {
            if (!confirm('ì´ ì—…ì²´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì—°ê´€ëœ ì‹ìì¬ê°€ ìˆëŠ” ê²½ìš° ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/suppliers/${supplierId}/delete`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ì—…ì²´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadSuppliers();
                } else {
                    alert(result.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì—…ì²´ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê³µê¸‰ì—…ì²´ ëª¨ë‹¬ ë‹«ê¸°
        function closeSupplierModal() {
            document.getElementById('supplier-modal').classList.add('hidden');
            currentEditSupplierId = null;
        }
        
        // ìì½”ë“œ ìë™ ìƒì„± í•¨ìˆ˜
        async function suggestSiteCode() {
            const parentCode = document.getElementById('supplier-parent-code').value.trim();
            if (!parentCode) {
                document.getElementById('supplier-site-code').value = '';
                return;
            }
            
            try {
                // ê¸°ì¡´ ìì½”ë“œë“¤ ì¡°íšŒ
                const response = await fetch(`/api/admin/suppliers/enhanced?search=${parentCode}`);
                const result = await response.json();
                
                if (result.success && result.suppliers) {
                    const existingSiteCodes = result.suppliers
                        .filter(s => s.parent_code === parentCode)
                        .map(s => s.site_code)
                        .filter(code => code && code.includes('-'));
                    
                    // ë‹¤ìŒ ìˆœë²ˆ ê³„ì‚°
                    let nextNumber = 1;
                    if (existingSiteCodes.length > 0) {
                        const numbers = existingSiteCodes.map(code => {
                            const parts = code.split('-');
                            return parseInt(parts[parts.length - 1]) || 0;
                        });
                        nextNumber = Math.max(...numbers) + 1;
                    }
                    
                    // ìì½”ë“œ ìë™ ìƒì„±
                    const suggestedCode = `${parentCode}-${String(nextNumber).padStart(2, '0')}`;
                    document.getElementById('supplier-site-code').value = suggestedCode;
                    
                    // ê¸°ì¡´ ì‚¬ì—…ì¥ ì •ë³´ í‘œì‹œ (existing-sites-info ìš”ì†Œê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ)
                    const infoElement = document.getElementById('existing-sites-info');
                    if (infoElement && existingSiteCodes.length > 0) {
                        infoElement.innerHTML = 
                            `<span style="color: #28a745;">ê¸°ì¡´ ì‚¬ì—…ì¥ ${existingSiteCodes.length}ê°œ | ì‹ ê·œ: ${suggestedCode}</span>`;
                    }
                } else {
                    // ì²« ë²ˆì§¸ ìì½”ë“œ
                    const suggestedCode = `${parentCode}-01`;
                    document.getElementById('supplier-site-code').value = suggestedCode;
                }
            } catch (error) {
                console.error('ìì½”ë“œ ìƒì„± ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ìì½”ë“œ ìƒì„±
                const suggestedCode = `${parentCode}-01`;
                document.getElementById('supplier-site-code').value = suggestedCode;
            }
        }
        
        // ìì½”ë“œ ì§ì ‘ ìˆ˜ì • ê¸°ëŠ¥
        function editSiteCode() {
            const siteCodeInput = document.getElementById('supplier-site-code');
            if (siteCodeInput.readOnly) {
                siteCodeInput.readOnly = false;
                siteCodeInput.style.backgroundColor = '#ffffff';
                siteCodeInput.focus();
            }
        }

        // ===== í†µí•© ì‹ë‹¨í‘œ ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ =====
        
        // ì‹ë‹¨í‘œ íƒ­ ì „í™˜
        function showMealPlanTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¹€
            document.querySelectorAll('.meal-plan-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            const activeTab = document.getElementById(`${tabName}-tab`);
            if (activeTab) activeTab.classList.remove('hidden');
            
            // íƒ­ë³„ ì´ˆê¸°í™” ë¡œì§
            if (tabName === 'master') {
                loadMasterMealPlans();
            } else if (tabName === 'batch') {
                initializeBatchTab();
            }
        }

        // ë§ˆìŠ¤í„° ì‹ë‹¨í‘œ ëª©ë¡ ë¡œë“œ
        function loadMasterMealPlans() {
            const listContainer = document.getElementById('master-meal-plan-list');
            if (listContainer) {
                listContainer.innerHTML = `
                    <div style="display: grid; gap: 15px;">
                        <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4>ğŸ± ë„ì‹œë½ ë§ˆìŠ¤í„° ì‹ë‹¨í‘œ</h4>
                                    <p style="color: #666; margin: 5px 0;">2025ë…„ 9ì›” 2ì£¼ì°¨</p>
                                </div>
                                <div>
                                    <button onclick="editMasterMealPlan('dosirak')" style="padding: 6px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">í¸ì§‘</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4>ğŸšš ìš´ë°˜ ë§ˆìŠ¤í„° ì‹ë‹¨í‘œ</h4>
                                    <p style="color: #666; margin: 5px 0;">2025ë…„ 9ì›” 2ì£¼ì°¨</p>
                                </div>
                                <div>
                                    <button onclick="editMasterMealPlan('transport')" style="padding: 6px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">í¸ì§‘</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ì¼ê´„ íƒ­ ì´ˆê¸°í™”
        function initializeBatchTab() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const weekLater = new Date(today);
            weekLater.setDate(today.getDate() + 7);
            const weekLaterStr = weekLater.toISOString().split('T')[0];
            
            const startDateEl = document.getElementById('batch-start-date');
            const endDateEl = document.getElementById('batch-end-date');
            if (startDateEl) startDateEl.value = todayStr;
            if (endDateEl) endDateEl.value = weekLaterStr;
        }

        // ì‹ë‹¨í‘œ ìœ í˜•ë³„ ê´€ë¦¬
        function manageMealPlanType(type) {
            const typeNames = {
                'dosirak': 'ë„ì‹œë½',
                'transport': 'ìš´ë°˜',
                'school': 'í•™êµ',
                'care': 'ìš”ì–‘ì›'
            };
            alert(`${typeNames[type]} ì‹ë‹¨í‘œ ê´€ë¦¬ ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.`);
        }

        // ë§ˆìŠ¤í„° ì‹ë‹¨í‘œ ìƒì„±
        function createMasterMealPlan() {
            alert('ë§ˆìŠ¤í„° ì‹ë‹¨í‘œ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // ë§ˆìŠ¤í„° ì‹ë‹¨í‘œ í¸ì§‘
        function editMasterMealPlan(type) {
            window.open('meal_plan_management.html', '_blank');
        }

        // ì§€ì‹œì„œ ìƒì„± í•¨ìˆ˜ë“¤
        function generatePreprocessingInstruction() {
            alert('ì „ì²˜ë¦¬ ì§€ì‹œì„œ ì¼ê´„ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        function generateCookingInstruction() {
            alert('ì¡°ë¦¬ ì§€ì‹œì„œ ì¼ê´„ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        function generatePortionInstruction() {
            alert('ì†Œë¶„ ì§€ì‹œì„œ ì¼ê´„ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        function generateAllInstructions() {
            const dateSelect = document.getElementById('instruction-date-select');
            const selectedDate = dateSelect ? dateSelect.value : '';
            
            if (!selectedDate || selectedDate === 'ìƒì„±í•  ë‚ ì§œ ì„ íƒ') {
                alert('ìƒì„±í•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (confirm(`${selectedDate}ì— ëŒ€í•œ ëª¨ë“  ì§€ì‹œì„œ(ì „ì²˜ë¦¬, ì¡°ë¦¬, ì†Œë¶„)ë¥¼ ì¼ê´„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                alert('ëª¨ë“  ì§€ì‹œì„œ ì¼ê´„ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
            }
        }

        // ì¼ê´„ ìƒì„± í•¨ìˆ˜ë“¤
        function batchGenerateMealPlans() {
            const startDate = document.getElementById('batch-start-date')?.value;
            const endDate = document.getElementById('batch-end-date')?.value;
            const targetType = document.getElementById('batch-target-type')?.value;
            
            if (!startDate || !endDate) {
                alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const typeNames = {
                'all': 'ì „ì²´',
                'dosirak': 'ë„ì‹œë½',
                'transport': 'ìš´ë°˜',
                'school': 'í•™êµ',
                'care': 'ìš”ì–‘ì›'
            };
            
            if (confirm(`${startDate}ë¶€í„° ${endDate}ê¹Œì§€ ${typeNames[targetType]} ì‹ë‹¨í‘œë¥¼ ì¼ê´„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                alert('ì¼ê´„ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
            }
        }

        function createFromTemplate() {
            alert('í…œí”Œë¦¿ ê¸°ë°˜ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        function showWeeklyMealPlans() {
            alert('ì£¼ê°„ ì‹ë‹¨í‘œ ë³´ê¸° ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // ì‹ë‹¨ê°€ ê´€ë¦¬ - ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
        async function loadBusinessLocationsForMealPricingDirect() {
            try {
                console.log('ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ ì‹œì‘ (Direct)');
                const response = await fetch('/api/admin/sites/tree');
                const result = await response.json();
                console.log('API ì‘ë‹µ:', result);
                
                const businessLocations = result.sites || [];
                console.log('ì‚¬ì—…ì¥ ë°ì´í„°:', businessLocations);
                
                const select = document.getElementById('businessLocationSelect');
                console.log('select ìš”ì†Œ:', select);
                
                if (select) {
                    select.innerHTML = '<option value="">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    businessLocations.forEach(location => {
                        console.log('ì‚¬ì—…ì¥ ì¶”ê°€:', location);
                        select.innerHTML += `<option value="${location.id}">${location.name}</option>`;
                    });
                    console.log('select ì˜µì…˜ ìµœì¢… ê°œìˆ˜:', select.options.length);
                } else {
                    console.error('businessLocationSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
            } catch (error) {
                console.error('ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                const select = document.getElementById('businessLocationSelect');
                if (select) {
                    select.innerHTML = '<option value="">ì‚¬ì—…ì¥ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</option>';
                }
            }
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.loadBusinessLocationsForMealPricingDirect = loadBusinessLocationsForMealPricingDirect;
        
        // ì‹ë‹¨ê°€ ê´€ë¦¬ - ì „ì—­ ë³€ìˆ˜
        window.mealPlans = [];
        window.currentLocationId = null;
        
        // ì‹ë‹¨í‘œ ë¡œë“œ í•¨ìˆ˜
        async function loadMealPlansForLocation() {
            const businessLocationSelect = document.getElementById('businessLocationSelect');
            const mealPlansContainer = document.getElementById('mealPlansContainer');
            const addMealPlanBtn = document.getElementById('addMealPlanBtn');
            
            if (!businessLocationSelect || !mealPlansContainer) {
                console.error('í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            const selectedLocationId = businessLocationSelect.value;
            window.currentLocationId = selectedLocationId;
            
            console.log('ì„ íƒëœ ì‚¬ì—…ì¥ ID:', selectedLocationId);
            
            if (!selectedLocationId) {
                mealPlansContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 40px;">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ë©´ ì„¸ë¶€ì‹ë‹¨í‘œ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>';
                if (addMealPlanBtn) addMealPlanBtn.style.display = 'none';
                return;
            }
            
            // ì„ íƒëœ ì‚¬ì—…ì¥ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const selectedOption = businessLocationSelect.options[businessLocationSelect.selectedIndex];
            const locationName = selectedOption ? selectedOption.text : 'ì•Œ ìˆ˜ ì—†ìŒ';
            
            // ì‹¤ì œ ë°ì´í„° ë¡œë“œ
            try {
                const response = await fetch(`/api/admin/meal-pricing/by-location/${selectedLocationId}`);
                const result = await response.json();
                
                if (result.success && result.mealPlans && result.mealPlans.length > 0) {
                    // ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
                    window.mealPlans = result.mealPlans.map(plan => ({
                        ...plan,
                        location_name: plan.location_name || locationName
                    }));
                } else {
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì‹ë‹¨í‘œ ìƒì„±
                    window.mealPlans = [
                        {
                            id: null,  // ìƒˆ ë°ì´í„°ì„ì„ í‘œì‹œ
                            name: 'ê¸°ë³¸ ì‹ë‹¨í‘œ',
                            location_name: locationName,
                            meal_time: 'lunch',
                            selling_price: 5000,
                            target_material_cost: 3500,
                            location_id: selectedLocationId
                        }
                    ];
                }
            } catch (error) {
                console.error('ì‹ë‹¨í‘œ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ë°ì´í„°ë¡œ í‘œì‹œ
                window.mealPlans = [
                    {
                        id: null,
                        name: 'ê¸°ë³¸ ì‹ë‹¨í‘œ',
                        location_name: locationName,
                        meal_time: 'lunch',
                        selling_price: 5000,
                        target_material_cost: 3500,
                        location_id: selectedLocationId
                    }
                ];
            }
            
            displayMealPlans();
            
            if (addMealPlanBtn) addMealPlanBtn.style.display = 'inline-block';
        }
        
        // ì‹ë‹¨í‘œ í‘œì‹œ í•¨ìˆ˜
        function displayMealPlans() {
            const mealPlansContainer = document.getElementById('mealPlansContainer');
            if (!mealPlansContainer) return;
            
            if (!window.mealPlans || window.mealPlans.length === 0) {
                mealPlansContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 40px;">ë“±ë¡ëœ ì‹ë‹¨í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const tableHTML = `
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center; font-weight: 600; width: 15%;">ì‚¬ì—…ì¥ëª…</th>
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center; font-weight: 600; width: 12%;">ì‹œê°„ëŒ€</th>
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; width: 20%;">ì‹ë‹¨í‘œëª…</th>
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: right; font-weight: 600; width: 15%;">íŒë§¤ê°€ (ì›)</th>
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: right; font-weight: 600; width: 15%;">ëª©í‘œì¬ë£Œë¹„ (ì›)</th>
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center; font-weight: 600; width: 8%;">ë¹„ìœ¨ (%)</th>
                            <th style="border: 1px solid #dee2e6; padding: 12px; text-align: center; font-weight: 600; width: 15%;">ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${window.mealPlans.map(plan => {
                            const costRatio = plan.selling_price > 0 ? ((plan.target_material_cost / plan.selling_price) * 100).toFixed(1) : 0;
                            const isOverLimit = parseFloat(costRatio) > 40;
                            const ratioColor = isOverLimit ? '#dc3545' : '#28a745';
                            
                            return `
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: center; font-weight: 500;">
                                        ${plan.location_name || ''}
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">
                                        <select id="meal-time-${plan.id}" onchange="updateMealPlanField(${plan.id}, 'meal_time', this.value)" 
                                                style="padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; width: 100%;">
                                            <option value="breakfast" ${plan.meal_time === 'breakfast' ? 'selected' : ''}>ğŸŒ… ì¡°ì‹</option>
                                            <option value="lunch" ${plan.meal_time === 'lunch' ? 'selected' : ''}>â˜€ï¸ ì¤‘ì‹</option>
                                            <option value="dinner" ${plan.meal_time === 'dinner' ? 'selected' : ''}>ğŸŒ™ ì„ì‹</option>
                                            <option value="night" ${plan.meal_time === 'night' ? 'selected' : ''}>ğŸŒƒ ì•¼ì‹</option>
                                        </select>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 12px; font-weight: 500;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="color: #007bff;">ğŸ“‹</span>
                                            <input type="text" id="plan-name-${plan.id}" value="${plan.name}" 
                                                   onchange="updateMealPlanField(${plan.id}, 'name', this.value)"
                                                   style="border: none; background: transparent; font-weight: 500; width: 100%; font-size: 14px;"
                                                   onblur="this.style.background='transparent'" 
                                                   onfocus="this.style.background='#f8f9fa'">
                                        </div>
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: right;">
                                        <input type="text" id="selling-price-${plan.id}" value="${Number(plan.selling_price || 0).toLocaleString()}" 
                                               onchange="updateMealPlanField(${plan.id}, 'selling_price', this.value.replace(/,/g, ''))"
                                               onfocus="this.select()"
                                               style="width: 100px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; text-align: right;">
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: right;">
                                        <input type="text" id="target-cost-${plan.id}" value="${Number(plan.target_material_cost || 0).toLocaleString()}"
                                               onchange="updateMealPlanField(${plan.id}, 'target_material_cost', this.value.replace(/,/g, ''))"
                                               onfocus="this.select()"
                                               style="width: 100px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; text-align: right;">
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">
                                        <span id="cost-ratio-${plan.id}" style="color: ${ratioColor}; font-weight: bold; font-size: 14px;">
                                            ${costRatio}%
                                        </span>
                                        ${isOverLimit ? '<div style="font-size: 10px; color: #dc3545;">âš ï¸ ëª©í‘œ ì´ˆê³¼</div>' : ''}
                                    </td>
                                    <td style="border: 1px solid #dee2e6; padding: 12px; text-align: center;">
                                        <div style="display: flex; gap: 5px; justify-content: center;">
                                            <button onclick="duplicateMealPlan(${plan.id})" 
                                                    style="padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                                ë³µì‚¬
                                            </button>
                                            <button onclick="deleteMealPlan(${plan.id})" 
                                                    style="padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; ${window.mealPlans.length <= 1 ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
                                                ì‚­ì œ
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            mealPlansContainer.innerHTML = tableHTML;
        }
        
        // ì‹ë‹¨í‘œ í•„ë“œ ì—…ë°ì´íŠ¸
        function updateMealPlanField(planId, field, value) {
            const plan = window.mealPlans.find(p => p.id === planId);
            if (plan) {
                if (field === 'name' || field === 'meal_time') {
                    plan[field] = value;
                } else {
                    plan[field] = parseInt(value) || 0;
                }
                displayMealPlans();
            }
        }
        
        // ìƒˆ ì‹ë‹¨í‘œ ì¶”ê°€
        function addNewMealPlan() {
            const name = prompt('ìƒˆ ì‹ë‹¨í‘œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', 'ìƒˆ ì‹ë‹¨í‘œ');
            if (!name || name.trim() === '') return;
            
            // í˜„ì¬ ì„ íƒëœ ì‚¬ì—…ì¥ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const businessLocationSelect = document.getElementById('businessLocationSelect');
            const selectedOption = businessLocationSelect.options[businessLocationSelect.selectedIndex];
            const locationName = selectedOption ? selectedOption.text : 'ì•Œ ìˆ˜ ì—†ìŒ';
            
            const newPlan = {
                id: Date.now(),
                name: name.trim(),
                location_name: locationName,
                meal_time: 'lunch',
                selling_price: 0,
                target_material_cost: 0,
                location_id: window.currentLocationId
            };
            
            window.mealPlans.push(newPlan);
            displayMealPlans();
        }
        
        // ì‹ë‹¨í‘œ ì‚­ì œ
        function deleteMealPlan(planId) {
            if (window.mealPlans.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ì‹ë‹¨í‘œëŠ” ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ì´ ì‹ë‹¨í‘œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            window.mealPlans = window.mealPlans.filter(p => p.id !== planId);
            displayMealPlans();
        }
        
        // ì‹ë‹¨í‘œ ë³µì‚¬
        function duplicateMealPlan(planId) {
            const plan = window.mealPlans.find(p => p.id === planId);
            if (!plan) return;
            
            const newPlan = {
                id: Date.now(),
                name: plan.name + ' (ë³µì‚¬)',
                location_name: plan.location_name,
                meal_time: plan.meal_time,
                selling_price: plan.selling_price,
                target_material_cost: plan.target_material_cost,
                location_id: window.currentLocationId
            };
            
            window.mealPlans.push(newPlan);
            displayMealPlans();
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.loadMealPlansForLocation = loadMealPlansForLocation;
        window.displayMealPlans = displayMealPlans;
        window.updateMealPlanField = updateMealPlanField;
        window.addNewMealPlan = addNewMealPlan;
        window.deleteMealPlan = deleteMealPlan;
        window.duplicateMealPlan = duplicateMealPlan;
        
        // ë‹¨ê°€ê´€ë¦¬ ë° ì‹ë‹¨ê°€ ê´€ë¦¬ í•¨ìˆ˜ë“¤ì€ modules/meal-pricing/meal-pricing.jsë¡œ ì´ë™ë¨
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹ë‹¨ê°€ ê´€ë¦¬ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ì‹ë‹¨ê°€ ê´€ë¦¬ í˜ì´ì§€ê°€ í‘œì‹œë  ë•Œ ì´ˆê¸°í™”
            const mealPricingPage = document.getElementById('meal-pricing-page');
            if (mealPricingPage) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.attributeName === 'class') {
                            if (!mealPricingPage.classList.contains('hidden')) {
                                console.log('ì‹ë‹¨ê°€ ê´€ë¦¬ í˜ì´ì§€ê°€ í‘œì‹œë¨, ì´ˆê¸°í™” ì‹œì‘');
                                // ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ
                                if (typeof loadBusinessLocationsForMealPricingDirect === 'function') {
                                    loadBusinessLocationsForMealPricingDirect();
                                } else {
                                    console.error('loadBusinessLocationsForMealPricingDirect í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                                }
                            }
                        }
                    });
                });
                observer.observe(mealPricingPage, { attributes: true });
            } else {
                console.error('meal-pricing-page ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            // ë§¤í•‘ ê´€ë¦¬ í˜ì´ì§€ê°€ í‘œì‹œë  ë•Œ ë°ì´í„° ë¡œë“œ
            const mappingPage = document.getElementById('supplier-mapping-page');
            if (mappingPage) {
                const mappingObserver = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.attributeName === 'class') {
                            if (!mappingPage.classList.contains('hidden')) {
                                if (typeof loadMappingData === 'function') {
                                    loadMappingData();
                                }
                            }
                        }
                    });
                });
                mappingObserver.observe(mappingPage, { attributes: true });
            }
        });

        // ë§¤í•‘ ê´€ë¦¬ í•¨ìˆ˜ë“¤ì€ modules/mappings/mappings.jsë¡œ ì´ë™ë¨

    </script>
    <!-- Modular Scripts -->
    <!-- ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆë“¤ (ë¨¼ì € ë¡œë“œ) -->
    <script src="/static/modules/utils/utils.js"></script>
    <script src="/static/modules/api/api.js"></script>
    
    <!-- ê¸°ëŠ¥ ëª¨ë“ˆë“¤ -->
    <script src="/static/modules/navigation/navigation.js"></script>
    <script src="/static/modules/dashboard/dashboard.js"></script>
    <script src="/static/modules/users/users.js"></script>
    <script src="/static/modules/suppliers/suppliers.js"></script>
    <script src="/static/modules/sites/sites.js?v=20250905"></script>
    <script src="/static/modules/ingredients/ingredients.js?v=final_20250906"></script>
    <script src="/static/modules/mappings/mappings.js?v=20250906"></script>
    <script src="/static/modules/meal-pricing/meal-pricing.js"></script>
    <script src="/static/modules/settings/settings.js"></script>
    
    <!-- Additional functionality not covered by modules -->
    <!-- <script src="/static/admin-dashboard.js"></script> -->
    
    <!-- Initialize modules after DOM load -->
    <script>
        // ==================== ìƒˆë¡œìš´ ì‘ë™ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ ====================
        
        // ìƒˆë¡œìš´ ì‚¬ìš©ì ìƒì„± í•¨ìˆ˜ - ì™„ì „íˆ ì²˜ìŒë¶€í„°
        async function testCreateUser() {
            const userName = document.getElementById('user-name')?.value?.trim() || '';
            const userData = {
                username: document.getElementById('user-username')?.value?.trim() || '',
                password: document.getElementById('user-password')?.value?.trim() || '',
                role: document.getElementById('user-role')?.value || 'nutritionist',
                department: document.getElementById('user-department')?.value?.trim() || '',
                position: document.getElementById('user-position')?.value?.trim() || '',
                contact_info: userName, // ì´ë¦„ì„ contact_infoì— ì €ì¥
                operator: false,
                semi_operator: false,
                managed_site: ''
            };
            
            console.log('[TEST] ì‚¬ìš©ì ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘:', userData);
            
            try {
                const response = await fetch('http://127.0.0.1:8001/api/admin/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                console.log('[TEST] ì‘ë‹µ ìƒíƒœ:', response.status);
                const result = await response.json();
                console.log('[TEST] ì‘ë‹µ ë°ì´í„°:', result);
                
                if (result.success) {
                    alert('ì‚¬ìš©ì ìƒì„± ì„±ê³µ! ID: ' + result.user_id);
                    // ì‚¬ìš©ì ëª©ë¡ ê°•ì œ ìƒˆë¡œê³ ì¹¨
                    await testLoadUsers();
                    // ëª¨ë‹¬ ë‹«ê¸°
                    const modal = document.getElementById('user-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                    }
                } else {
                    alert('ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                console.error('[TEST] ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }
        
        // ìƒˆë¡œìš´ ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
        async function testLoadUsers() {
            console.log('[TEST] ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹œì‘');
            
            try {
                const response = await fetch('http://127.0.0.1:8001/api/admin/users');
                const result = await response.json();
                
                console.log('[TEST] ì‚¬ìš©ì ëª©ë¡:', result);
                
                if (result.success) {
                    const userTableBody = document.getElementById('users-table-body');
                    if (userTableBody) {
                        userTableBody.innerHTML = result.users.map((user, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${user.username}</td>
                                <td>${user.role}</td>
                                <td>${user.department || '-'}</td>
                                <td>${user.position || '-'}</td>
                                <td>${user.created_at || '-'}</td>
                                <td>
                                    <button class="btn-sm btn-warning">ìˆ˜ì •</button>
                                    <button class="btn-sm btn-danger">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('');
                        console.log('[TEST] ì‚¬ìš©ì í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ:', result.users.length, 'ëª…');
                    }
                }
            } catch (error) {
                console.error('[TEST] ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ìƒˆë¡œìš´ ì‚¬ì—…ì¥ ìƒì„± í•¨ìˆ˜ - ì™„ì „íˆ ì²˜ìŒë¶€í„°
        async function testCreateSite() {
            const siteData = {
                name: 'í…ŒìŠ¤íŠ¸ì‚¬ì—…ì¥_' + Date.now(),
                code: 'TEST' + Date.now(),
                site_type: 'ì¼ë°˜',
                level: 1,
                sort_order: 0,
                address: 'í…ŒìŠ¤íŠ¸ ì£¼ì†Œ',
                contact_phone: '010-1234-5678',
                contact_person: 'ë‹´ë‹¹ì',
                description: 'í…ŒìŠ¤íŠ¸ ì‚¬ì—…ì¥ì…ë‹ˆë‹¤',
                is_active: true,
                parent_id: null,
                portion_size: null
            };
            
            console.log('[TEST] ì‚¬ì—…ì¥ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘:', siteData);
            
            try {
                const response = await fetch('http://127.0.0.1:8001/api/admin/sites', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(siteData)
                });
                
                console.log('[TEST] ì‚¬ì—…ì¥ ì‘ë‹µ ìƒíƒœ:', response.status);
                const result = await response.json();
                console.log('[TEST] ì‚¬ì—…ì¥ ì‘ë‹µ ë°ì´í„°:', result);
                
                if (result.success) {
                    alert('ì‚¬ì—…ì¥ ìƒì„± ì„±ê³µ! ID: ' + result.id);
                    // ì‚¬ì—…ì¥ ëª©ë¡ ê°•ì œ ìƒˆë¡œê³ ì¹¨
                    await testLoadSites();
                    // ëª¨ë‹¬ ë‹«ê¸°
                    const modal = document.getElementById('site-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                    }
                } else {
                    alert('ì‚¬ì—…ì¥ ìƒì„± ì‹¤íŒ¨: ' + JSON.stringify(result));
                }
            } catch (error) {
                console.error('[TEST] ì‚¬ì—…ì¥ ìƒì„± ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }
        
        // ìƒˆë¡œìš´ ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
        async function testLoadSites() {
            console.log('[TEST] ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ ì‹œì‘');
            
            try {
                const response = await fetch('http://127.0.0.1:8001/api/admin/sites');
                const result = await response.json();
                
                console.log('[TEST] ì‚¬ì—…ì¥ ëª©ë¡:', result);
                
                if (result.success) {
                    const sitesContainer = document.getElementById('sites-tree');
                    if (sitesContainer) {
                        const sitesHtml = (result.sites || []).map(site => `
                            <div class="tree-node" data-site-id="${site.id}">
                                <div class="tree-item">
                                    <span class="site-name">${site.name}</span>
                                    <span class="site-type">(${site.site_type})</span>
                                    <span class="site-code">[${site.code}]</span>
                                </div>
                            </div>
                        `).join('');
                        
                        sitesContainer.innerHTML = `
                            <div class="sites-tree">
                                ${sitesHtml}
                            </div>
                        `;
                        console.log('[TEST] ì‚¬ì—…ì¥ íŠ¸ë¦¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', (result.tree || result.sites || []).length, 'ê°œ');
                    }
                }
            } catch (error) {
                console.error('[TEST] ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.testCreateUser = testCreateUser;
        window.testLoadUsers = testLoadUsers;
        window.testCreateSite = testCreateSite;
        window.testLoadSites = testLoadSites;
        
        console.log('í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ ì¤€ë¹„ ì™„ë£Œ - testCreateUser(), testCreateSite() ë“± ì‚¬ìš© ê°€ëŠ¥');
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize global variables from original admin-dashboard.js
            let pageInitialized = false;
            let allowModalDisplay = false;
            
            // Force hide all modals
            setTimeout(() => {
                const userModal = document.getElementById('user-modal');
                const siteModal = document.getElementById('site-modal');
                
                if (userModal) {
                    userModal.style.display = 'none';
                    userModal.classList.add('hidden');
                    console.log('ì‚¬ìš©ì ëª¨ë‹¬ ê°•ì œ ìˆ¨ê¹€');
                }
                if (siteModal) {
                    siteModal.style.display = 'none';
                    siteModal.classList.add('hidden');
                    console.log('ì‚¬ì—…ì¥ ëª¨ë‹¬ ê°•ì œ ìˆ¨ê¹€');
                }
                
                // Initialize variables
                if (typeof currentEditUserId !== 'undefined') {
                    currentEditUserId = null;
                }
                if (typeof currentEditSiteId !== 'undefined') {
                    currentEditSiteId = null;
                }
                
                console.log('ëª¨ë“  ëª¨ë‹¬ ìˆ¨ê¹€ ì²˜ë¦¬ ì™„ë£Œ');
                
                // Allow modal display after 1 second
                setTimeout(() => {
                    pageInitialized = true;
                    allowModalDisplay = true;
                    console.log('ëª¨ë‹¬ í‘œì‹œ í—ˆìš©ë¨');
                }, 1000);
            }, 100);
            
            // Show dashboard by default
            console.log('ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ í‘œì‹œ');
            if (window.showPage) {
                window.showPage('dashboard');
            }
            
            if (window.DashboardModule && window.DashboardModule.loadDashboardData) {
                window.DashboardModule.loadDashboardData();
            }
        });
    </script>

    <!-- ì‚¬ì—…ì¥ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="business-location-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 10px; padding: 30px; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>ì‚¬ì—…ì¥ ì •ë³´ í¸ì§‘</h3>
                <button onclick="closeBusinessLocationModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            
            <form id="business-location-form">
                <input type="hidden" id="edit-customer-id" />
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>ì‚¬ì—…ì¥ëª… *</label>
                        <input type="text" id="edit-customer-name" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required />
                    </div>
                    
                    <div class="form-group">
                        <label>ì‚¬ì—…ì¥ì½”ë“œ</label>
                        <input type="text" id="edit-customer-code" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                    </div>
                    
                    <div class="form-group">
                        <label>ì‚¬ì—…ì¥ìœ í˜•</label>
                        <select id="edit-customer-type" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë³¸ì‚¬">ë³¸ì‚¬</option>
                            <option value="ì§€ì‚¬">ì§€ì‚¬</option>
                            <option value="ê³µì¥">ê³µì¥</option>
                            <option value="ìœ„íƒ">ìœ„íƒ</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ë‹´ë‹¹ì</label>
                        <input type="text" id="edit-customer-contact" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                    </div>
                    
                    <div class="form-group">
                        <label>ì—°ë½ì²˜</label>
                        <input type="tel" id="edit-customer-phone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                    </div>
                    
                    <div class="form-group">
                        <label>ê¸‰ì‹ì¸ì›</label>
                        <input type="number" id="edit-customer-portion" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" min="0" />
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>ì£¼ì†Œ</label>
                    <textarea id="edit-customer-address" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" rows="2"></textarea>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>ì„¤ëª…</label>
                    <textarea id="edit-customer-description" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" rows="3"></textarea>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" id="edit-customer-active" style="margin-right: 8px;" />
                        ìš´ì˜ì¤‘
                    </label>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                    <button type="button" onclick="closeBusinessLocationModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        ì·¨ì†Œ
                    </button>
                    <button type="button" onclick="saveBusinessLocation()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-save"></i> ì €ì¥
                    </button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>