<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>15ì¼ ì‹ìˆ˜ ê´€ë¦¬ - ë‹¤í•¨ì‹ë‹¨ê´€ë¦¬ì‹œìŠ¤í…œ v2.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
            font-size: 13px;
        }
        
        .navigation-bar {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            display: flex;
            align-items: center;
            padding: 10px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            color: white;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-item.active {
            background: rgba(255,255,255,0.2);
            font-weight: 600;
        }
        
        .nav-logo {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-right: 30px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .date-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-controls input {
            padding: 6px 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 12px;
        }

        .date-controls button {
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        .date-controls button:hover {
            background: rgba(255,255,255,0.3);
        }

        /* íƒ­ ì‹œìŠ¤í…œ */
        .tab-container {
            background: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tab-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.2s;
            position: relative;
        }

        .tab-button.active {
            color: #667eea;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab-button:hover {
            background: #f1f3f4;
        }

        /* ë©”ì¸ íƒ€ì„ë¼ì¸ í…Œì´ë¸” */
        .timeline-container {
            padding: 20px;
            overflow-x: auto;
        }

        .timeline-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
            background: white;
        }

        .timeline-table th,
        .timeline-table td {
            border: 1px solid #e0e0e0;
            padding: 6px 8px;
            text-align: center;
            font-size: 12px;
            white-space: nowrap;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .timeline-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .timeline-table th.category-header {
            background: #495057;
            color: white;
            font-weight: 600;
        }

        /* ë‚ ì§œ ì—´ ìŠ¤íƒ€ì¼ */
        .date-column {
            width: 60px;
            min-width: 60px;
        }

        .date-header {
            writing-mode: horizontal-tb;
            height: 60px;
            vertical-align: middle;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            line-height: 1.2;
        }

        /* ê³¼ê±°/í˜„ì¬/ë¯¸ë˜ êµ¬ë¶„ */
        .past-date {
            background: #e9ecef !important;
            color: #495057 !important;
            font-size: 16px !important;
        }

        .today-date {
            background: #ffeaa7 !important;
            color: #e17055 !important;
            font-weight: bold;
            font-size: 18px !important;
        }

        .future-date {
            background: #a8dadc !important;
            color: #1d3557 !important;
            font-size: 16px !important;
        }

        /* ì…ë ¥ í•„ë“œ */
        .meal-input {
            width: 55px;
            text-align: right;
            padding: 2px 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
        }

        .meal-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .meal-input[readonly] {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        .meal-input.changed {
            background-color: #fff3cd;
            border-color: #ffc107;
        }

        /* ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™” */
        .category-group {
            border-top: 2px solid #667eea;
        }

        .category-label {
            background: #f8f9ff !important;
            font-weight: 600;
            color: #333;
            text-align: left !important;
            padding-left: 12px !important;
        }

        .editable-category:hover {
            background: #e6f2ff !important;
            cursor: pointer;
        }

        .category-edit-input {
            background: #fff;
            border: 2px solid #007bff;
            padding: 2px 6px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            border-radius: 3px;
            outline: none;
        }

        .edit-icon {
            cursor: pointer;
            margin: 0 8px;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 16px;
            transition: background-color 0.2s;
        }

        .edit-icon:hover {
            background-color: rgba(0, 123, 255, 0.1);
        }

        .add-site-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.2s;
        }

        .add-site-btn:hover {
            background: #218838;
        }

        .delete-site-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 5px;
        }

        .delete-site-btn:hover {
            background: #c82333;
        }

        .category-subtotal {
            background: #f1f3f4 !important;
            border-top: 1px solid #d0d7de;
        }

        .subtotal-cell {
            background: #f1f3f4 !important;
            font-weight: bold;
            color: #666;
            font-size: 12px;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 25px;
        }

        .tab-manager-section h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .tab-manager-section p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-actions {
            margin-top: 25px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tab-config-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f9f9f9;
        }

        .tab-specific-controls {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        .tab-specific-controls h5 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-sm:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        .simple-config-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f8ff;
            border: 1px solid #cce7ff;
            border-radius: 6px;
        }

        .simple-config-section h4 {
            margin-bottom: 8px;
            color: #0066cc;
        }

        .simple-config-section p {
            margin-bottom: 12px;
            font-size: 13px;
            color: #666;
        }

        .simple-config-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .simple-config-buttons .btn {
            padding: 8px 12px;
            font-size: 12px;
        }

        .meal-category-checkbox {
            position: relative;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .edit-name-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            padding: 2px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .edit-name-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .category-name-input {
            border: 1px solid #007bff;
            padding: 2px 4px;
            font-size: 12px;
            border-radius: 3px;
            min-width: 80px;
        }

        .meal-time-groups {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .meal-time-group {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 12px;
            background: #fafafa;
        }

        .meal-time-header {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 4px;
        }

        .meal-time-group .meal-category-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .meal-time-group .meal-category-checkbox {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 12px;
        }

        .tab-config-header {
            font-weight: bold;
            color: #444;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meal-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .meal-category-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 8px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .meal-category-checkbox:hover {
            background: #e6f2ff;
            border-color: #007bff;
        }

        .meal-category-checkbox input[type="checkbox"] {
            margin: 0;
        }

        .meal-category-checkbox.checked {
            background: #e8f5e8;
            border-color: #28a745;
        }

        .site-row {
            background: white;
        }

        .site-row:hover {
            background: #f8f9ff;
        }

        /* í•©ê³„ í–‰ */
        .total-row {
            background: #e9ecef !important;
            font-weight: 600;
            border-top: 2px solid #6c757d;
        }

        .total-cell {
            background: #dee2e6 !important;
            font-weight: bold;
            text-align: right;
            padding-right: 8px;
        }

        /* ë„êµ¬ ëª¨ìŒ */
        .toolbar {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            color: #333;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-success {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
            border-color: #ffc107;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        /* ìƒíƒœ í‘œì‹œ */
        .status-bar {
            padding: 10px 20px;
            background: #e9ecef;
            font-size: 11px;
            color: #6c757d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .legend {
            display: flex;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .legend-past { background: #f8f9fa; border: 1px solid #dee2e6; }
        .legend-today { background: #fff3cd; border: 1px solid #ffc107; }
        .legend-future { background: #d1ecf1; border: 1px solid #bee5eb; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .tab-container {
                margin: 10px;
            }
            
            .timeline-container {
                padding: 10px;
            }
            
            .toolbar {
                padding: 10px;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .timeline-container::-webkit-scrollbar {
            height: 8px;
        }

        .timeline-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .timeline-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .timeline-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <div class="navigation-bar">
        <div class="nav-logo">ğŸ½ï¸ ë‹¤í•¨ì‹ë‹¨ê´€ë¦¬ì‹œìŠ¤í…œ</div>
        <a href="/dashboard" class="nav-item">ğŸ“ˆ ëŒ€ì‹œë³´ë“œ</a>
        <a href="/" class="nav-item">ğŸ“‹ ë©”ë‰´/ë ˆì‹œí”¼ ê´€ë¦¬</a>
        <a href="/meal-count" class="nav-item active">ğŸ‘¥ ì‹ìˆ˜ ë“±ë¡ ê´€ë¦¬</a>
        <a href="/meal-plan" class="nav-item">ğŸ“Š ì‹ë‹¨í‘œ ì‘ì„±</a>
        <a href="/ordering" class="nav-item">ğŸ“ˆ ë°œì£¼ ê´€ë¦¬</a>
        <a href="#" class="nav-item">ğŸ“¦ ì…ê³ ëª…ì„¸ì„œ ê´€ë¦¬</a>
        <a href="#" class="nav-item">ğŸ“‹ ê°ì¢… ì¼ì§€</a>
        <a href="#" class="nav-item">ğŸ”ª ì „ì²˜ë¦¬ì§€ì‹œì„œ</a>
        <a href="#" class="nav-item">ğŸ‘¨â€ğŸ³ ì¡°ë¦¬ì§€ì‹œì„œ</a>
        <a href="#" class="nav-item">ğŸ“Š ì†Œë¶„ì§€ì‹œì„œ</a>
    </div>

    <div class="header">
        <h1>ğŸ“… 15ì¼ ì‹ìˆ˜ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <div class="header-controls">
            <div class="date-controls">
                <label style="color: white; font-size: 12px;">ê¸°ì¤€ì¼:</label>
                <input type="date" id="base-date" style="color: #333;">
                <button onclick="moveWeek(-1)">â† ì´ì „ì£¼</button>
                <button onclick="setToday()">ì˜¤ëŠ˜</button>
                <button onclick="moveWeek(1)">ë‹¤ìŒì£¼ â†’</button>
            </div>
            <div style="color: rgba(255,255,255,0.8); font-size: 11px;" id="period-display">
                2025.08.27 ~ 2025.09.10 (15ì¼)
            </div>
        </div>
    </div>

    <!-- íƒ­ ì»¨í…Œì´ë„ˆ -->
    <div class="tab-container">
        <!-- íƒ­ í—¤ë” -->
        <div class="tab-header">
            <button class="tab-button active" data-tab="ì‹ìˆ˜í•©ê³„" onclick="switchTab('ì‹ìˆ˜í•©ê³„')">
                ğŸ“Š ì‹ìˆ˜í•©ê³„
            </button>
            <button class="tab-button" data-tab="ë„ì‹œë½" onclick="switchTab('ë„ì‹œë½')">
                ğŸ± ë„ì‹œë½
            </button>
            <button class="tab-button" data-tab="ìš´ë°˜" onclick="switchTab('ìš´ë°˜')">
                ğŸšš ìš´ë°˜
            </button>
            <button class="tab-button" data-tab="í•™êµ" onclick="switchTab('í•™êµ')">
                ğŸ« í•™êµ
            </button>
            <button class="tab-button" data-tab="ìš”ì–‘ì›" onclick="switchTab('ìš”ì–‘ì›')">
                ğŸ¥ ìš”ì–‘ì›
            </button>
            <button class="tab-button" data-tab="í™•ì¥1" onclick="switchTab('í™•ì¥1')">
                ğŸ“‹ í™•ì¥1
            </button>
        </div>

        <!-- ë„êµ¬ ëª¨ìŒ -->
        <div class="toolbar">
            <button class="btn btn-primary" onclick="copyPreviousDay()">
                ğŸ“‹ ì „ë‚  ë³µì‚¬
            </button>
            <button class="btn btn-success" onclick="generatePrediction()">
                ğŸ”® ì˜ˆìƒê°’ ìƒì„±
            </button>
            <button class="btn btn-info" onclick="openTabManagerModal()">
                âš™ï¸ íƒ­ ê´€ë¦¬
            </button>
            <button class="btn btn-warning" onclick="saveAllChanges()">
                ğŸ’¾ ì¼ê´„ ì €ì¥
            </button>
            <button class="btn" onclick="exportToExcel()">
                ğŸ“Š Excel ë‚´ë³´ë‚´ê¸°
            </button>
            <div style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 11px; color: #6c757d;">ìë™ì €ì¥:</span>
                <label style="font-size: 11px;">
                    <input type="checkbox" id="auto-save" checked> ì¼œê¸°
                </label>
            </div>
        </div>

        <!-- íƒ€ì„ë¼ì¸ í…Œì´ë¸” -->
        <div class="timeline-container">
            <table class="timeline-table" id="main-timeline-table">
                <thead>
                    <tr>
                        <th rowspan="2" style="width: 150px;">ì„¸ë¶€ì‹ë‹¨/ì‚¬ì—…ì¥</th>
                        <th rowspan="2" style="width: 80px;">ëª©í‘œì‹ì¬ë£Œë¹„</th>
                        <!-- ë‚ ì§œ í—¤ë”ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tr>
                    <tr>
                        <!-- ìš”ì¼ í—¤ë”ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tr>
                </thead>
                <tbody id="timeline-tbody">
                    <tr>
                        <td colspan="16" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ìƒíƒœ í‘œì‹œì¤„ -->
        <div class="status-bar">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color legend-past"></div>
                    <span>ê³¼ê±° ì‹¤ì  (3ì¼)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-today"></div>
                    <span>ì˜¤ëŠ˜</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-future"></div>
                    <span>ì˜ˆìƒ ë°ì´í„°</span>
                </div>
            </div>
            <div id="status-info">
                ì´ ë³€ê²½ì‚¬í•­: <span id="change-count">0</span>ê°œ | 
                ë§ˆì§€ë§‰ ì €ì¥: <span id="last-save">-</span>
            </div>
        </div>
    </div>

    <!-- íƒ­ ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="tabManagerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš™ï¸ íƒ­ ë° ì„¸ë¶€ì‹ë‹¨ ê´€ë¦¬</h3>
                <span class="close" onclick="closeTabManagerModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="tab-manager-section">
                    <h4>ğŸ“‹ íƒ­ë³„ ì„¸ë¶€ì‹ë‹¨ êµ¬ì„±</h4>
                    <p>ê° íƒ­ì˜ ì„¸ë¶€ì‹ë‹¨ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì€ ì‚¬ì—…ì¥ì˜ ê²½ìš° í•„ìš”í•œ ì‹ë‹¨ë§Œ ì„ íƒí•˜ì„¸ìš”.</p>
                    
                    <div id="tabManagerContent">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  íƒ­ ê´€ë¦¬ ì½˜í…ì¸  -->
                    </div>
                    
                    <div class="simple-config-section">
                        <h4>ğŸª ì‘ì€ ì‚¬ì—…ì¥ìš© ê°„ë‹¨ ì„¤ì •</h4>
                        <p>ì‘ì€ ì‚¬ì—…ì¥ì„ ìœ„í•œ ê¸°ë³¸ êµ¬ì„±ì„ ì„ íƒí•˜ì„¸ìš”:</p>
                        <div class="simple-config-buttons">
                            <button class="btn btn-info" onclick="applySimpleConfig('basic')">ğŸ± ê¸°ë³¸í˜• (ğŸŒ…ì¡°ì‹A + ğŸ½ï¸ì¤‘ì‹A + ğŸŒ†ì„ì‹A)</button>
                            <button class="btn btn-info" onclick="applySimpleConfig('lunch-only')">ğŸš ì¤‘ì‹ì „ìš© (ğŸ½ï¸ì¤‘ì‹Aë§Œ)</button>
                            <button class="btn btn-info" onclick="applySimpleConfig('school')">ğŸ« í•™êµí˜• (ğŸ½ï¸ì¤‘ì‹A,B + ğŸŒ†ì„ì‹A)</button>
                            <button class="btn btn-info" onclick="applySimpleConfig('nursing')">ğŸ¥ ìš”ì–‘ì›í˜• (ğŸŒ…ì¡°ì‹A + ğŸ½ï¸ì¤‘ì‹A,B + ğŸŒ†ì„ì‹A + ğŸŒ™ì•¼ì‹A)</button>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn btn-success" onclick="saveTabConfiguration()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="resetToDefault()">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
                        <button class="btn btn-secondary" onclick="closeTabManagerModal()">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentTab = 'ì‹ìˆ˜í•©ê³„';
        let baseDate = new Date();
        let timelineDates = [];
        let mealData = {};
        let changeCount = 0;
        let autoSaveEnabled = true;
        
        // ì„¸ë¶€ì‹ë‹¨ ëª…ì¹­ ë§¤í•‘ (ê¸°ë³¸ê°’ â†’ ì‚¬ìš©ì ì •ì˜ ëª…ì¹­)
        let mealCategoryNames = {
            'ì¡°ì‹A': 'ì¡°ì‹A', 'ì¡°ì‹B': 'ì¡°ì‹B', 'ì¡°ì‹C': 'ì¡°ì‹C', 'ì¡°ì‹D': 'ì¡°ì‹D', 'ì¡°ì‹E': 'ì¡°ì‹E',
            'ì¤‘ì‹A': 'ì¤‘ì‹A', 'ì¤‘ì‹B': 'ì¤‘ì‹B', 'ì¤‘ì‹C': 'ì¤‘ì‹C', 'ì¤‘ì‹D': 'ì¤‘ì‹D', 'ì¤‘ì‹E': 'ì¤‘ì‹E',
            'ì„ì‹A': 'ì„ì‹A', 'ì„ì‹B': 'ì„ì‹B', 'ì„ì‹C': 'ì„ì‹C',
            'ì•¼ì‹A': 'ì•¼ì‹A', 'ì•¼ì‹B': 'ì•¼ì‹B',
            'íŠ¹ì‹A': 'íŠ¹ì‹A', 'íŠ¹ì‹B': 'íŠ¹ì‹B', 'íŠ¹ì‹C': 'íŠ¹ì‹C', 'íŠ¹ì‹D': 'íŠ¹ì‹D', 'íŠ¹ì‹E': 'íŠ¹ì‹E'
        };

        // ìƒ˜í”Œ ë°ì´í„° êµ¬ì¡°
        const sampleData = {
            'ì‹ìˆ˜í•©ê³„': {
                'ì „ì²´í•©ê³„': [['ëª¨ë“  íƒ­ì˜ í•©ê³„']]
            },
            'ë„ì‹œë½': {
                'ì¡°ì‹A': [],
                'ì¡°ì‹B': [],
                'ì¡°ì‹C': [],
                'ì¡°ì‹D': [],
                'ì¤‘ì‹A': [],
                'ì¤‘ì‹B': [],
                'ì¤‘ì‹C': [],
                'ì¤‘ì‹D': [],
                'ì¤‘ì‹E': [],
                'ì„ì‹A': [],
                'ì„ì‹B': [],
                'ì„ì‹C': [],
                'ì•¼ì‹A': [],
                'ì•¼ì‹B': [],
                'íŠ¹ì‹A': []
            },
            'ìš´ë°˜': {
                'ì¡°ì‹A': [],
                'ì¡°ì‹B': [],
                'ì¡°ì‹C': [],
                'ì¡°ì‹D': [],
                'ì¤‘ì‹A': [],
                'ì¤‘ì‹B': [],
                'ì¤‘ì‹C': [],
                'ì¤‘ì‹D': [],
                'ì¤‘ì‹E': [],
                'ì„ì‹A': [],
                'ì„ì‹B': [],
                'ì•¼ì‹A': [],
                'ì•¼ì‹B': [],
                'íŠ¹ì‹A': [],
                'íŠ¹ì‹B': []
            },
            'í•™êµ': {
                'ì¡°ì‹A': [],
                'ì¡°ì‹B': [],
                'ì¡°ì‹C': [],
                'ì¡°ì‹D': [],
                'ì¡°ì‹E': [],
                'ì¤‘ì‹A': [],
                'ì¤‘ì‹B': [],
                'ì¤‘ì‹C': [],
                'ì¤‘ì‹D': [],
                'ì¤‘ì‹E': [],
                'ì„ì‹A': [],
                'ì„ì‹B': [],
                'ì„ì‹C': [],
                'ì•¼ì‹A': [],
                'íŠ¹ì‹A': []
            },
            'ìš”ì–‘ì›': {
                'ì¡°ì‹A': [],
                'ì¡°ì‹B': [],
                'ì¡°ì‹C': [],
                'ì¡°ì‹D': [],
                'ì¤‘ì‹A': [],
                'ì¤‘ì‹B': [],
                'ì¤‘ì‹C': [],
                'ì¤‘ì‹D': [],
                'ì¤‘ì‹E': [],
                'ì„ì‹A': [],
                'ì„ì‹B': [],
                'ì„ì‹C': [],
                'ì•¼ì‹A': [],
                'ì•¼ì‹B': [],
                'íŠ¹ì‹A': []
            },
            'í™•ì¥1': {
                'ì¡°ì‹A': [],
                'ì¡°ì‹B': [],
                'ì¡°ì‹C': [],
                'ì¤‘ì‹A': [],
                'ì¤‘ì‹B': [],
                'ì¤‘ì‹C': [],
                'ì¤‘ì‹D': [],
                'ì„ì‹A': [],
                'ì„ì‹B': [],
                'ì•¼ì‹A': [],
                'íŠ¹ì‹A': [],
                'íŠ¹ì‹B': [],
                'íŠ¹ì‹C': [],
                'íŠ¹ì‹D': [],
                'íŠ¹ì‹E': []
            }
        };

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ìºì‹œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ (ê°œë°œìš©)
            console.log('Timeline system v2.1 - Cache cleared');
            
            initializePage();
            generateTimeline();
            loadData();

            // ìë™ì €ì¥ ì„¤ì •
            document.getElementById('auto-save').addEventListener('change', function() {
                autoSaveEnabled = this.checked;
            });

            // ê¸°ì¤€ì¼ ë³€ê²½ ê°ì§€
            document.getElementById('base-date').addEventListener('change', function() {
                baseDate = new Date(this.value);
                generateTimeline();
                loadData();
            });
        });

        // í˜ì´ì§€ ì´ˆê¸°í™”
        function initializePage() {
            const today = new Date();
            baseDate = today;
            document.getElementById('base-date').value = today.toISOString().split('T')[0];
        }

        // íƒ€ì„ë¼ì¸ ë‚ ì§œ ìƒì„± (ê³¼ê±° 3ì¼ + ì˜¤ëŠ˜ + ë¯¸ë˜ 11ì¼)
        function generateTimeline() {
            timelineDates = [];
            const startDate = new Date(baseDate);
            startDate.setDate(startDate.getDate() - 3); // ê³¼ê±° 3ì¼ë¶€í„° ì‹œì‘

            for (let i = 0; i < 15; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                timelineDates.push(date);
            }

            updatePeriodDisplay();
            generateTableHeaders();
        }

        // ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updatePeriodDisplay() {
            const startDate = timelineDates[0];
            const endDate = timelineDates[timelineDates.length - 1];
            const periodText = `${formatDate(startDate, 'YYYY.MM.DD')} ~ ${formatDate(endDate, 'YYYY.MM.DD')} (15ì¼)`;
            document.getElementById('period-display').textContent = periodText;
        }

        // í…Œì´ë¸” í—¤ë” ìƒì„±
        function generateTableHeaders() {
            const table = document.getElementById('main-timeline-table');
            const thead = table.querySelector('thead');
            
            // ê¸°ì¡´ í—¤ë” ì œê±°
            thead.innerHTML = '';

            // ë‚ ì§œ í—¤ë” í–‰
            const dateHeaderRow = document.createElement('tr');
            dateHeaderRow.innerHTML = '<th rowspan="2" style="width: 150px;">ì„¸ë¶€ì‹ë‹¨/ì‚¬ì—…ì¥</th><th rowspan="2" style="width: 80px;">ëª©í‘œì‹ì¬ë£Œë¹„</th>';
            
            // ìš”ì¼ í—¤ë” í–‰
            const dayHeaderRow = document.createElement('tr');

            timelineDates.forEach((date, index) => {
                const dateStr = formatDate(date, 'MM/DD');
                const dayStr = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                
                // ê³¼ê±°/í˜„ì¬/ë¯¸ë˜ êµ¬ë¶„
                let dateClass = '';
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                date.setHours(0, 0, 0, 0);
                
                if (date < today) {
                    dateClass = 'past-date';
                } else if (date.getTime() === today.getTime()) {
                    dateClass = 'today-date';
                } else {
                    dateClass = 'future-date';
                }

                dateHeaderRow.innerHTML += `<th class="date-column date-header ${dateClass}">${dateStr}</th>`;
                dayHeaderRow.innerHTML += `<th class="date-column ${dateClass}">${dayStr}</th>`;
            });

            thead.appendChild(dateHeaderRow);
            thead.appendChild(dayHeaderRow);
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            const tbody = document.getElementById('timeline-tbody');
            tbody.innerHTML = '<tr><td colspan="16" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>';

            try {
                // íƒ€ì„ë¼ì¸ ë°ì´í„° API í˜¸ì¶œ (ì¸ì¦ ë¶ˆí•„ìš”)
                const startDate = formatDate(timelineDates[0], 'YYYY-MM-DD');
                const endDate = formatDate(timelineDates[timelineDates.length - 1], 'YYYY-MM-DD');
                
                const response = await fetch(`/api/meal-counts/timeline?tab=${currentTab}&start_date=${startDate}&end_date=${endDate}&_t=${Date.now()}`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        mealData = result.data;
                        generateTableContent();
                    } else {
                        throw new Error(result.message || 'API ì‘ë‹µ ì˜¤ë¥˜');
                    }
                } else {
                    // APIê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ì¸ ê²½ìš° ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                    console.log('API ì—†ìŒ, ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©');
                    generateTableContent();
                }
            } catch (error) {
                console.log('API ì˜¤ë¥˜, ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©:', error.message);
                // ì˜¤ë¥˜ ë°œìƒì‹œ ìƒ˜í”Œ ë°ì´í„°ë¡œ í‘œì‹œ
                generateTableContent();
            }
        }

        // í…Œì´ë¸” ë‚´ìš© ìƒì„±
        async function generateTableContent() {
            const tbody = document.getElementById('timeline-tbody');
            tbody.innerHTML = '';

            try {
                // í…œí”Œë¦¿ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const templateResponse = await fetch(`/api/meal-counts/templates/${currentTab}?_t=${Date.now()}`);
                const templateData = await templateResponse.json();
                
                let currentTabData;
                if (currentTab === 'ì‹ìˆ˜í•©ê³„') {
                    // ì‹ìˆ˜í•©ê³„ íƒ­ì¸ ê²½ìš° ëª¨ë“  íƒ­ì˜ ë°ì´í„°ë¥¼ í•©ì‚°
                    currentTabData = generateSummaryTabData();
                } else if (templateResponse.ok && templateData.success) {
                    currentTabData = templateData.data;
                } else {
                    // í…œí”Œë¦¿ APIê°€ ì—†ìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                    currentTabData = sampleData[currentTab] || {};
                }

                const dailyTotals = new Array(15).fill(0);
                let categoryHTML = '';

                // ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„° ìƒì„±
                for (const [category, sites] of Object.entries(currentTabData)) {
                    let siteList = [];
                    if (Array.isArray(sites)) {
                        // APIì—ì„œ ë°›ì€ ë°ì´í„°: [{site_name: string, default_count: number}, ...]
                        siteList = sites.map(s => typeof s === 'string' ? s : (s.site_name || String(s)));
                    } else {
                        siteList = [String(sites)];
                    }
                    
                    // ì¹´í…Œê³ ë¦¬ í—¤ë”ë¥¼ HTML ë¬¸ìì—´ë¡œ ì¶”ê°€ (í¸ì§‘ ê°€ëŠ¥)
                    const displayName = mealCategoryNames[category] || category;
                    categoryHTML += `
                        <tr class="category-group">
                            <td class="category-label editable-category" colspan="17" 
                                data-original-name="${category}">
                                ğŸ“ <span class="category-name" data-original="${category}">${displayName}</span> 
                                <span class="edit-icon" onclick="editCategoryFromTable('${category}')" title="í´ë¦­í•˜ì—¬ ì‹ë‹¨ëª… ìˆ˜ì •">âœï¸</span>
                                (${siteList.length}ê°œ ì‚¬ì—…ì¥)
                                <button class="add-site-btn" onclick="addSiteToCategory('${category}')" title="ì‚¬ì—…ì¥ ì¶”ê°€">+ ì¶”ê°€</button>
                            </td>
                        </tr>
                    `;

                    // ì‚¬ì—…ì¥ì´ ì—†ëŠ” ê²½ìš° ì¹´í…Œê³ ë¦¬ì— ì§ì ‘ ì…ë ¥í•  ìˆ˜ ìˆëŠ” í–‰ ì¶”ê°€
                    if (siteList.length === 0) {
                        let directInputRowHTML = `
                            <tr class="site-row direct-category-input" data-category="${category}" data-site="ì§ì ‘ì…ë ¥">
                                <td class="category-label" style="padding-left: 24px;">
                                    ğŸ’¡ ì§ì ‘ ì…ë ¥
                                </td>
                                <td class="editable-cost" style="text-align: right; padding-right: 8px; font-size: 12px; color: #666; cursor: pointer;" 
                                    onclick="editTargetCost(this)" title="í´ë¦­í•˜ì—¬ ëª©í‘œ ì‹ì¬ë£Œë¹„ ìˆ˜ì •">1,700ì›</td>
                        `;
                        
                        // ê° ë‚ ì§œë³„ ì…ë ¥ í•„ë“œ ì¶”ê°€
                        timelineDates.forEach((date, dateIndex) => {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);
                            date.setHours(0, 0, 0, 0);
                            
                            const isReadonly = date < today;
                            const dateStr = formatDate(date, 'YYYY-MM-DD');
                            
                            let cellClass = '';
                            if (date < today) {
                                cellClass = 'past-date';
                            } else if (date.getTime() === today.getTime()) {
                                cellClass = 'today-date';
                            } else {
                                cellClass = 'future-date';
                            }

                            // ì‹¤ì œ ë°ì´í„° ë˜ëŠ” ìƒ˜í”Œ ë°ì´í„°
                            let mealValue = 0;
                            if (mealData[category] && mealData[category]['ì§ì ‘ì…ë ¥'] && mealData[category]['ì§ì ‘ì…ë ¥'][dateStr]) {
                                mealValue = mealData[category]['ì§ì ‘ì…ë ¥'][dateStr].meal_count;
                            }
                            
                            dailyTotals[dateIndex] += mealValue;

                            directInputRowHTML += `
                                <td class="${cellClass}">
                                    <input type="number" 
                                           class="meal-input" 
                                           value="${mealValue}" 
                                           ${isReadonly ? 'readonly' : ''}
                                           data-category="${category}"
                                           data-site="ì§ì ‘ì…ë ¥"
                                           data-date="${dateStr}"
                                           onchange="onDataChange(this)"
                                           onblur="onInputBlur(this)">
                                </td>
                            `;
                        });
                        
                        directInputRowHTML += '</tr>';
                        categoryHTML += directInputRowHTML;
                    }

                    // ê° ì‚¬ì—…ì¥ë³„ í–‰ ìƒì„±
                    for (const site of siteList) {
                        const siteName = typeof site === 'string' ? site : site;
                        // ì‚¬ì—…ì¥ í–‰ì˜ ì‹œì‘ ë¶€ë¶„ HTML
                        let siteRowHTML = `
                            <tr class="site-row" data-category="${category}" data-site="${siteName}">
                                <td class="category-label" style="padding-left: 24px;">
                                    â€¢ ${siteName}
                                    <button class="delete-site-btn" onclick="deleteSiteFromCategory('${category}', '${siteName}')" title="ì‚¬ì—…ì¥ ì‚­ì œ">ğŸ—‘ï¸</button>
                                </td>
                                <td class="editable-cost" style="text-align: right; padding-right: 8px; font-size: 12px; color: #666; cursor: pointer;" 
                                    onclick="editTargetCost(this)" title="í´ë¦­í•˜ì—¬ ëª©í‘œ ì‹ì¬ë£Œë¹„ ìˆ˜ì •">1,700ì›</td>
                        `;
                        
                        // ê° ë‚ ì§œë³„ ì…ë ¥ í•„ë“œ
                        timelineDates.forEach((date, dateIndex) => {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);
                            date.setHours(0, 0, 0, 0);
                            
                            const isReadonly = date < today; // ê³¼ê±° ë‚ ì§œëŠ” ëª¨ë‘ ì½ê¸°ì „ìš©
                            const dateStr = formatDate(date, 'YYYY-MM-DD');
                            
                            // ì‹¤ì œ ë°ì´í„° ë˜ëŠ” ìƒ˜í”Œ ë°ì´í„°
                            let mealValue = 0;
                            if (mealData[category] && mealData[category][siteName] && mealData[category][siteName][dateStr]) {
                                mealValue = mealData[category][siteName][dateStr].meal_count;
                            } else {
                                mealValue = generateSampleValue(category, siteName, date);
                            }
                            
                            dailyTotals[dateIndex] += mealValue;
                            
                            let cellClass = '';
                            if (date < today) {
                                cellClass = 'past-date';
                            } else if (date.getTime() === today.getTime()) {
                                cellClass = 'today-date';
                            } else {
                                cellClass = 'future-date';
                            }

                            siteRowHTML += `
                                <td class="${cellClass}">
                                    <input type="number" 
                                           class="meal-input" 
                                           value="${mealValue}" 
                                           ${isReadonly ? 'readonly' : ''}
                                           data-category="${category}"
                                           data-site="${siteName}"
                                           data-date="${dateStr}"
                                           onchange="onDataChange(this)"
                                           onblur="onInputBlur(this)">
                                </td>
                            `;
                        });
                        
                        siteRowHTML += `</tr>`;
                        categoryHTML += siteRowHTML;
                    }
                }

                // ì´ê³„ í–‰ ìƒì„±
                let totalRow = '<tr class="total-row"><td class="total-cell">ğŸ“Š ì´ê³„</td><td class="total-cell">-</td>';
                dailyTotals.forEach((total, index) => {
                    const date = timelineDates[index];
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    date.setHours(0, 0, 0, 0);
                    
                    let cellClass = 'total-cell ';
                    if (date < today) {
                        cellClass += 'past-date';
                    } else if (date.getTime() === today.getTime()) {
                        cellClass += 'today-date';
                    } else {
                        cellClass += 'future-date';
                    }

                    totalRow += `<td class="${cellClass}"><strong>${total.toLocaleString()}</strong></td>`;
                });
                totalRow += '</tr>';
                
                // í•©ê³„ í–‰ì„ ë§¨ ì•ì—, ê·¸ ë‹¤ìŒì— ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì¶”ê°€
                tbody.innerHTML = totalRow + categoryHTML;
                
                // í…Œì´ë¸” ìƒì„± ì™„ë£Œ í›„ ì†Œê³„ ê³„ì‚°
                setTimeout(() => {
                    recalculateAllTotals();
                }, 100);
                
            } catch (error) {
                console.error('í…Œì´ë¸” ìƒì„± ì˜¤ë¥˜:', error);
                tbody.innerHTML = '<tr><td colspan="16" class="error">ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        // ìƒ˜í”Œ ê°’ ìƒì„±
        function generateSampleValue(category, site, date) {
            // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ì‚¬ìš©
            const baseValue = category.includes('ì¡°ì‹') ? 80 : 
                             category.includes('ì¤‘ì‹') ? 150 : 
                             category.includes('ì„ì‹') ? 100 : 60;
            
            const randomFactor = 0.8 + Math.random() * 0.4; // 80%~120% ë²”ìœ„
            return Math.round(baseValue * randomFactor);
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            currentTab = tabName;
            
            // íƒ­ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadData();
        }

        // ë°ì´í„° ë³€ê²½ ê°ì§€
        function onDataChange(input) {
            input.classList.add('changed');
            changeCount++;
            updateStatusInfo();
            
            // í•©ê³„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            recalculateAllTotals();
            
            if (autoSaveEnabled) {
                // ì‹¤ì œë¡œëŠ” ë””ë°”ìš´ì‹±ì„ ì ìš©í•´ì„œ ìë™ì €ì¥
                setTimeout(() => {
                    if (input.classList.contains('changed')) {
                        saveIndividualChange(input);
                    }
                }, 1000);
            }
        }

        // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ í•´ì œ
        function onInputBlur(input) {
            // ê°’ ê²€ì¦ ë° í¬ë§·íŒ…
            const value = parseInt(input.value) || 0;
            input.value = value;
        }

        // ê°œë³„ ë³€ê²½ì‚¬í•­ ì €ì¥
        async function saveIndividualChange(input) {
            try {
                const saveData = {
                    tab: currentTab,
                    category: input.dataset.category,
                    site: input.dataset.site,
                    date: input.dataset.date,
                    meal_count: parseInt(input.value) || 0
                };
                
                const response = await fetch(`/api/meal-counts/timeline/save?_t=${Date.now()}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(saveData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        input.classList.remove('changed');
                        changeCount = Math.max(0, changeCount - 1);
                        updateStatusInfo();
                        console.log('ì €ì¥ ì„±ê³µ:', saveData);
                    } else {
                        throw new Error(result.message || 'ì €ì¥ ì‹¤íŒ¨');
                    }
                } else if (response.status === 401) {
                    // ì¸ì¦ì´ í•„ìš”í•œ ê²½ìš° ì•Œë¦¼
                    console.log('ì¸ì¦ì´ í•„ìš”í•˜ì—¬ ìë™ì €ì¥ ì‹¤íŒ¨. ë‚˜ì¤‘ì— ì¼ê´„ ì €ì¥í•˜ì„¸ìš”.');
                    // ë³€ê²½ ìƒíƒœëŠ” ìœ ì§€
                } else {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜');
                }
                
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒì‹œì—ë„ ë³€ê²½ ìƒíƒœëŠ” ìœ ì§€ (ë‚˜ì¤‘ì— ì¼ê´„ ì €ì¥ ê°€ëŠ¥)
            }
        }

        // ìƒíƒœ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateStatusInfo() {
            document.getElementById('change-count').textContent = changeCount;
            document.getElementById('last-save').textContent = new Date().toLocaleTimeString();
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(date, format) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return format
                .replace('YYYY', year)
                .replace('MM', month)
                .replace('DD', day);
        }

        // ì£¼ ì´ë™
        function moveWeek(direction) {
            baseDate.setDate(baseDate.getDate() + (direction * 7));
            document.getElementById('base-date').value = baseDate.toISOString().split('T')[0];
            generateTimeline();
            loadData();
        }

        // ì˜¤ëŠ˜ë¡œ ì„¤ì •
        function setToday() {
            baseDate = new Date();
            document.getElementById('base-date').value = baseDate.toISOString().split('T')[0];
            generateTimeline();
            loadData();
        }

        // ì „ë‚  ë³µì‚¬
        function copyPreviousDay() {
            if (confirm('ì „ë‚  ë°ì´í„°ë¥¼ ì˜¤ëŠ˜ê³¼ ë¯¸ë˜ì¼ì— ë³µì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì‹¤ì œ êµ¬í˜„
                alert('ì „ë‚  ë°ì´í„° ë³µì‚¬ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
            }
        }

        // ì˜ˆìƒê°’ ìƒì„±
        function generatePrediction() {
            if (confirm('ìµœê·¼ 3ì¼ í‰ê· ì„ ê¸°ë°˜ìœ¼ë¡œ ì˜ˆìƒê°’ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì‹¤ì œ êµ¬í˜„
                alert('ì˜ˆìƒê°’ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
            }
        }

        // ì„¸ë¶€ì‹ë‹¨ëª… í¸ì§‘ ì‹œì‘
        function editCategoryName(element) {
            const categoryNameSpan = element.querySelector('.category-name');
            const currentName = categoryNameSpan.textContent;
            
            // ì´ë¯¸ í¸ì§‘ ì¤‘ì¸ ê²½ìš° ë¬´ì‹œ
            if (element.querySelector('.category-edit-input')) {
                return;
            }
            
            // ì…ë ¥ í•„ë“œ ìƒì„±
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentName;
            input.className = 'category-edit-input';
            input.style.width = currentName.length * 12 + 40 + 'px';
            
            // ì›ë˜ í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
            categoryNameSpan.style.display = 'none';
            categoryNameSpan.parentNode.insertBefore(input, categoryNameSpan);
            
            // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            input.focus();
            input.select();
            
            // ì—”í„°í‚¤ ë˜ëŠ” í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ì €ì¥
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    saveCategoryName(element, input, categoryNameSpan);
                } else if (e.key === 'Escape') {
                    cancelCategoryEdit(input, categoryNameSpan);
                }
            });
            
            input.addEventListener('blur', function() {
                saveCategoryName(element, input, categoryNameSpan);
            });
        }

        // ì„¸ë¶€ì‹ë‹¨ëª… ì €ì¥
        function saveCategoryName(element, input, categoryNameSpan) {
            const newName = input.value.trim();
            const originalName = element.dataset.originalName;
            
            if (newName === '' || newName === originalName) {
                cancelCategoryEdit(input, categoryNameSpan);
                return;
            }
            
            // ì¤‘ë³µ ê²€ì‚¬ (í˜„ì¬ íƒ­ ë‚´ì—ì„œ)
            const existingCategories = Array.from(document.querySelectorAll('.category-name')).map(span => span.textContent);
            if (existingCategories.includes(newName)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì„¸ë¶€ì‹ë‹¨ëª…ì…ë‹ˆë‹¤.');
                input.focus();
                input.select();
                return;
            }
            
            // ì´ë¦„ ì—…ë°ì´íŠ¸
            categoryNameSpan.textContent = newName;
            categoryNameSpan.style.display = '';
            input.remove();
            
            // TODO: ì„œë²„ì— ë³€ê²½ì‚¬í•­ ì €ì¥
            console.log(`ì„¸ë¶€ì‹ë‹¨ëª… ë³€ê²½: ${originalName} â†’ ${newName}`);
            alert(`ì„¸ë¶€ì‹ë‹¨ëª…ì´ "${newName}"ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ì„¸ë¶€ì‹ë‹¨ëª… í¸ì§‘ ì·¨ì†Œ
        function cancelCategoryEdit(input, categoryNameSpan) {
            categoryNameSpan.style.display = '';
            input.remove();
        }

        // ì‚¬ì—…ì¥ ì¶”ê°€
        function addSiteToCategory(categoryName) {
            const siteName = prompt(`${categoryName}ì— ì¶”ê°€í•  ì‚¬ì—…ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:`);
            if (siteName && siteName.trim()) {
                const trimmedSiteName = siteName.trim();
                
                // ì¤‘ë³µ í™•ì¸
                const existingSites = Array.from(document.querySelectorAll(`[data-category="${categoryName}"] td:first-child`))
                    .map(td => td.textContent.replace('â€¢ ', '').replace('ğŸ—‘ï¸', '').trim());
                
                if (existingSites.includes(trimmedSiteName)) {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ì—…ì¥ëª…ì…ë‹ˆë‹¤.');
                    return;
                }
                
                // ìƒˆë¡œìš´ ì‚¬ì—…ì¥ í–‰ ì¶”ê°€
                addNewSiteRow(categoryName, trimmedSiteName);
                
                // í•©ê³„ ì¬ê³„ì‚°
                recalculateAllTotals();
                
                console.log(`ì‚¬ì—…ì¥ ì¶”ê°€: ${categoryName} â†’ ${trimmedSiteName}`);
            }
        }

        // ì‚¬ì—…ì¥ ì‚­ì œ
        function deleteSiteFromCategory(categoryName, siteName) {
            if (confirm(`"${siteName}" ì‚¬ì—…ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const siteRow = document.querySelector(`[data-category="${categoryName}"][data-site="${siteName}"]`);
                if (siteRow) {
                    siteRow.remove();
                    
                    // ì‚¬ì—…ì¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                    updateSiteCount(categoryName);
                    
                    // í•©ê³„ ì¬ê³„ì‚°
                    recalculateAllTotals();
                    
                    console.log(`ì‚¬ì—…ì¥ ì‚­ì œ: ${categoryName} â†’ ${siteName}`);
                }
            }
        }

        // ìƒˆë¡œìš´ ì‚¬ì—…ì¥ í–‰ ì¶”ê°€
        function addNewSiteRow(categoryName, siteName) {
            const categoryRow = Array.from(document.querySelectorAll('.category-group')).find(row => {
                const categoryNameElement = row.querySelector('.category-name');
                return categoryNameElement && categoryNameElement.textContent === categoryName;
            });
            
            if (!categoryRow) return;
            
            // ìƒˆë¡œìš´ ì‚¬ì—…ì¥ í–‰ HTML ìƒì„±
            let newSiteRowHTML = `
                <tr class="site-row" data-category="${categoryName}" data-site="${siteName}">
                    <td class="category-label" style="padding-left: 24px;">
                        â€¢ ${siteName}
                        <button class="delete-site-btn" onclick="deleteSiteFromCategory('${categoryName}', '${siteName}')" title="ì‚¬ì—…ì¥ ì‚­ì œ">ğŸ—‘ï¸</button>
                    </td>
                    <td class="editable-cost" style="text-align: right; padding-right: 8px; font-size: 12px; color: #666; cursor: pointer;" 
                        onclick="editTargetCost(this)" title="í´ë¦­í•˜ì—¬ ëª©í‘œ ì‹ì¬ë£Œë¹„ ìˆ˜ì •">1,700ì›</td>
            `;
            
            // ê° ë‚ ì§œë³„ ì…ë ¥ í•„ë“œ ì¶”ê°€
            timelineDates.forEach((date, dateIndex) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                date.setHours(0, 0, 0, 0);
                
                const isReadonly = date < today;
                const dateStr = formatDate(date, 'YYYY-MM-DD');
                
                let cellClass = '';
                if (date < today) {
                    cellClass = 'past-date';
                } else if (date.getTime() === today.getTime()) {
                    cellClass = 'today-date';
                } else {
                    cellClass = 'future-date';
                }

                newSiteRowHTML += `
                    <td class="${cellClass}">
                        <input type="number" 
                               class="meal-input" 
                               value="0" 
                               ${isReadonly ? 'readonly' : ''}
                               data-category="${categoryName}"
                               data-site="${siteName}"
                               data-date="${dateStr}"
                               onchange="onDataChange(this)"
                               onblur="onInputBlur(this)">
                    </td>
                `;
            });
            
            newSiteRowHTML += '</tr>';
            
            // ì¹´í…Œê³ ë¦¬ ë‹¤ìŒì— ìƒˆë¡œìš´ í–‰ ì‚½ì…
            categoryRow.insertAdjacentHTML('afterend', newSiteRowHTML);
            
            // ì‚¬ì—…ì¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            updateSiteCount(categoryName);
        }

        // ì‚¬ì—…ì¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateSiteCount(categoryName) {
            const categoryRow = Array.from(document.querySelectorAll('.category-group')).find(row => {
                const categoryNameElement = row.querySelector('.category-name');
                return categoryNameElement && categoryNameElement.textContent === categoryName;
            });
            
            if (categoryRow) {
                const siteCount = document.querySelectorAll(`tr.site-row[data-category="${categoryName}"]`).length;
                const categoryLabel = categoryRow.querySelector('.category-label');
                
                // ì‚¬ì—…ì¥ ê°œìˆ˜ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                const countRegex = /\(\d+ê°œ ì‚¬ì—…ì¥\)/;
                categoryLabel.innerHTML = categoryLabel.innerHTML.replace(countRegex, `(${siteCount}ê°œ ì‚¬ì—…ì¥)`);
            }
        }

        // ëª©í‘œ ì‹ì¬ë£Œë¹„ í¸ì§‘
        function editTargetCost(element) {
            const currentCost = element.textContent.replace('ì›', '').replace(',', '');
            const newCost = prompt('ëª©í‘œ ì‹ì¬ë£Œë¹„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì› ë‹¨ìœ„):', currentCost);
            
            if (newCost !== null && newCost.trim() !== '') {
                const numericCost = parseInt(newCost.replace(/,/g, ''));
                if (!isNaN(numericCost) && numericCost >= 0) {
                    element.textContent = numericCost.toLocaleString() + 'ì›';
                    console.log(`ëª©í‘œ ì‹ì¬ë£Œë¹„ ë³€ê²½: ${currentCost}ì› â†’ ${numericCost.toLocaleString()}ì›`);
                } else {
                    alert('ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        // ëª¨ë“  í•©ê³„ ì¬ê³„ì‚°
        function recalculateAllTotals() {
            const dailyTotals = new Array(15).fill(0);
            const categoryTotals = {};
            
            // ê° ì…ë ¥ê°’ì„ í•©ì‚°
            const allInputs = document.querySelectorAll('.meal-input');
            allInputs.forEach(input => {
                const value = parseInt(input.value) || 0;
                const category = input.dataset.category;
                const dateIndex = getDateIndexFromInput(input);
                
                if (dateIndex >= 0 && dateIndex < 15) {
                    // ì „ì²´ ì¼ë³„ í•©ê³„
                    dailyTotals[dateIndex] += value;
                    
                    // ì¹´í…Œê³ ë¦¬ë³„ í•©ê³„
                    if (!categoryTotals[category]) {
                        categoryTotals[category] = new Array(15).fill(0);
                    }
                    categoryTotals[category][dateIndex] += value;
                }
            });
            
            // ì „ì²´ í•©ê³„ í–‰ ì—…ë°ì´íŠ¸
            updateTotalRow(dailyTotals);
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì†Œê³„ ì—…ë°ì´íŠ¸
            updateCategorySubtotals(categoryTotals);
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ì†Œê³„ ì—…ë°ì´íŠ¸
        function updateCategorySubtotals(categoryTotals) {
            Object.keys(categoryTotals).forEach(category => {
                const totals = categoryTotals[category];
                const categoryRow = findCategoryRow(category);
                
                if (categoryRow) {
                    // ì¹´í…Œê³ ë¦¬ í—¤ë”ì— ì†Œê³„ í‘œì‹œ
                    updateCategoryHeaderSubtotal(categoryRow, category, totals);
                    
                    // ê¸°ì¡´ ì†Œê³„ í–‰ì´ ìˆìœ¼ë©´ ì œê±°
                    const existingSubtotalRow = document.querySelector(`[data-subtotal-category="${category}"]`);
                    if (existingSubtotalRow) {
                        existingSubtotalRow.remove();
                    }
                    
                    // ìƒˆ ì†Œê³„ í–‰ ìƒì„± (ì‚¬ì—…ì¥ì´ ìˆëŠ” ê²½ìš°ë§Œ)
                    const siteCount = document.querySelectorAll(`tr.site-row[data-category="${category}"]`).length;
                    
                    if (siteCount > 0) {
                        createCategorySubtotalRow(category, totals);
                    }
                }
            });
        }

        // ì¹´í…Œê³ ë¦¬ í–‰ ì°¾ê¸°
        function findCategoryRow(category) {
            return Array.from(document.querySelectorAll('.category-group')).find(row => {
                const categoryNameElement = row.querySelector('.category-name');
                if (!categoryNameElement) return false;
                
                // ì›ë³¸ ì¹´í…Œê³ ë¦¬ëª…ìœ¼ë¡œ ë¹„êµ (data-original ì†ì„± ì‚¬ìš©)
                const originalCategory = categoryNameElement.dataset.original;
                if (originalCategory === category) return true;
                
                // í‘œì‹œëª…ìœ¼ë¡œë„ ë¹„êµ (í˜¸í™˜ì„±ì„ ìœ„í•´)
                return categoryNameElement.textContent === category;
            });
        }

        // ì¹´í…Œê³ ë¦¬ í—¤ë”ì— ì†Œê³„ í‘œì‹œ
        function updateCategoryHeaderSubtotal(categoryRow, category, totals) {
            const totalSum = totals.reduce((sum, total) => sum + total, 0);
            const categoryLabel = categoryRow.querySelector('.category-label');
            const siteCount = document.querySelectorAll(`tr.site-row[data-category="${category}"]`).length;
            
            // í‰ê·  ì¼ë³„ ì‹ìˆ˜ ê³„ì‚° (0ì´ ì•„ë‹Œ ë‚ ë“¤ì˜ í‰ê· )
            const nonZeroDays = totals.filter(total => total > 0).length;
            const avgDaily = nonZeroDays > 0 ? (totalSum / nonZeroDays).toFixed(0) : 0;
            
            // ê¸°ì¡´ ì†Œê³„ ì •ë³´ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
            const countRegex = /\(\d+ê°œ ì‚¬ì—…ì¥.*?\)/;
            categoryLabel.innerHTML = categoryLabel.innerHTML.replace(countRegex, 
                `(${siteCount}ê°œ ì‚¬ì—…ì¥, 15ì¼ ì´ ${totalSum.toLocaleString()}ëª…, ì¼í‰ê·  ${avgDaily}ëª…)`);
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ì†Œê³„ í–‰ ìƒì„± (ì¼ë³„ ì†Œê³„)
        function createCategorySubtotalRow(category, totals) {
            const categoryRow = findCategoryRow(category);
            if (!categoryRow) return;
            
            // ì†Œê³„ í–‰ ìƒì„±
            const subtotalRow = document.createElement('tr');
            subtotalRow.className = 'category-subtotal-row';
            subtotalRow.dataset.subtotalCategory = category;
            
            // ì²« ë²ˆì§¸ ì…€ (ë¹ˆ ê³µê°„)
            const emptyCell = document.createElement('td');
            emptyCell.style.border = 'none';
            subtotalRow.appendChild(emptyCell);
            
            // ë‘ ë²ˆì§¸ ì…€ (ì†Œê³„ ë¼ë²¨)
            const labelCell = document.createElement('td');
            labelCell.textContent = 'ì¼ë³„ì†Œê³„';
            labelCell.style.fontWeight = 'bold';
            labelCell.style.textAlign = 'right';
            labelCell.style.backgroundColor = '#e8f4f8';
            labelCell.style.border = '1px solid #ddd';
            labelCell.style.padding = '8px';
            labelCell.style.color = '#2563eb';
            labelCell.style.fontSize = '12px';
            subtotalRow.appendChild(labelCell);
            
            // ë‚ ì§œë³„ ì†Œê³„ ì…€ë“¤ (ê° ë‚ ì§œë³„ë¡œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ì‚¬ì—…ì¥ í•©ê³„)
            for (let i = 0; i < 15; i++) {
                const cell = document.createElement('td');
                const dailyTotal = totals[i] || 0;
                
                if (dailyTotal > 0) {
                    cell.textContent = dailyTotal.toLocaleString();
                    cell.style.fontWeight = 'bold';
                    cell.style.color = '#1d4ed8';
                } else {
                    cell.textContent = '-';
                    cell.style.color = '#6b7280';
                }
                
                cell.style.textAlign = 'center';
                cell.style.backgroundColor = '#f0f8ff';
                cell.style.border = '1px solid #ddd';
                cell.style.padding = '8px';
                cell.style.fontSize = '12px';
                subtotalRow.appendChild(cell);
            }
            
            // ì¹´í…Œê³ ë¦¬ì˜ ë§ˆì§€ë§‰ ì‚¬ì—…ì¥ í–‰ ë‹¤ìŒì— ì†Œê³„ í–‰ ì‚½ì…
            const lastSiteRow = findLastSiteRowInCategory(category);
            if (lastSiteRow) {
                lastSiteRow.parentNode.insertBefore(subtotalRow, lastSiteRow.nextSibling);
            }
        }

        // ì¹´í…Œê³ ë¦¬ì˜ ë§ˆì§€ë§‰ ì‚¬ì—…ì¥ í–‰ ì°¾ê¸°
        function findLastSiteRowInCategory(category) {
            const siteRows = document.querySelectorAll(`tr.site-row[data-category="${category}"]`);
            return siteRows[siteRows.length - 1];
        }

        // ì…ë ¥ í•„ë“œì—ì„œ ë‚ ì§œ ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        function getDateIndexFromInput(input) {
            const row = input.closest('tr');
            const cells = row.querySelectorAll('td');
            const inputCell = input.closest('td');
            
            // ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ ì…€ì€ ë¼ë²¨ì´ë¯€ë¡œ ì œì™¸í•˜ê³  ì¸ë±ìŠ¤ ê³„ì‚°
            for (let i = 2; i < cells.length; i++) {
                if (cells[i] === inputCell) {
                    return i - 2;
                }
            }
            return -1;
        }

        // ì „ì²´ í•©ê³„ í–‰ ì—…ë°ì´íŠ¸
        function updateTotalRow(dailyTotals) {
            const totalRow = document.querySelector('.total-row');
            if (!totalRow) return;
            
            const totalCells = totalRow.querySelectorAll('.total-cell');
            // ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ ì…€ì€ ë¼ë²¨ì´ë¯€ë¡œ ìŠ¤í‚µ
            for (let i = 2; i < totalCells.length && i - 2 < dailyTotals.length; i++) {
                const cell = totalCells[i];
                const total = dailyTotals[i - 2];
                cell.innerHTML = `<strong>${total.toLocaleString()}</strong>`;
            }
        }

        // ì‹ìˆ˜í•©ê³„ íƒ­ ë°ì´í„° ìƒì„±
        function generateSummaryTabData() {
            const allTabs = ['ë„ì‹œë½', 'ìš´ë°˜', 'í•™êµ', 'ìš”ì–‘ì›', 'í™•ì¥1'];
            const summaryData = {};
            
            allTabs.forEach(tabName => {
                // ê° íƒ­ì˜ ì‹¤ì œ ì‹ìˆ˜ ë°ì´í„°ë¥¼ í•©ì‚°
                const tabTotalKey = `${tabName} ì´ê³„`;
                const tabData = calculateTabTotals(tabName);
                summaryData[tabTotalKey] = [tabData];
            });
            
            // ì „ì²´ í•©ê³„ ì¶”ê°€
            summaryData['ì „ì²´ í•©ê³„'] = [calculateGrandTotals()];
            
            return summaryData;
        }

        // íŠ¹ì • íƒ­ì˜ ì´ê³„ ê³„ì‚°
        function calculateTabTotals(tabName) {
            const dailyTotals = new Array(15).fill(0);
            const tabCategories = Object.keys(sampleData[tabName] || {});
            
            // ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì €ì¥ëœ ë°ì´í„° í™•ì¸
            tabCategories.forEach(category => {
                const categoryData = mealData[tabName]?.[category] || {};
                Object.values(categoryData).forEach(siteData => {
                    if (Array.isArray(siteData)) {
                        siteData.forEach((value, dateIndex) => {
                            if (dateIndex < 15 && value) {
                                dailyTotals[dateIndex] += parseInt(value) || 0;
                            }
                        });
                    }
                });
            });
            
            return {
                site_name: 'ì†Œê³„',
                daily_values: dailyTotals
            };
        }

        // ì „ì²´ íƒ­ì˜ ì´í•©ê³„ ê³„ì‚°
        function calculateGrandTotals() {
            const allTabs = ['ë„ì‹œë½', 'ìš´ë°˜', 'í•™êµ', 'ìš”ì–‘ì›', 'í™•ì¥1'];
            const grandTotals = new Array(15).fill(0);
            
            allTabs.forEach(tabName => {
                const tabTotals = calculateTabTotals(tabName);
                tabTotals.daily_values.forEach((value, index) => {
                    grandTotals[index] += value;
                });
            });
            
            return {
                site_name: 'ì „ì²´ í•©ê³„',
                daily_values: grandTotals
            };
        }

        // íƒ­ ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
        function openTabManagerModal() {
            const modal = document.getElementById('tabManagerModal');
            generateTabManagerContent();
            modal.style.display = 'block';
        }

        // íƒ­ ê´€ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeTabManagerModal() {
            const modal = document.getElementById('tabManagerModal');
            modal.style.display = 'none';
        }

        // íƒ­ ê´€ë¦¬ ì½˜í…ì¸  ìƒì„±
        function generateTabManagerContent() {
            const container = document.getElementById('tabManagerContent');
            const allTabs = ['ë„ì‹œë½', 'ìš´ë°˜', 'í•™êµ', 'ìš”ì–‘ì›', 'í™•ì¥1'];
            const allMealCategories = [
                'ì¡°ì‹A', 'ì¡°ì‹B', 'ì¡°ì‹C', 'ì¡°ì‹D', 'ì¡°ì‹E',
                'ì¤‘ì‹A', 'ì¤‘ì‹B', 'ì¤‘ì‹C', 'ì¤‘ì‹D', 'ì¤‘ì‹E', 
                'ì„ì‹A', 'ì„ì‹B', 'ì„ì‹C', 
                'ì•¼ì‹A', 'ì•¼ì‹B',
                'íŠ¹ì‹A', 'íŠ¹ì‹B', 'íŠ¹ì‹C', 'íŠ¹ì‹D', 'íŠ¹ì‹E'
            ];

            let contentHTML = '';
            
            allTabs.forEach(tabName => {
                const tabIcon = getTabIcon(tabName);
                const currentCategories = Object.keys(sampleData[tabName] || {});
                
                contentHTML += `
                    <div class="tab-config-item">
                        <div class="tab-config-header">
                            ${tabIcon} ${tabName}
                        </div>
                        <p>ì´ íƒ­ì—ì„œ ì‚¬ìš©í•  ì„¸ë¶€ì‹ë‹¨ì„ ì„ íƒí•˜ì„¸ìš”:</p>
                        <div class="meal-time-groups">
                `;
                
                // ì‹ì‚¬ ì‹œê°„ë³„ ê·¸ë£¹í™”
                const mealTimeGroups = {
                    'ğŸŒ… ì¡°ì‹': ['ì¡°ì‹A', 'ì¡°ì‹B', 'ì¡°ì‹C', 'ì¡°ì‹D', 'ì¡°ì‹E'],
                    'ğŸ½ï¸ ì¤‘ì‹': ['ì¤‘ì‹A', 'ì¤‘ì‹B', 'ì¤‘ì‹C', 'ì¤‘ì‹D', 'ì¤‘ì‹E'],
                    'ğŸŒ† ì„ì‹': ['ì„ì‹A', 'ì„ì‹B', 'ì„ì‹C'],
                    'ğŸŒ™ ì•¼ì‹': ['ì•¼ì‹A', 'ì•¼ì‹B'],
                    'ğŸ‰ íŠ¹ì‹': ['íŠ¹ì‹A', 'íŠ¹ì‹B', 'íŠ¹ì‹C', 'íŠ¹ì‹D', 'íŠ¹ì‹E']
                };
                
                Object.keys(mealTimeGroups).forEach(timeLabel => {
                    const categories = mealTimeGroups[timeLabel];
                    contentHTML += `
                        <div class="meal-time-group">
                            <h5 class="meal-time-header">${timeLabel}</h5>
                            <div class="meal-category-grid">
                    `;
                    
                    categories.forEach(category => {
                        const isChecked = currentCategories.includes(category);
                        const displayName = mealCategoryNames[category] || category;
                        contentHTML += `
                            <label class="meal-category-checkbox ${isChecked ? 'checked' : ''}">
                                <input type="checkbox" 
                                       value="${category}" 
                                       data-tab="${tabName}"
                                       ${isChecked ? 'checked' : ''}
                                       onchange="toggleMealCategory(this)">
                                <span class="category-display-name" data-category="${category}">${displayName}</span>
                                <button class="edit-name-btn" onclick="editCategoryName('${category}')" title="ëª…ì¹­ ë³€ê²½">âœï¸</button>
                            </label>
                        `;
                    });
                    
                    contentHTML += `
                            </div>
                        </div>
                    `;
                });
                
                contentHTML += `
                        </div>
                        <div class="tab-specific-controls">
                            <h5>ğŸ”§ ${tabName} ì „ìš© ì„¤ì •</h5>
                            <div class="control-buttons">
                                <button class="btn btn-sm btn-primary" onclick="exportTabData('${tabName}')">ğŸ“Š ${tabName} ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                                <button class="btn btn-sm btn-warning" onclick="copyPreviousDay('${tabName}')">ğŸ“… ì „ì¼ ë°ì´í„° ë³µì‚¬</button>
                                <button class="btn btn-sm btn-info" onclick="showTabStatistics('${tabName}')">ğŸ“ˆ ${tabName} í†µê³„ ë³´ê¸°</button>
                                <button class="btn btn-sm btn-danger" onclick="resetTabData('${tabName}')">ğŸ—‘ï¸ ${tabName} ë°ì´í„° ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = contentHTML;
        }

        // íƒ­ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸°
        function getTabIcon(tabName) {
            const icons = {
                'ë„ì‹œë½': 'ğŸ±',
                'ìš´ë°˜': 'ğŸšš',
                'í•™êµ': 'ğŸ«',
                'ìš”ì–‘ì›': 'ğŸ¥',
                'í™•ì¥1': 'ğŸ“‹'
            };
            return icons[tabName] || 'ğŸ“‹';
        }

        // ì„¸ë¶€ì‹ë‹¨ í† ê¸€
        function toggleMealCategory(checkbox) {
            const label = checkbox.closest('.meal-category-checkbox');
            if (checkbox.checked) {
                label.classList.add('checked');
            } else {
                label.classList.remove('checked');
            }
        }

        // íƒ­ ì„¤ì • ì €ì¥
        function saveTabConfiguration() {
            const checkboxes = document.querySelectorAll('#tabManagerContent input[type="checkbox"]');
            const newConfig = {};
            
            // ê° íƒ­ë³„ë¡œ ì„ íƒëœ ì„¸ë¶€ì‹ë‹¨ ìˆ˜ì§‘
            checkboxes.forEach(checkbox => {
                const tabName = checkbox.dataset.tab;
                const category = checkbox.value;
                
                if (!newConfig[tabName]) {
                    newConfig[tabName] = {};
                }
                
                if (checkbox.checked) {
                    newConfig[tabName][category] = [];
                }
            });
            
            // ìƒ˜í”Œ ë°ì´í„° ì—…ë°ì´íŠ¸
            Object.keys(newConfig).forEach(tabName => {
                sampleData[tabName] = newConfig[tabName];
            });
            
            // í˜„ì¬ íƒ­ì´ ë³€ê²½ëœ ê²½ìš° ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadData();
            
            alert('íƒ­ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeTabManagerModal();
        }

        // ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
        function resetToDefault() {
            if (confirm('ëª¨ë“  íƒ­ ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ê¸°ë³¸ ì„¸ë¶€ì‹ë‹¨ êµ¬ì„±ìœ¼ë¡œ ë³µì›
                const defaultConfig = {
                    'ë„ì‹œë½': ['ì¡°ì‹A', 'ì¡°ì‹B', 'ì¤‘ì‹A', 'ì¤‘ì‹B', 'ì„ì‹A', 'ì•¼ì‹A'],
                    'ìš´ë°˜': ['ì¡°ì‹A', 'ì¤‘ì‹A', 'ì¤‘ì‹B'],
                    'í•™êµ': ['ì¡°ì‹A', 'ì¤‘ì‹A', 'ì„ì‹A'],
                    'ìš”ì–‘ì›': ['ì¡°ì‹A', 'ì¤‘ì‹A', 'ì¤‘ì‹B', 'ì„ì‹A', 'ì•¼ì‹A'],
                    'í™•ì¥1': ['ì¤‘ì‹A']
                };
                
                Object.keys(defaultConfig).forEach(tabName => {
                    sampleData[tabName] = {};
                    defaultConfig[tabName].forEach(category => {
                        sampleData[tabName][category] = [];
                    });
                });
                
                generateTabManagerContent();
                alert('ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ì¼ê´„ ì €ì¥
        function saveAllChanges() {
            if (changeCount === 0) {
                alert('ì €ì¥í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm(`${changeCount}ê°œì˜ ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // ëª¨ë“  changed í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.meal-input.changed').forEach(input => {
                    input.classList.remove('changed');
                });
                
                changeCount = 0;
                updateStatusInfo();
                alert('ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Excel ë‚´ë³´ë‚´ê¸°
        function exportToExcel() {
            alert(`${currentTab} íƒ­ì˜ 15ì¼ ë°ì´í„°ë¥¼ Excelë¡œ ë‚´ë³´ëƒ…ë‹ˆë‹¤.`);
        }

        // íƒ­ë³„ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportTabData(tabName) {
            const tabData = mealData[tabName] || {};
            const csvContent = generateCSVContent(tabName, tabData);
            downloadCSV(csvContent, `${tabName}_ì‹ìˆ˜ë°ì´í„°_${formatDate(new Date(), 'YYYY-MM-DD')}.csv`);
            alert(`${tabName} íƒ­ì˜ ë°ì´í„°ë¥¼ CSV íŒŒì¼ë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.`);
        }

        // CSV ì½˜í…ì¸  ìƒì„±
        function generateCSVContent(tabName, tabData) {
            const headers = ['ì¹´í…Œê³ ë¦¬', 'ì‚¬ì—…ì¥', ...timelineDates.map(d => formatDate(d, 'MM/DD'))];
            let csvContent = headers.join(',') + '\n';
            
            Object.keys(tabData).forEach(category => {
                const categoryData = tabData[category];
                Object.keys(categoryData).forEach(site => {
                    const siteData = categoryData[site];
                    const row = [category, site, ...siteData];
                    csvContent += row.join(',') + '\n';
                });
            });
            
            return csvContent;
        }

        // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadCSV(content, filename) {
            const blob = new Blob(['\uFEFF' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ì „ì¼ ë°ì´í„° ë³µì‚¬
        function copyPreviousDay(tabName) {
            if (!confirm(`${tabName} íƒ­ì˜ ì–´ì œ ë°ì´í„°ë¥¼ ì˜¤ëŠ˜ë¡œ ë³µì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // ì–´ì œ ë‚ ì§œì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
            const yesterdayIndex = timelineDates.findIndex(date => 
                date.toDateString() === yesterday.toDateString()
            );
            const todayIndex = timelineDates.findIndex(date => 
                date.toDateString() === today.toDateString()
            );
            
            if (yesterdayIndex >= 0 && todayIndex >= 0) {
                // í•´ë‹¹ íƒ­ì˜ ëª¨ë“  ì…ë ¥ í•„ë“œì—ì„œ ì–´ì œ ë°ì´í„°ë¥¼ ì˜¤ëŠ˜ë¡œ ë³µì‚¬
                const inputs = document.querySelectorAll('.meal-input');
                inputs.forEach(input => {
                    if (input.dataset.category && Object.keys(sampleData[tabName] || {}).includes(input.dataset.category)) {
                        const yesterdayInput = document.querySelector(
                            `input[data-category="${input.dataset.category}"][data-site="${input.dataset.site}"][data-date-index="${yesterdayIndex}"]`
                        );
                        const todayInput = document.querySelector(
                            `input[data-category="${input.dataset.category}"][data-site="${input.dataset.site}"][data-date-index="${todayIndex}"]`
                        );
                        
                        if (yesterdayInput && todayInput && yesterdayInput.value) {
                            todayInput.value = yesterdayInput.value;
                            todayInput.classList.add('changed');
                        }
                    }
                });
                
                recalculateAllTotals();
                alert(`${tabName} íƒ­ì˜ ì–´ì œ ë°ì´í„°ë¥¼ ì˜¤ëŠ˜ë¡œ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.`);
            } else {
                alert('ì–´ì œ ë˜ëŠ” ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // íƒ­ í†µê³„ ë³´ê¸°
        function showTabStatistics(tabName) {
            const tabCategories = Object.keys(sampleData[tabName] || {});
            let totalMeals = 0;
            let activeSites = 0;
            
            tabCategories.forEach(category => {
                const inputs = document.querySelectorAll(`input[data-category="${category}"]`);
                inputs.forEach(input => {
                    if (input.value && parseInt(input.value) > 0) {
                        totalMeals += parseInt(input.value);
                        activeSites++;
                    }
                });
            });
            
            const avgDailyMeals = (totalMeals / 15).toFixed(1);
            
            alert(`ğŸ“ˆ ${tabName} íƒ­ í†µê³„\n\n` +
                  `â€¢ ì´ ì‹ìˆ˜: ${totalMeals.toLocaleString()}ëª…\n` +
                  `â€¢ í™œì„± ì‚¬ì—…ì¥: ${activeSites}ê°œ\n` +
                  `â€¢ ì¼í‰ê·  ì‹ìˆ˜: ${avgDailyMeals}ëª…\n` +
                  `â€¢ ì„¸ë¶€ì‹ë‹¨ ì¢…ë¥˜: ${tabCategories.length}ê°œ`);
        }

        // íƒ­ ë°ì´í„° ì´ˆê¸°í™”
        function resetTabData(tabName) {
            if (!confirm(`âš ï¸ ${tabName} íƒ­ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            const tabCategories = Object.keys(sampleData[tabName] || {});
            tabCategories.forEach(category => {
                const inputs = document.querySelectorAll(`input[data-category="${category}"]`);
                inputs.forEach(input => {
                    input.value = '';
                    input.classList.add('changed');
                });
            });
            
            recalculateAllTotals();
            alert(`${tabName} íƒ­ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ê°„ë‹¨ ì„¤ì • ì ìš©
        function applySimpleConfig(configType) {
            const simpleConfigs = {
                'basic': {
                    'ë„ì‹œë½': ['ğŸŒ… ì¡°ì‹A', 'ğŸ½ï¸ ì¤‘ì‹A', 'ğŸŒ† ì„ì‹A'],
                    'ìš´ë°˜': ['ğŸ½ï¸ ì¤‘ì‹A'],
                    'í•™êµ': [],
                    'ìš”ì–‘ì›': []
                },
                'lunch-only': {
                    'ë„ì‹œë½': ['ğŸ½ï¸ ì¤‘ì‹A'],
                    'ìš´ë°˜': ['ğŸ½ï¸ ì¤‘ì‹A'],
                    'í•™êµ': ['ğŸ½ï¸ ì¤‘ì‹A'],
                    'ìš”ì–‘ì›': []
                },
                'school': {
                    'ë„ì‹œë½': [],
                    'ìš´ë°˜': [],
                    'í•™êµ': ['ğŸ½ï¸ ì¤‘ì‹A', 'ğŸ½ï¸ ì¤‘ì‹B', 'ğŸŒ† ì„ì‹A'],
                    'ìš”ì–‘ì›': []
                },
                'nursing': {
                    'ë„ì‹œë½': [],
                    'ìš´ë°˜': [],
                    'í•™êµ': [],
                    'ìš”ì–‘ì›': ['ğŸŒ… ì¡°ì‹A', 'ğŸ½ï¸ ì¤‘ì‹A', 'ğŸ½ï¸ ì¤‘ì‹B', 'ğŸŒ† ì„ì‹A', 'ğŸŒ™ ì•¼ì‹A']
                }
            };
            
            // ì´ëª¨ì§€ ì œê±°í•˜ê³  ì‹¤ì œ ì¹´í…Œê³ ë¦¬ëª…ìœ¼ë¡œ ë³€í™˜
            const cleanConfigs = {};
            Object.keys(simpleConfigs).forEach(configKey => {
                cleanConfigs[configKey] = {};
                Object.keys(simpleConfigs[configKey]).forEach(tabName => {
                    cleanConfigs[configKey][tabName] = simpleConfigs[configKey][tabName].map(category => 
                        category.replace(/^ğŸŒ… |^ğŸ½ï¸ |^ğŸŒ† |^ğŸŒ™ |^ğŸ‰ /, '')
                    );
                });
            });
            
            const configName = {
                'basic': 'ê¸°ë³¸í˜•',
                'lunch-only': 'ì¤‘ì‹ì „ìš©',
                'school': 'í•™êµí˜•',
                'nursing': 'ìš”ì–‘ì›í˜•'
            };
            
            if (!confirm(`${configName[configType]} ì„¤ì •ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ì„¤ì •ì´ ë³€ê²½ë©ë‹ˆë‹¤.`)) {
                return;
            }
            
            const config = cleanConfigs[configType];
            
            // ëª¨ë“  ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.querySelectorAll('#tabManagerContent input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.parentElement.classList.remove('checked');
            });
            
            // ì„¤ì •ì— ë”°ë¼ ì²´í¬ë°•ìŠ¤ ì„ íƒ
            Object.keys(config).forEach(tabName => {
                const categories = config[tabName];
                categories.forEach(category => {
                    const checkbox = document.querySelector(`input[value="${category}"][data-tab="${tabName}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.parentElement.classList.add('checked');
                    }
                });
            });
            
            alert(`${configName[configType]} ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n'ì„¤ì • ì €ì¥' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ì„¸ìš”.`);
        }

        // ì¹´í…Œê³ ë¦¬ ëª…ì¹­ í¸ì§‘
        function editCategoryName(category) {
            const displaySpan = document.querySelector(`.category-display-name[data-category="${category}"]`);
            if (!displaySpan) return;
            
            const currentName = mealCategoryNames[category] || category;
            
            // ì…ë ¥ í•„ë“œë¡œ ë³€ê²½
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentName;
            input.className = 'category-name-input';
            
            // ì €ì¥ ë° ì·¨ì†Œ ê¸°ëŠ¥
            const saveEdit = () => {
                const newName = input.value.trim();
                if (newName && newName !== currentName) {
                    mealCategoryNames[category] = newName;
                    updateAllCategoryNames();
                    alert(`"${category}"ì˜ ëª…ì¹­ì´ "${newName}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nëª¨ë“  í˜ì´ì§€ì— ì ìš©ë©ë‹ˆë‹¤.`);
                }
                displaySpan.textContent = mealCategoryNames[category];
                displaySpan.style.display = 'inline';
                input.remove();
            };
            
            const cancelEdit = () => {
                displaySpan.style.display = 'inline';
                input.remove();
            };
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
                else if (e.key === 'Escape') cancelEdit();
            });
            
            input.addEventListener('blur', saveEdit);
            
            // ìŠ¤íŒ¬ì„ ìˆ¨ê¸°ê³  ì…ë ¥ í•„ë“œ ì¶”ê°€
            displaySpan.style.display = 'none';
            displaySpan.parentNode.insertBefore(input, displaySpan);
            input.focus();
            input.select();
        }

        // ëª¨ë“  í™”ë©´ì—ì„œ ì¹´í…Œê³ ë¦¬ ëª…ì¹­ ì—…ë°ì´íŠ¸
        function updateAllCategoryNames() {
            // 1. íƒ­ ê´€ë¦¬ ëª¨ë‹¬ì˜ í‘œì‹œëª… ì—…ë°ì´íŠ¸
            document.querySelectorAll('.category-display-name').forEach(span => {
                const category = span.dataset.category;
                if (mealCategoryNames[category]) {
                    span.textContent = mealCategoryNames[category];
                }
            });
            
            // 2. ë©”ì¸ í…Œì´ë¸”ì˜ ì¹´í…Œê³ ë¦¬ ëª…ì¹­ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.category-name[data-original]').forEach(nameElement => {
                const originalCategory = nameElement.dataset.original;
                if (mealCategoryNames[originalCategory]) {
                    nameElement.textContent = mealCategoryNames[originalCategory];
                }
            });
            
            // 3. í˜„ì¬ íƒ­ì´ ë‹¤ì‹œ ë¡œë“œë  ë•Œ ì ìš©ë˜ë„ë¡ sampleData ì—…ë°ì´íŠ¸
            Object.keys(sampleData).forEach(tabName => {
                if (sampleData[tabName]) {
                    const newTabData = {};
                    Object.keys(sampleData[tabName]).forEach(category => {
                        const displayName = mealCategoryNames[category] || category;
                        newTabData[displayName] = sampleData[tabName][category];
                    });
                    sampleData[tabName] = newTabData;
                }
            });
        }

        // ì¹´í…Œê³ ë¦¬ì˜ í‘œì‹œëª… ê°€ì ¸ì˜¤ê¸°
        function getCategoryDisplayName(category) {
            return mealCategoryNames[category] || category;
        }

        // í…Œì´ë¸”ì—ì„œ ì¹´í…Œê³ ë¦¬ëª… í¸ì§‘
        function editCategoryFromTable(originalCategory) {
            const nameSpan = document.querySelector(`.category-name[data-original="${originalCategory}"]`);
            if (!nameSpan) return;
            
            const currentName = mealCategoryNames[originalCategory] || originalCategory;
            
            // ì…ë ¥ í•„ë“œë¡œ ë³€ê²½
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentName;
            input.className = 'category-name-input';
            
            // ì €ì¥ ë° ì·¨ì†Œ ê¸°ëŠ¥
            const saveEdit = () => {
                const newName = input.value.trim();
                if (newName && newName !== currentName) {
                    mealCategoryNames[originalCategory] = newName;
                    updateAllCategoryNames();
                    alert(`"${originalCategory}"ì˜ ëª…ì¹­ì´ "${newName}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nëª¨ë“  í˜ì´ì§€ì— ì ìš©ë©ë‹ˆë‹¤.`);
                }
                nameSpan.textContent = mealCategoryNames[originalCategory] || originalCategory;
                nameSpan.style.display = 'inline';
                input.remove();
            };
            
            const cancelEdit = () => {
                nameSpan.style.display = 'inline';
                input.remove();
            };
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
                else if (e.key === 'Escape') cancelEdit();
            });
            
            input.addEventListener('blur', saveEdit);
            
            // ìŠ¤íŒ¬ì„ ìˆ¨ê¸°ê³  ì…ë ¥ í•„ë“œ ì¶”ê°€
            nameSpan.style.display = 'none';
            nameSpan.parentNode.insertBefore(input, nameSpan);
            input.focus();
            input.select();
        }
    </script>
</body>
</html>