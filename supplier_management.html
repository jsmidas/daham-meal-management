<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>협력업체 관리 - 급식관리 시스템 v3.0</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', '맑은 고딕', Arial, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
            color: #333;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            text-align: center;
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: rgba(255,255,255,0.5);
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: white;
        }

        .nav-item .icon {
            margin-right: 12px;
            font-size: 16px;
        }

        .nav-divider {
            height: 1px;
            background: rgba(255,255,255,0.2);
            margin: 20px 0;
        }

        .logout-item {
            color: rgba(255,255,255,0.6);
            margin-top: 20px;
        }

        .logout-item:hover {
            color: #ff6b6b;
            background: rgba(255,107,107,0.1);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .content-header {
            background: white;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .content-header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 28px;
            font-weight: 600;
        }

        .content-header p {
            margin: 0;
            color: #666;
            font-size: 16px;
        }

        /* Main Container */
        .main-container {
            padding: 0 30px 30px;
            width: 100%;
            max-width: none;
        }

        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .control-panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-panel h2 i {
            color: #F5881F;
            font-size: 28px;
        }

        .control-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 500;
            color: #555;
            white-space: nowrap;
        }

        .form-input, .form-select {
            padding: 10px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #F5881F;
            box-shadow: 0 0 0 3px rgba(245, 136, 31, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #F5881F 0%, #E67309 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 136, 31, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 136, 31, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 16px;
            font-weight: 600;
            color: #555;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
        }

        .stat-icon.suppliers { background: linear-gradient(135deg, #F5881F, #E67309); }
        .stat-icon.active { background: linear-gradient(135deg, #28a745, #20c997); }
        .stat-icon.products { background: linear-gradient(135deg, #6f42c1, #e83e8c); }
        .stat-icon.sites { background: linear-gradient(135deg, #17a2b8, #fd7e14); }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }

        /* Data Table */
        .table-container {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
            width: 100%;
        }

        .table-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .table-scroll {
            overflow-x: auto;
            max-width: 100%;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 100%;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
            vertical-align: middle;
        }

        .data-table tr:hover {
            background-color: rgba(245, 136, 31, 0.05);
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            min-width: 70px;
            display: inline-block;
        }

        .status-active {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-inactive {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Company Scale Tags */
        .scale-tag {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .scale-large { background: #e3f2fd; color: #1565c0; }
        .scale-medium { background: #f3e5f5; color: #7b1fa2; }
        .scale-small { background: #e8f5e8; color: #2e7d32; }

        /* Action Buttons */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            margin: 0 2px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
        }

        .btn-edit:hover {
            background: #e0a800;
            transform: scale(1.05);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .btn-locations {
            background: #6f42c1;
            color: white;
        }

        .btn-locations:hover {
            background: #5a32a3;
            transform: scale(1.05);
        }

        .btn-products {
            background: #fd7e14;
            color: white;
        }

        .btn-products:hover {
            background: #e8690b;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .data-table {
                font-size: 12px;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #dee2e6;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* 모달 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .supplier-modal {
            width: 750px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        .btn-cancel:hover {
            background: #e9ecef;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* 납품처 관리 모달 스타일 */
        .location-modal {
            width: 900px;
            max-height: 80vh;
        }

        .product-modal {
            width: 900px;
            max-height: 80vh;
        }

        .location-management,
        .product-management {
            padding: 0;
        }

        .location-tabs,
        .product-tabs {
            display: flex;
            border-bottom: 2px solid #f1f3f4;
            background: #f8f9fa;
            margin: 0;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-btn.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }

        .locations-grid,
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .location-card,
        .product-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            transition: all 0.3s ease;
        }

        .location-card:hover,
        .product-card:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .location-info,
        .product-info {
            flex: 1;
        }

        .location-info h5,
        .product-info h5 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }

        .location-info p,
        .product-info p {
            margin: 4px 0;
            font-size: 13px;
            color: #666;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            min-width: auto;
        }

        .loading,
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
            grid-column: 1 / -1;
        }
    </style>
    <script src="config.js"></script>
    <script src="static/js/branding.js"></script>
</head>
<body>
    <!-- Top Navigation -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>관리자 시스템</h2>
                <p>테스트 급식관리 시스템</p>
            </div>
            
            <div class="nav-menu">
                <a href="/admin" class="nav-item">
                    <span class="icon">📊</span>대시보드
                </a>
                <a href="/admin/users" class="nav-item">
                    <span class="icon">👥</span>사용자 관리
                </a>
                <a href="/admin/suppliers" class="nav-item active">
                    <span class="icon">🚛</span>협력업체 관리
                </a>
                <a href="/admin/business-locations" class="nav-item">
                    <span class="icon">🏢</span>사업장 관리
                </a>
                <a href="/menu_recipe_management.html" class="nav-item">
                    <span class="icon">🍽️</span>메뉴 관리
                </a>
                <a href="/admin/meal-plans" class="nav-item">
                    <span class="icon">🔐</span>식단가 관리
                </a>
                <a href="/ingredients-management" class="nav-item">
                    <span class="icon">🥬</span>식자재 관리
                </a>
                <a href="/admin/system" class="nav-item">
                    <span class="icon">⚙️</span>시스템 설정
                </a>
                <a href="/admin/logs" class="nav-item">
                    <span class="icon">📋</span>로그 관리
                </a>
                <div class="nav-divider"></div>
                <a href="/dashboard.html" class="nav-item">
                    <span class="icon">🍽️</span>급식관리로 이동
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1><i class="fas fa-truck"></i> 협력업체 관리</h1>
                <p>협력업체 정보를 관리하고 사업장과의 매핑을 설정합니다</p>
            </div>

            <!-- Main Container -->
            <div class="main-container">
        <!-- Control Panel -->
        <div class="control-panel">
            <h2>
                <i class="fas fa-truck"></i>
                협력업체 관리
            </h2>
            
            <div class="control-row">
                <div class="control-group">
                    <label>검색:</label>
                    <input type="text" class="form-input" id="searchInput" placeholder="업체명, 모코드, 대표자명으로 검색..." style="width: 250px;">
                </div>
                
                <div class="control-group">
                    <label>회사규모:</label>
                    <select class="form-select" id="scaleFilter">
                        <option value="">전체 규모</option>
                        <option value="대기업">대기업</option>
                        <option value="중견기업">중견기업</option>
                        <option value="중소기업">중소기업</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>상태:</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">전체 상태</option>
                        <option value="active">거래중</option>
                        <option value="inactive">거래중단</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="searchSuppliers()">
                    <i class="fas fa-search"></i> 검색
                </button>
                
                <button class="btn btn-success" onclick="addSupplier()">
                    <i class="fas fa-plus"></i> 새 업체 추가
                </button>
                
                <button class="btn btn-info" onclick="exportData()">
                    <i class="fas fa-download"></i> 엑셀 내보내기
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">전체 협력업체</div>
                    <div class="stat-icon suppliers">
                        <i class="fas fa-truck"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalSuppliers">0</div>
                <div class="stat-label">등록된 협력업체 수</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">거래중</div>
                    <div class="stat-icon active">
                        <i class="fas fa-handshake"></i>
                    </div>
                </div>
                <div class="stat-value" id="activeSuppliers">0</div>
                <div class="stat-label">정상 거래중인 업체</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">공급 상품</div>
                    <div class="stat-icon products">
                        <i class="fas fa-boxes"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalProducts">65,183</div>
                <div class="stat-label">총 공급 상품 수</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">납품 사업장</div>
                    <div class="stat-icon sites">
                        <i class="fas fa-building"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalSites">12</div>
                <div class="stat-label">납품처 연결 수</div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-table"></i>
                    협력업체 목록
                </div>
                <div class="table-info">
                    총 <span id="tableCount">5</span>개 협력업체
                </div>
            </div>
            
            <div class="table-scroll">
                <table class="data-table" id="suppliersTable">
                    <thead>
                        <tr>
                            <th>모코드</th>
                            <th>업체명</th>
                            <th>사업자번호</th>
                            <th>대표자</th>
                            <th>본사연락처</th>
                            <th>납품처</th>
                            <th>관리</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersTableBody">
                        <!-- 샘플 데이터 -->
                        <tr>
                            <td><strong>CJ001</strong></td>
                            <td><strong>CJ프레시웨이</strong></td>
                            <td>
                                <span class="scale-tag scale-large">대기업</span>
                            </td>
                            <td>김대표</td>
                            <td>123-45-67890</td>
                            <td>
                                02-1234-5678<br>
                                <small>F: 02-1234-5679</small>
                            </td>
                            <td>
                                <a href="mailto:info@cjfreshway.com">info@cjfreshway.com</a><br>
                                <small><a href="https://www.cjfreshway.com" target="_blank">홈페이지</a></small>
                            </td>
                            <td>
                                <strong>16,714</strong>개
                                <button class="action-btn btn-products" onclick="viewProducts(1)" title="상품 보기">
                                    <i class="fas fa-boxes"></i>
                                </button>
                            </td>
                            <td>
                                <button class="action-btn btn-locations" onclick="manageLocations(1)" title="납품처 관리">
                                    <i class="fas fa-building"></i> 5개
                                </button>
                            </td>
                            <td>
                                <span class="status-badge status-active">거래중</span>
                            </td>
                            <td>
                                <button class="action-btn btn-edit" onclick="editSupplier(1)" title="편집">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteSupplier(1)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>HG001</strong></td>
                            <td><strong>현대그린푸드</strong></td>
                            <td>
                                <span class="scale-tag scale-large">대기업</span>
                            </td>
                            <td>박대표</td>
                            <td>234-56-78901</td>
                            <td>02-2345-6789</td>
                            <td>
                                <a href="mailto:info@hyundaigreenfood.co.kr">info@hyundaigreenfood.co.kr</a>
                            </td>
                            <td>
                                <strong>17,190</strong>개
                                <button class="action-btn btn-products" onclick="viewProducts(2)" title="상품 보기">
                                    <i class="fas fa-boxes"></i>
                                </button>
                            </td>
                            <td>
                                <button class="action-btn btn-locations" onclick="manageLocations(2)" title="납품처 관리">
                                    <i class="fas fa-building"></i> 3개
                                </button>
                            </td>
                            <td>
                                <span class="status-badge status-active">거래중</span>
                            </td>
                            <td>
                                <button class="action-btn btn-edit" onclick="editSupplier(2)" title="편집">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteSupplier(2)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>SJ001</strong></td>
                            <td><strong>사조푸디스트</strong></td>
                            <td>
                                <span class="scale-tag scale-medium">중견기업</span>
                            </td>
                            <td>이대표</td>
                            <td>345-67-89012</td>
                            <td>051-1234-5678</td>
                            <td>
                                <a href="mailto:info@sajofoodist.co.kr">info@sajofoodist.co.kr</a>
                            </td>
                            <td>
                                <strong>15,344</strong>개
                                <button class="action-btn btn-products" onclick="viewProducts(3)" title="상품 보기">
                                    <i class="fas fa-boxes"></i>
                                </button>
                            </td>
                            <td>
                                <button class="action-btn btn-locations" onclick="manageLocations(3)" title="납품처 관리">
                                    <i class="fas fa-building"></i> 4개
                                </button>
                            </td>
                            <td>
                                <span class="status-badge status-active">거래중</span>
                            </td>
                            <td>
                                <button class="action-btn btn-edit" onclick="editSupplier(3)" title="편집">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteSupplier(3)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>DW001</strong></td>
                            <td><strong>동원홈푸드</strong></td>
                            <td>
                                <span class="scale-tag scale-large">대기업</span>
                            </td>
                            <td>최대표</td>
                            <td>456-78-90123</td>
                            <td>02-3456-7890</td>
                            <td>
                                <a href="mailto:info@dongwonhomefood.com">info@dongwonhomefood.com</a>
                            </td>
                            <td>
                                <strong>15,849</strong>개
                                <button class="action-btn btn-products" onclick="viewProducts(4)" title="상품 보기">
                                    <i class="fas fa-boxes"></i>
                                </button>
                            </td>
                            <td>
                                <button class="action-btn btn-locations" onclick="manageLocations(4)" title="납품처 관리">
                                    <i class="fas fa-building"></i> 2개
                                </button>
                            </td>
                            <td>
                                <span class="status-badge status-active">거래중</span>
                            </td>
                            <td>
                                <button class="action-btn btn-edit" onclick="editSupplier(4)" title="편집">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteSupplier(4)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>YT001</strong></td>
                            <td><strong>영유통</strong></td>
                            <td>
                                <span class="scale-tag scale-small">중소기업</span>
                            </td>
                            <td>정대표</td>
                            <td>567-89-01234</td>
                            <td>032-4567-8901</td>
                            <td>
                                <a href="mailto:info@youngtrading.co.kr">info@youngtrading.co.kr</a>
                            </td>
                            <td>
                                <strong>91</strong>개
                                <button class="action-btn btn-products" onclick="viewProducts(5)" title="상품 보기">
                                    <i class="fas fa-boxes"></i>
                                </button>
                            </td>
                            <td>
                                <button class="action-btn btn-locations" onclick="manageLocations(5)" title="납품처 관리">
                                    <i class="fas fa-building"></i> 1개
                                </button>
                            </td>
                            <td>
                                <span class="status-badge status-active">거래중</span>
                            </td>
                            <td>
                                <button class="action-btn btn-edit" onclick="editSupplier(5)" title="편집">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteSupplier(5)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 페이지 로드 시 초기화 (제거됨 - 하단의 initializePage로 통합)

        // 이벤트 리스너 초기화
        function initializeEventListeners() {
            // 기존 이벤트 리스너 제거 방지를 위해 한 번만 실행되도록 확인
            if (document.getElementById('searchInput').hasAttribute('data-listeners-initialized')) {
                return;
            }
            
            document.getElementById('searchInput').addEventListener('input', debounce(searchSuppliers, 300));
            
            ['scaleFilter', 'statusFilter'].forEach(id => {
                document.getElementById(id).addEventListener('change', searchSuppliers);
            });

            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchSuppliers();
                }
            });
            
            // 이벤트 리스너 초기화 완료 표시
            document.getElementById('searchInput').setAttribute('data-listeners-initialized', 'true');
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 통계 업데이트 (제거됨 - 하단의 updateStats(suppliers) 함수와 중복)

        // 검색 및 필터링
        async function searchSuppliers() {
            console.log('searchSuppliers 함수 호출됨', new Date().toISOString());
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const scaleFilter = document.getElementById('scaleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            try {
                console.log('API 호출 시작:', '/api/admin/suppliers/enhanced');
                const response = await fetch('/api/admin/suppliers/enhanced');
                if (response.ok) {
                    const result = await response.json();
                    const suppliers = result.suppliers || result.data || [];
                    let filteredSuppliers = suppliers;

                    // 검색어 필터링
                    if (searchTerm) {
                        filteredSuppliers = filteredSuppliers.filter(supplier => 
                            supplier.name.toLowerCase().includes(searchTerm) ||
                            supplier.business_number.includes(searchTerm) ||
                            (supplier.representative && supplier.representative.toLowerCase().includes(searchTerm))
                        );
                    }

                    // 규모 필터링
                    if (scaleFilter) {
                        filteredSuppliers = filteredSuppliers.filter(supplier => 
                            supplier.company_scale === scaleFilter
                        );
                    }

                    // 상태 필터링
                    if (statusFilter) {
                        const isActive = statusFilter === 'active';
                        filteredSuppliers = filteredSuppliers.filter(supplier => 
                            supplier.is_active === isActive
                        );
                    }

                    displaySuppliers(filteredSuppliers);
                    updateStats(filteredSuppliers);
                } else {
                    showError('검색 중 오류가 발생했습니다.');
                }
            } catch (error) {
                console.error('검색 오류:', error);
                showError('검색 중 오류가 발생했습니다.');
            }
        }

        // 새 협력업체 추가
        function addSupplier() {
            showAddSupplierModal();
        }

        function showAddSupplierModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content supplier-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-plus-circle"></i> 새 협력업체 추가</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <form id="supplierForm" onsubmit="handleSupplierSubmit(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>모코드</label>
                                <input type="text" name="parent_code" maxlength="10" placeholder="예: SUP001">
                                <small>협력업체에서 부여하는 고유코드</small>
                            </div>
                            <div class="form-group">
                                <label>업체명 *</label>
                                <input type="text" name="name" required>
                            </div>
                            <div class="form-group">
                                <label>사업자번호 *</label>
                                <input type="text" name="business_number" required placeholder="000-00-00000">
                            </div>
                            <div class="form-group">
                                <label>대표자명 *</label>
                                <input type="text" name="representative" required>
                            </div>
                            <div class="form-group">
                                <label>업종</label>
                                <input type="text" name="business_type">
                            </div>
                            <div class="form-group">
                                <label>종목</label>
                                <input type="text" name="business_item">
                            </div>
                            <div class="form-group">
                                <label>본사전화</label>
                                <input type="text" name="headquarters_phone">
                            </div>
                            <div class="form-group full-width">
                                <label>본사주소</label>
                                <input type="text" name="headquarters_address">
                            </div>
                            <div class="form-group">
                                <label>이메일</label>
                                <input type="email" name="email">
                            </div>
                            <div class="form-group">
                                <label>홈페이지</label>
                                <input type="url" name="website">
                            </div>
                            <div class="form-group">
                                <label>회사규모</label>
                                <select name="company_scale">
                                    <option value="">선택</option>
                                    <option value="대기업">대기업</option>
                                    <option value="중소기업">중소기업</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>비고</label>
                                <textarea name="notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" onclick="closeModal(this)" class="btn btn-cancel">취소</button>
                            <button type="submit" class="btn btn-primary">추가</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 협력업체 편집
        async function editSupplier(id) {
            try {
                const response = await fetch(`/api/admin/suppliers/${id}/detail`);
                if (response.ok) {
                    const result = await response.json();
                    const supplier = result.supplier || result;
                    showEditSupplierModal(supplier);
                } else {
                    showError('협력업체 정보를 불러올 수 없습니다.');
                }
            } catch (error) {
                console.error('협력업체 정보 로드 오류:', error);
                showError('협력업체 정보를 불러올 수 없습니다.');
            }
        }

        function showEditSupplierModal(supplier) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content supplier-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-edit"></i> 협력업체 수정</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <form id="supplierEditForm" onsubmit="handleSupplierEdit(event, ${supplier.id})">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>모코드</label>
                                <input type="text" name="parent_code" value="${supplier.parent_code || ''}" maxlength="10" placeholder="예: SUP001">
                                <small>협력업체에서 부여하는 고유코드</small>
                            </div>
                            <div class="form-group">
                                <label>업체명 *</label>
                                <input type="text" name="name" value="${supplier.name || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>사업자번호 *</label>
                                <input type="text" name="business_number" value="${supplier.business_number || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>대표자명 *</label>
                                <input type="text" name="representative" value="${supplier.representative || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>업종</label>
                                <input type="text" name="business_type" value="${supplier.business_type || ''}">
                            </div>
                            <div class="form-group">
                                <label>종목</label>
                                <input type="text" name="business_item" value="${supplier.business_item || ''}">
                            </div>
                            <div class="form-group">
                                <label>본사전화</label>
                                <input type="text" name="headquarters_phone" value="${supplier.headquarters_phone || ''}">
                            </div>
                            <div class="form-group full-width">
                                <label>본사주소</label>
                                <input type="text" name="headquarters_address" value="${supplier.headquarters_address || ''}">
                            </div>
                            <div class="form-group">
                                <label>이메일</label>
                                <input type="email" name="email" value="${supplier.email || ''}">
                            </div>
                            <div class="form-group">
                                <label>홈페이지</label>
                                <input type="url" name="website" value="${supplier.website || ''}">
                            </div>
                            <div class="form-group">
                                <label>회사규모</label>
                                <select name="company_scale">
                                    <option value="">선택</option>
                                    <option value="대기업" ${supplier.company_scale === '대기업' ? 'selected' : ''}>대기업</option>
                                    <option value="중소기업" ${supplier.company_scale === '중소기업' ? 'selected' : ''}>중소기업</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>거래상태</label>
                                <select name="is_active">
                                    <option value="true" ${supplier.is_active ? 'selected' : ''}>활성</option>
                                    <option value="false" ${!supplier.is_active ? 'selected' : ''}>비활성</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>비고</label>
                                <textarea name="notes" rows="3">${supplier.notes || ''}</textarea>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" onclick="closeModal(this)" class="btn btn-cancel">취소</button>
                            <button type="submit" class="btn btn-primary">수정</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function handleSupplierEdit(event, supplierId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const supplierData = Object.fromEntries(formData.entries());
            
            // is_active를 boolean으로 변환
            supplierData.is_active = supplierData.is_active === 'true';

            try {
                const response = await fetch(`/api/admin/suppliers/${supplierId}/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(supplierData)
                });

                if (response.ok) {
                    showSuccess('협력업체 정보가 성공적으로 수정되었습니다.');
                    closeModal(event.target);
                    await loadSuppliers(); // 목록 새로고침
                } else {
                    const error = await response.json();
                    showError(error.detail || '협력업체 수정에 실패했습니다.');
                }
            } catch (error) {
                console.error('협력업체 수정 오류:', error);
                showError('협력업체 수정 중 오류가 발생했습니다.');
            }
        }

        // 협력업체 삭제
        async function deleteSupplier(id) {
            const confirmed = confirm('정말로 이 협력업체를 삭제하시겠습니까?\n\n⚠️ 삭제된 데이터는 복구할 수 없습니다.');
            
            if (!confirmed) return;

            try {
                const response = await fetch(`/api/admin/suppliers/${id}/delete`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showSuccess('협력업체가 성공적으로 삭제되었습니다.');
                    await loadSuppliers(); // 목록 새로고침
                } else {
                    const error = await response.json();
                    showError(error.detail || '협력업체 삭제에 실패했습니다.');
                }
            } catch (error) {
                console.error('협력업체 삭제 오류:', error);
                showError('협력업체 삭제 중 오류가 발생했습니다.');
            }
        }

        // 납품처 관리
        async function manageLocations(id) {
            try {
                // 협력업체 정보와 사업장 목록을 동시에 가져오기
                const [supplierResponse, locationsResponse] = await Promise.all([
                    fetch(`/api/admin/suppliers/${id}/detail`),
                    fetch('/api/admin/sites')
                ]);

                if (supplierResponse.ok && locationsResponse.ok) {
                    const supplierResult = await supplierResponse.json();
                    const locationsResult = await locationsResponse.json();
                    const supplier = supplierResult.supplier || supplierResult;
                    const locations = locationsResult.sites || locationsResult.data || [];
                    showLocationManagementModal(supplier, locations);
                } else {
                    showError('납품처 관리 데이터를 불러올 수 없습니다.');
                }
            } catch (error) {
                console.error('납품처 관리 데이터 로드 오류:', error);
                showError('납품처 관리 데이터를 불러올 수 없습니다.');
            }
        }

        function showLocationManagementModal(supplier, locations) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content location-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-map-marker-alt"></i> ${supplier.name} - 납품처 관리</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="location-management">
                        <div class="location-tabs">
                            <button class="tab-btn active" onclick="switchLocationTab(event, 'current')">현재 납품처</button>
                            <button class="tab-btn" onclick="switchLocationTab(event, 'available')">추가 가능한 사업장</button>
                        </div>
                        
                        <div id="current-locations" class="tab-content active">
                            <div class="current-locations-list">
                                <h4>현재 연결된 납품처</h4>
                                <div class="locations-grid" id="currentLocationsList">
                                    <div class="loading">납품처 정보를 불러오는 중...</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="available-locations" class="tab-content">
                            <div class="available-locations-list">
                                <h4>추가 가능한 사업장</h4>
                                <div class="search-box">
                                    <input type="text" id="locationSearch" placeholder="사업장 검색..." onkeyup="filterLocations()">
                                </div>
                                <div class="locations-grid" id="availableLocationsList">
                                    ${locations.map(location => `
                                        <div class="location-card" data-location-id="${location.id}">
                                            <div class="location-info">
                                                <h5>${location.site_name}</h5>
                                                <p><strong>코드:</strong> ${location.site_code}</p>
                                                <p><strong>유형:</strong> ${location.site_type || '-'}</p>
                                                <p><strong>지역:</strong> ${location.region || '-'}</p>
                                            </div>
                                            <button class="btn btn-sm btn-primary" onclick="addSupplierLocation(${supplier.id}, ${location.id})">
                                                <i class="fas fa-plus"></i> 추가
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeModal(this)" class="btn btn-cancel">닫기</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // 현재 납품처 로드
            loadCurrentSupplierLocations(supplier.id);
        }

        async function loadCurrentSupplierLocations(supplierId) {
            try {
                // 임시로 빈 배열 표시 (실제로는 API에서 현재 매핑 정보를 가져와야 함)
                const container = document.getElementById('currentLocationsList');
                container.innerHTML = '<div class="no-data">현재 연결된 납품처가 없습니다.</div>';
            } catch (error) {
                console.error('현재 납품처 로드 오류:', error);
            }
        }

        function switchLocationTab(event, tabName) {
            // 탭 버튼 활성화
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 탭 콘텐츠 활성화
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-locations').classList.add('active');
        }

        function filterLocations() {
            const searchTerm = document.getElementById('locationSearch').value.toLowerCase();
            const locationCards = document.querySelectorAll('#availableLocationsList .location-card');
            
            locationCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        async function addSupplierLocation(supplierId, locationId) {
            try {
                // 실제로는 supplier-site mapping API를 호출해야 함
                showSuccess('납품처가 성공적으로 추가되었습니다.');
                // 현재 납품처 목록 새로고침
                await loadCurrentSupplierLocations(supplierId);
            } catch (error) {
                console.error('납품처 추가 오류:', error);
                showError('납품처 추가 중 오류가 발생했습니다.');
            }
        }

        // 상품 보기
        async function viewProducts(id) {
            try {
                // 협력업체 정보와 상품 목록을 가져오기
                const [supplierResponse, productsResponse] = await Promise.all([
                    fetch(`/api/admin/suppliers/${id}/detail`),
                    fetch(`/api/admin/ingredients`) // 전체 식자재 목록
                ]);

                if (supplierResponse.ok && productsResponse.ok) {
                    const supplierResult = await supplierResponse.json();
                    const ingredientsResult = await productsResponse.json();
                    const supplier = supplierResult.supplier || supplierResult;
                    const allIngredients = ingredientsResult.ingredients || ingredientsResult.data || [];
                    showProductManagementModal(supplier, allIngredients);
                } else {
                    showError('상품 관리 데이터를 불러올 수 없습니다.');
                }
            } catch (error) {
                console.error('상품 관리 데이터 로드 오류:', error);
                showError('상품 관리 데이터를 불러올 수 없습니다.');
            }
        }

        function showProductManagementModal(supplier, allIngredients) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content product-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-box"></i> ${supplier.name} - 상품 관리</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="product-management">
                        <div class="product-tabs">
                            <button class="tab-btn active" onclick="switchProductTab(event, 'current')">현재 공급 상품</button>
                            <button class="tab-btn" onclick="switchProductTab(event, 'available')">추가 가능한 식자재</button>
                        </div>
                        
                        <div id="current-products" class="tab-content active">
                            <div class="current-products-list">
                                <h4>현재 공급 중인 상품</h4>
                                <div class="products-grid" id="currentProductsList">
                                    <div class="loading">상품 정보를 불러오는 중...</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="available-products" class="tab-content">
                            <div class="available-products-list">
                                <h4>추가 가능한 식자재</h4>
                                <div class="search-box">
                                    <input type="text" id="productSearch" placeholder="식자재 검색..." onkeyup="filterProducts()">
                                </div>
                                <div class="products-grid" id="availableProductsList">
                                    ${allIngredients.slice(0, 20).map(ingredient => `
                                        <div class="product-card" data-ingredient-id="${ingredient.id}">
                                            <div class="product-info">
                                                <h5>${ingredient.name}</h5>
                                                <p><strong>단위:</strong> ${ingredient.base_unit}</p>
                                                <p><strong>기본가격:</strong> ${ingredient.price ? Number(ingredient.price).toLocaleString() + '원' : '-'}</p>
                                            </div>
                                            <button class="btn btn-sm btn-primary" onclick="addSupplierProduct(${supplier.id}, ${ingredient.id})">
                                                <i class="fas fa-plus"></i> 추가
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeModal(this)" class="btn btn-cancel">닫기</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // 현재 상품 로드
            loadCurrentSupplierProducts(supplier.id);
        }

        async function loadCurrentSupplierProducts(supplierId) {
            try {
                // 임시로 빈 배열 표시 (실제로는 SupplierIngredient API를 호출해야 함)
                const container = document.getElementById('currentProductsList');
                container.innerHTML = '<div class="no-data">현재 공급 중인 상품이 없습니다.</div>';
            } catch (error) {
                console.error('현재 상품 로드 오류:', error);
            }
        }

        function switchProductTab(event, tabName) {
            // 탭 버튼 활성화
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 탭 콘텐츠 활성화
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-products').classList.add('active');
        }

        function filterProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const productCards = document.querySelectorAll('#availableProductsList .product-card');
            
            productCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        async function addSupplierProduct(supplierId, ingredientId) {
            try {
                // 실제로는 SupplierIngredient 생성 API를 호출해야 함
                showSuccess('상품이 성공적으로 추가되었습니다.');
                // 현재 상품 목록 새로고침
                await loadCurrentSupplierProducts(supplierId);
            } catch (error) {
                console.error('상품 추가 오류:', error);
                showError('상품 추가 중 오류가 발생했습니다.');
            }
        }

        // 엑셀 내보내기
        async function exportData() {
            try {
                const response = await fetch('/api/admin/suppliers/enhanced');
                if (response.ok) {
                    const result = await response.json();
                    const suppliers = result.suppliers || result.data || [];
                    exportToExcel(suppliers);
                } else {
                    showError('데이터를 불러올 수 없습니다.');
                }
            } catch (error) {
                console.error('엑셀 내보내기 오류:', error);
                showError('엑셀 내보내기 중 오류가 발생했습니다.');
            }
        }

        function exportToExcel(suppliers) {
            // CSV 형태로 데이터 생성
            const headers = [
                '업체명',
                '사업자번호',
                '대표자명',
                '업종',
                '종목',
                '본사전화',
                '본사주소',
                '이메일',
                '홈페이지',
                '회사규모',
                '거래상태',
                '납품처수',
                '등록일'
            ];

            let csvContent = headers.join(',') + '\\n';
            
            suppliers.forEach(supplier => {
                const row = [
                    `"${supplier.name || ''}"`,
                    `"${supplier.business_number || ''}"`,
                    `"${supplier.representative || ''}"`,
                    `"${supplier.business_type || ''}"`,
                    `"${supplier.business_item || ''}"`,
                    `"${supplier.headquarters_phone || ''}"`,
                    `"${supplier.headquarters_address || ''}"`,
                    `"${supplier.email || ''}"`,
                    `"${supplier.website || ''}"`,
                    `"${supplier.company_scale || ''}"`,
                    `"${supplier.is_active ? '활성' : '비활성'}"`,
                    `"${supplier.site_count || 0}"`,
                    `"${supplier.created_at ? new Date(supplier.created_at).toLocaleDateString() : ''}"`
                ];
                csvContent += row.join(',') + '\\n';
            });

            // 파일 다운로드
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `협력업체_목록_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess('협력업체 목록이 CSV 파일로 다운로드되었습니다.');
        }

        // 폼 제출 처리
        async function handleSupplierSubmit(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const supplierData = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/admin/suppliers/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(supplierData)
                });

                if (response.ok) {
                    showSuccess('협력업체가 성공적으로 추가되었습니다.');
                    closeModal(event.target);
                    await loadSuppliers(); // 목록 새로고침
                } else {
                    const error = await response.json();
                    showError(error.detail || '협력업체 추가에 실패했습니다.');
                }
            } catch (error) {
                console.error('협력업체 추가 오류:', error);
                showError('협력업체 추가 중 오류가 발생했습니다.');
            }
        }

        // 모달 관리
        function closeModal(element) {
            const modal = element.closest('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // 실제 데이터 로드
        async function loadSuppliers() {
            console.log('loadSuppliers 함수 호출됨', new Date().toISOString());
            try {
                console.log('loadSuppliers API 호출 시작:', '/api/admin/suppliers/enhanced');
                const response = await fetch('/api/admin/suppliers/enhanced');
                if (response.ok) {
                    const data = await response.json();
                    const suppliers = data.suppliers || data; // 새 API 응답 형식에 맞춤
                    displaySuppliers(suppliers);
                    updateStats(suppliers);
                } else {
                    console.error('API 응답 오류:', response.status);
                    showError('협력업체 데이터를 불러올 수 없습니다.');
                    displaySuppliers([]); // 빈 배열로 초기화
                }
            } catch (error) {
                console.error('데이터 로드 오류:', error);
                showError('협력업체 데이터를 불러오는 중 오류가 발생했습니다.');
                displaySuppliers([]); // 빈 배열로 초기화
            }
        }

        // 데이터 표시
        function displaySuppliers(suppliers) {
            console.log('displaySuppliers 함수 호출됨, 공급업체 수:', suppliers.length);
            const tableBody = document.querySelector('#suppliersTable tbody');
            if (!tableBody) return;

            if (suppliers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">검색 결과가 없습니다.</td></tr>';
                return;
            }

            tableBody.innerHTML = suppliers.map(supplier => `
                <tr>
                    <td><strong>${supplier.parent_code || '-'}</strong></td>
                    <td><strong>${supplier.name}</strong></td>
                    <td>${supplier.business_number || '-'}</td>
                    <td>${supplier.representative || '-'}</td>
                    <td>${supplier.headquarters_phone || '-'}</td>
                    <td>${supplier.site_count || 0}</td>
                    <td class="actions">
                        <button onclick="editSupplier(${supplier.id})" class="action-btn edit" title="편집">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="manageLocations(${supplier.id})" class="action-btn locations" title="납품처 관리">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                        <button onclick="viewProducts(${supplier.id})" class="action-btn products" title="상품 관리">
                            <i class="fas fa-box"></i>
                        </button>
                        <button onclick="deleteSupplier(${supplier.id})" class="action-btn delete" title="삭제">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // 통계 업데이트
        function updateStats(suppliers) {
            const activeCount = suppliers.filter(s => s.is_active).length;
            const totalSites = suppliers.reduce((sum, s) => sum + (s.site_count || 0), 0);

            // 안전하게 요소 업데이트
            const totalSuppliersEl = document.getElementById('totalSuppliers');
            const activeSuppliersEl = document.getElementById('activeSuppliers');
            const totalSitesEl = document.getElementById('totalSites');
            
            if (totalSuppliersEl) totalSuppliersEl.textContent = suppliers.length;
            if (activeSuppliersEl) activeSuppliersEl.textContent = activeCount;
            if (totalSitesEl) totalSitesEl.textContent = totalSites;
        }

        // 유틸리티 함수들
        function showInfo(message) {
            alert('ℹ️ ' + message);
        }

        function showSuccess(message) {
            alert('✅ ' + message);
        }

        function showError(message) {
            alert('❌ ' + message);
        }

        // 페이지 초기화 플래그
        let isInitialized = false;
        
        // 페이지 초기화
        async function initializePage() {
            if (isInitialized) {
                console.log('페이지가 이미 초기화되었습니다.');
                return;
            }
            
            console.log('협력업체 관리 페이지 초기화 시작', new Date().toISOString());
            isInitialized = true;
            
            // 이벤트 리스너 초기화
            console.log('이벤트 리스너 초기화 중...');
            initializeEventListeners();
            
            // 실제 데이터 로드 시도
            try {
                await loadSuppliers();
            } catch (error) {
                console.error('초기 데이터 로드 실패, 샘플 데이터 표시:', error);
                // 샘플 데이터로 통계 업데이트
                const totalSuppliersEl = document.getElementById('totalSuppliers');
                const activeSuppliersEl = document.getElementById('activeSuppliers');
                const totalSitesEl = document.getElementById('totalSites');
                
                if (totalSuppliersEl) totalSuppliersEl.textContent = '5';
                if (activeSuppliersEl) activeSuppliersEl.textContent = '5';
                if (totalSitesEl) totalSitesEl.textContent = '15';
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', initializePage);

        // 로그아웃 함수
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                window.location.href = '/login';
            }
        }
    </script>
        </div> <!-- main-container -->
        </div> <!-- main-content -->
    </div> <!-- dashboard-container -->

    <!-- 브랜딩 적용 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 브랜딩 시스템 적용
            if (typeof BrandingManager !== 'undefined') {
                BrandingManager.applyBranding('급식관리');
                console.log('✅ 브랜딩 시스템 적용 완료 (급식관리)');
            }
        });
    </script>
</body>
</html>