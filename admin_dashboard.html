<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤í•¨ ì‹ìì¬ ê´€ë¦¬ ì‹œìŠ¤í…œ - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    
    <!-- ì™¸ë¶€ CSS -->
    <link rel="stylesheet" href="static/css/admin-dashboard-main.css">
    
    <!-- ê°„ë‹¨í•œ ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ëª¨ë“ˆ ë¡œë” ëŒ€ì‹  ê°„ë‹¨í•œ ì´ˆê¸°í™”
        const API_BASE = 'http://127.0.0.1:8006';
        console.log('Admin Dashboard ì‹œì‘');
    </script>
</head>
<body>
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="admin-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ½ï¸ ë‹¤í•¨ ì‹ìì¬ ê´€ë¦¬</h2>
                <p>ê´€ë¦¬ì ì‹œìŠ¤í…œ</p>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="icon">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <span class="icon">ğŸ‘¥</span>ì‚¬ìš©ì ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="suppliers">
                    <span class="icon">ğŸš›</span>í˜‘ë ¥ì—…ì²´ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="business-locations">
                    <span class="icon">ğŸ¢</span>ì‚¬ì—…ì¥ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="meal-pricing">
                    <span class="icon">ğŸ’°</span>ì‹ë‹¨ê°€ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="ingredients">
                    <span class="icon">ğŸ“¦</span>ì‹ìì¬ ê´€ë¦¬
                </a>
            </div>
            
            <div class="sidebar-footer" style="margin-top: auto; padding: 20px;">
                <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px;">
                    <a href="/" class="nav-item" style="background: #e8f5e8; color: #4caf50;">
                        <span class="icon">ğŸ½ï¸</span>ê¸‰ì‹ê´€ë¦¬ë¡œ ì´ë™
                    </a>
                </div>
            </div>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <div class="header">
                <h1 id="page-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                <div class="header-info">
                    <div class="user-info">
                        ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”! | ì˜¤ëŠ˜: <span id="current-date"></span>
                    </div>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <!-- í˜ì´ì§€ë³„ ì»¨í…ì¸  ì˜ì—­ -->
            <div id="content-area">
                <!-- ëŒ€ì‹œë³´ë“œ ê¸°ë³¸ ì»¨í…ì¸  -->
                <div id="dashboard-content" class="page-content">
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸ‘¥</span>
                                <h3 class="card-title">ì „ì²´ ì‚¬ìš©ì</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-users">-</div>
                                <div class="stat-label">ë“±ë¡ëœ ì‚¬ìš©ì ìˆ˜</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸ¢</span>
                                <h3 class="card-title">ì‚¬ì—…ì¥</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-sites">-</div>
                                <div class="stat-label">ê´€ë¦¬ ì¤‘ì¸ ì‚¬ì—…ì¥</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸ“¦</span>
                                <h3 class="card-title">ì‹ìì¬</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-ingredients">-</div>
                                <div class="stat-label">ë“±ë¡ëœ ì‹ìì¬</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸš›</span>
                                <h3 class="card-title">í˜‘ë ¥ì—…ì²´</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-suppliers">-</div>
                                <div class="stat-label">ë“±ë¡ëœ í˜‘ë ¥ì—…ì²´</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìµœê·¼ í™œë™ ë¡œê·¸ -->
                    <div class="activity-log">
                        <h3 style="margin-bottom: 20px;">ğŸ“ˆ ìµœê·¼ í™œë™</h3>
                        <div id="activity-list">
                            <div class="log-item">
                                <div class="log-time">ë¡œë”© ì¤‘...</div>
                                <div class="log-message">ì‹œìŠ¤í…œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë‹¤ë¥¸ í˜ì´ì§€ ì»¨í…ì¸ ë“¤ì€ ë™ì ìœ¼ë¡œ ë¡œë“œ -->
                <div id="users-content" class="page-content" style="display: none;">
                    <!-- ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="suppliers-content" class="page-content" style="display: none;">
                    <!-- í˜‘ë ¥ì—…ì²´ ê´€ë¦¬ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="business-locations-content" class="page-content" style="display: none;">
                    <!-- ì‚¬ì—…ì¥ ê´€ë¦¬ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="meal-pricing-content" class="page-content" style="display: none;">
                    <!-- ì‹ë‹¨ê°€ ê´€ë¦¬ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="ingredients-content" class="page-content" style="display: none;">
                    <!-- ì‹ìì¬ ê´€ë¦¬ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </main>
    </div>

    <!-- ğŸš€ ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ì˜ì¡´ì„± ìë™ ê´€ë¦¬) -->
    <script>
        // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ í—¬í¼ í•¨ìˆ˜
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ [Admin Dashboard] ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
            
            try {
                
                // âš¡ Phase 1: í•„ìˆ˜ ëª¨ë“ˆ ìˆ˜ë™ ë¡œë“œ (ìˆœì°¨ì  + ê²€ì¦)
                console.log('ğŸ“¦ [Admin Dashboard] í•„ìˆ˜ ëª¨ë“ˆ ìˆ˜ë™ ë¡œë“œ ì¤‘...');
                
                // config.js ì§ì ‘ ë¡œë“œ ë° í™•ì¸
                if (!window.CONFIG) {
                    console.log('ğŸ”§ config.js ë¡œë”©...');
                    await loadScript('config.js');
                    
                    let attempts = 0;
                    while (!window.CONFIG && attempts < 20) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }
                    
                    if (!window.CONFIG) {
                        throw new Error('config.js ë¡œë“œ ì‹¤íŒ¨');
                    }
                    console.log('âœ… CONFIG ë¡œë“œ ì™„ë£Œ');
                }
                
                // DateTimeUtils ë¡œë“œ ë° í™•ì¸
                console.log('ğŸ•’ date-time-utils.js ë¡œë”©...');
                await loadScript('static/utils/date-time-utils.js');
                
                let attempts = 0;
                while ((!window.DateTimeUtils || typeof window.DateTimeUtils.startRealTimeUpdate !== 'function') && attempts < 20) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.DateTimeUtils || typeof window.DateTimeUtils.startRealTimeUpdate !== 'function') {
                    console.warn('âš ï¸  DateTimeUtils ë¡œë“œ ì‹¤íŒ¨ - ê¸°ë³¸ ê¸°ëŠ¥ ì‚¬ìš©');
                } else {
                    console.log('âœ… DateTimeUtils ë¡œë“œ ì™„ë£Œ');
                }
                
                // ë‚˜ë¨¸ì§€ ìœ í‹¸ë¦¬í‹°ë“¤ ë¡œë“œ
                console.log('ğŸ›¡ï¸ error-handler.js ë¡œë”©...');
                await loadScript('static/utils/error-handler.js');
                
                console.log('ğŸ”„ loading-manager.js ë¡œë”©...');
                await loadScript('static/utils/loading-manager.js');
                
                // LoadingManager ë¡œë“œ í™•ì¸ ë° ëŒ€ê¸°
                attempts = 0;
                while ((!window.LoadingManager || typeof window.LoadingManager.startLoading !== 'function') && attempts < 20) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.LoadingManager || typeof window.LoadingManager.startLoading !== 'function') {
                    console.warn('âš ï¸  LoadingManager ë¡œë“œ ì‹¤íŒ¨ - ê¸°ë³¸ ê¸°ëŠ¥ ì‚¬ìš©');
                } else {
                    console.log('âœ… LoadingManager ë¡œë“œ ì™„ë£Œ');
                }
                
                console.log('ğŸ—„ï¸ admin-cache.js ë¡œë”©...');
                await loadScript('static/utils/admin-cache.js');
                
                console.log('âœ… [Admin Dashboard] í•„ìˆ˜ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                
                // âš¡ Phase 2: ëŒ€ì‹œë³´ë“œ ì½”ì–´ ë¡œë“œ  
                console.log('ğŸ¯ [Admin Dashboard] ëŒ€ì‹œë³´ë“œ ì½”ì–´ ë¡œë“œ ì¤‘...');
                await loadScript('static/modules/dashboard-core/dashboard-core.js');
                
                if (!window.DashboardCore) {
                    throw new Error('DashboardCore í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                
                // âš¡ Phase 3: ì‹œìŠ¤í…œ ì‹œì‘
                console.log('âœ¨ [Admin Dashboard] ì‹œìŠ¤í…œ ì‹œì‘');
                
                // ë‚ ì§œ í‘œì‹œ (ê¸°ë³¸ ë°©ì‹)
                const currentDateElement = document.getElementById('current-date');
                if (currentDateElement) {
                    currentDateElement.textContent = new Date().toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long', 
                        day: 'numeric',
                        weekday: 'short'
                    });
                }
                
                // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
                window.dashboard = new window.DashboardCore();
                
                console.log('ğŸ‰ [Admin Dashboard] ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                
                // ëª¨ë“ˆ ìƒíƒœ í™•ì¸
                console.log('ğŸ“Š [Admin Dashboard] ë¡œë“œëœ ëª¨ë“ˆë“¤:');
                console.log('- CONFIG:', !!window.CONFIG);
                console.log('- DateTimeUtils:', !!window.DateTimeUtils, typeof window.DateTimeUtils?.startRealTimeUpdate);
                console.log('- ErrorHandler:', !!window.ErrorHandler, typeof window.ErrorHandler?.handleError);
                console.log('- LoadingManager:', !!window.LoadingManager, typeof window.LoadingManager?.startLoading);
                console.log('- AdminCache:', !!window.AdminCache);
                console.log('- DashboardCore:', !!window.DashboardCore);
                
            } catch (error) {
                console.error('âŒ [Admin Dashboard] ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showInitializationError(error);
            }
        });
        
        /**
         * ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í‘œì‹œ
         */
        function showInitializationError(error) {
            const contentArea = document.getElementById('content-area');
            if (contentArea) {
                contentArea.innerHTML = `
                    <div style="padding: 40px; text-align: center; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #ff6b6b;">âš ï¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨</h2>
                        <p style="color: #666; margin: 20px 0;">ê´€ë¦¬ì ì‹œìŠ¤í…œì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; font-family: monospace; font-size: 12px; color: #333; text-align: left;">
                            ${error.message || error.toString()}
                        </div>
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                            ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button onclick="ModuleLoader.getModuleStatus()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ” ëª¨ë“ˆ ìƒíƒœ í™•ì¸
                        </button>
                    </div>
                `;
            }
        }
        
        /**
         * ì•ˆì „í•œ ë¡œê·¸ì•„ì›ƒ (ì˜ì¡´ì„± í™•ì¸ í›„ ì‹¤í–‰)
         */
        async function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ìºì‹œ ì •ë¦¬
                    if (window.AdminCache) {
                        AdminCache.clearAllCache();
                        console.log('ğŸ—‘ï¸ [Logout] ìºì‹œ ì •ë¦¬ ì™„ë£Œ');
                    }
                    
                    // ëŒ€ì‹œë³´ë“œ ì •ë¦¬
                    if (window.dashboard && typeof window.dashboard.destroy === 'function') {
                        window.dashboard.destroy();
                        console.log('ğŸ§¹ [Logout] ëŒ€ì‹œë³´ë“œ ì •ë¦¬ ì™„ë£Œ');
                    }
                    
                    // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    console.log('ğŸšª [Logout] ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                    window.location.href = '/';
                    
                } catch (error) {
                    console.error('âŒ [Logout] ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ë¡œê·¸ì•„ì›ƒ ì§„í–‰
                    window.location.href = '/';
                }
            }
        }
        
        /**
         * ê°œë°œììš© ë””ë²„ê·¸ í•¨ìˆ˜ë“¤ (ì½˜ì†”ì—ì„œ ì‚¬ìš©)
         */
        window.debugInfo = {
            modules: () => ModuleLoader.getModuleStatus(),
            cache: () => AdminCache ? AdminCache.getCacheStatus() : 'AdminCache not loaded',
            dashboard: () => window.dashboard || 'Dashboard not initialized',
            reload: () => location.reload(),
            clearCache: () => AdminCache ? AdminCache.clearAllCache() : 'AdminCache not available'
        };
        
        console.log('ğŸ”§ [Admin Dashboard] ë””ë²„ê·¸ í•¨ìˆ˜ ì‚¬ìš©ë²•:');
        console.log('  debugInfo.modules()  - ëª¨ë“ˆ ìƒíƒœ í™•ì¸');
        console.log('  debugInfo.cache()    - ìºì‹œ ìƒíƒœ í™•ì¸');
        console.log('  debugInfo.dashboard() - ëŒ€ì‹œë³´ë“œ ìƒíƒœ í™•ì¸');
        console.log('  debugInfo.clearCache() - ìºì‹œ ì´ˆê¸°í™”');
        console.log('  debugInfo.reload()   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
    </script>
</body>
</html>