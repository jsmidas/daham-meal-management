<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>다함 식단표 작성 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #F5881F 0%, #E67309 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            height: calc(100vh - 200px);
        }
        
        /* 좌측 레시피 검색 패널 */
        .recipe-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .recipe-panel h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background: #5a67d8;
        }
        
        .recipe-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .recipe-item {
            background: #f8fafc;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            cursor: grab;
            transition: all 0.3s ease;
            border-left: 4px solid #cbd5e0;
        }
        
        .recipe-item:hover {
            background: #edf2f7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left-color: #667eea;
        }
        
        .recipe-item.dragging {
            opacity: 0.7;
            transform: rotate(5deg);
        }
        
        .recipe-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
            color: #2d3748;
        }
        
        .recipe-score {
            font-size: 12px;
            color: #718096;
        }
        
        /* 우측 식단표 작성 패널 */
        .plan-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
        }
        
        .plan-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 12px;
            color: #4a5568;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-group input, .form-group select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .create-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            align-self: end;
        }
        
        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }
        
        /* 메뉴 섹션 */
        .menu-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            flex: 1;
        }
        
        .menu-section {
            border: 2px dashed #cbd5e0;
            border-radius: 15px;
            padding: 20px;
            min-height: 200px;
            background: #f8fafc;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .menu-section.drag-over {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
            border-style: solid;
        }
        
        .menu-section h4 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #4a5568;
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .menu-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
            position: relative;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .menu-item h5 {
            font-size: 14px;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .menu-item .cost {
            font-size: 12px;
            color: #718096;
        }
        
        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e53e3e;
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            transition: all 0.3s ease;
        }
        
        .remove-btn:hover {
            background: #c53030;
            transform: scale(1.1);
        }
        
        .empty-message {
            text-align: center;
            color: #a0aec0;
            font-style: italic;
            margin-top: 50px;
        }
        
        /* 하단 요약 정보 */
        .summary {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #F5881F 0%, #E67309 100%);
            color: white;
            border-radius: 12px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-item .value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-item .label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* 레시피 상세 모달 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .modal-header h2 {
            color: #2d3748;
            font-size: 24px;
            margin: 0;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover {
            color: #667eea;
        }
        
        .recipe-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
        }
        
        .detail-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .ingredient-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .ingredient-item-detail {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        /* 반응형 */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .plan-header {
                grid-template-columns: 1fr;
            }
            
            .menu-sections {
                grid-template-columns: 1fr;
            }
            
            .summary {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .recipe-detail-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>다함 식단표 작성 시스템</h1>
            <p>메뉴 블록을 조합하여 완성도 높은 식단표를 만들어보세요</p>
        </div>
        
        <div class="main-content">
            <!-- 좌측: 레시피 검색 패널 -->
            <div class="recipe-panel">
                <h3>레시피 검색</h3>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="레시피명을 입력하세요... (예: 찌개, 볶음)">
                    <button class="search-btn" onclick="searchRecipes()">검색</button>
                </div>
                <div class="recipe-list" id="recipeList">
                    <div class="empty-message">검색어를 입력해주세요</div>
                </div>
            </div>
            
            <!-- 우측: 식단표 작성 패널 -->
            <div class="plan-panel">
                <div class="plan-header">
                    <div class="form-group">
                        <label>카테고리</label>
                        <select id="categorySelect">
                            <option value="학교">학교</option>
                            <option value="도시락">도시락</option>
                            <option value="요양원">요양원</option>
                            <option value="운반">운반</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>날짜</label>
                        <input type="date" id="dateInput" value="2025-08-28">
                    </div>
                    <div class="form-group">
                        <label>식수 (명)</label>
                        <input type="number" id="personsInput" value="100" min="1">
                    </div>
                    <button class="create-btn" onclick="createDietPlan()">식단표 생성</button>
                </div>
                
                <div class="menu-sections">
                    <div class="menu-section" data-menu-type="중식A">
                        <h4>중식 A</h4>
                        <div class="menu-items" id="menu-중식A">
                            <div class="empty-message">메뉴를 드래그해서 추가하세요</div>
                        </div>
                    </div>
                    
                    <div class="menu-section" data-menu-type="중식B">
                        <h4>중식 B</h4>
                        <div class="menu-items" id="menu-중식B">
                            <div class="empty-message">메뉴를 드래그해서 추가하세요</div>
                        </div>
                    </div>
                    
                    <div class="menu-section" data-menu-type="석식">
                        <h4>석식</h4>
                        <div class="menu-items" id="menu-석식">
                            <div class="empty-message">메뉴를 드래그해서 추가하세요</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary">
                    <div class="summary-item">
                        <div class="value" id="totalItems">0</div>
                        <div class="label">총 메뉴 수</div>
                    </div>
                    <div class="summary-item">
                        <div class="value" id="totalCost">0원</div>
                        <div class="label">예상 총 비용</div>
                    </div>
                    <div class="summary-item">
                        <div class="value" id="costPerPerson">0원</div>
                        <div class="label">1인당 비용</div>
                    </div>
                    <div class="summary-item">
                        <div class="value" id="currentDate">-</div>
                        <div class="label">작성 날짜</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 레시피 상세 모달 -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalRecipeName">레시피 상세정보</h2>
                <span class="close" onclick="closeRecipeModal()">&times;</span>
            </div>
            <div class="recipe-detail-grid">
                <div class="detail-section">
                    <h3>기본 정보</h3>
                    <div id="recipeBasicInfo">
                        <p><strong>버전:</strong> <span id="recipeVersion">-</span></p>
                        <p><strong>평가점수:</strong> <span id="recipeScore">-</span>/5</p>
                        <p><strong>적용일:</strong> <span id="recipeEffectiveDate">-</span></p>
                        <p><strong>비고:</strong> <span id="recipeNotes">-</span></p>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>영양정보</h3>
                    <div id="nutritionInfo">
                        <p>영양정보를 불러오는 중...</p>
                    </div>
                </div>
            </div>
            <div class="detail-section">
                <h3>식자재 및 소요량 (1인량 기준)</h3>
                <div class="ingredient-list" id="ingredientsList">
                    <p>식자료를 불러오는 중...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDietPlanId = null;
        let menuData = {
            '중식A': [],
            '중식B': [], 
            '석식': []
        };

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            updateSummary();
            loadDefaultRecipes(); // 기본 메뉴들 로드
            
            // 검색 입력창에서 Enter 키 처리
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchRecipes();
                }
            });
        });

        // 레시피 검색
        async function searchRecipes() {
            const keyword = document.getElementById('searchInput').value.trim();
            const recipeList = document.getElementById('recipeList');
            
            if (!keyword) {
                // 검색어가 없으면 기본 메뉴들을 다시 로드
                loadDefaultRecipes();
                return;
            }
            
            try {
                recipeList.innerHTML = '<div class="empty-message">검색 중...</div>';
                
                const response = await fetch('/api/search_recipes', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({keyword: keyword, limit: 30})
                });
                
                const recipes = await response.json();
                
                if (recipes.length === 0) {
                    recipeList.innerHTML = '<div class="empty-message">검색 결과가 없습니다<br><button onclick="loadDefaultRecipes()" style="margin-top:10px; padding:8px 16px; background:#667eea; color:white; border:none; border-radius:6px; cursor:pointer;">전체 목록 보기</button></div>';
                    return;
                }
                
                const recipesHTML = `
                    <div style="text-align: center; font-weight: bold; color: #667eea; margin-bottom: 15px; padding: 10px; background: #f0f4ff; border-radius: 8px;">
                        "${keyword}" 검색 결과: ${recipes.length}개
                    </div>
                    ${recipes.map(recipe => `
                        <div class="recipe-item" draggable="true" data-recipe-id="${recipe.id}" data-recipe-name="${recipe.name}" onclick="showRecipeDetail(${recipe.id})">
                            <div class="recipe-name">${recipe.name}</div>
                            <div class="recipe-score">평점: ${recipe.score || 0}/5 | 버전: ${recipe.version}</div>
                        </div>
                    `).join('')}
                `;
                
                recipeList.innerHTML = recipesHTML;
                
                // 드래그 이벤트 추가
                addDragEvents();
                
            } catch (error) {
                console.error('검색 오류:', error);
                recipeList.innerHTML = '<div class="empty-message">검색 중 오류가 발생했습니다<br><button onclick="loadDefaultRecipes()" style="margin-top:10px; padding:8px 16px; background:#667eea; color:white; border:none; border-radius:6px; cursor:pointer;">전체 목록 보기</button></div>';
            }
        }

        // 드래그 & 드롭 이벤트 설정
        function addDragEvents() {
            // 레시피 아이템 드래그 시작
            document.querySelectorAll('.recipe-item').forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        id: this.dataset.recipeId,
                        name: this.dataset.recipeName
                    }));
                    this.classList.add('dragging');
                });
                
                item.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });
            
            // 메뉴 섹션 드롭 처리
            document.querySelectorAll('.menu-section').forEach(section => {
                section.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                
                section.addEventListener('dragleave', function(e) {
                    if (!this.contains(e.relatedTarget)) {
                        this.classList.remove('drag-over');
                    }
                });
                
                section.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    const recipeData = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const menuType = this.dataset.menuType;
                    
                    addRecipeToMenu(menuType, recipeData);
                });
            });
        }

        // 메뉴에 레시피 추가
        function addRecipeToMenu(menuType, recipeData) {
            const menuContainer = document.getElementById(`menu-${menuType}`);
            const emptyMessage = menuContainer.querySelector('.empty-message');
            
            // 중복 체크
            if (menuData[menuType].some(item => item.id == recipeData.id)) {
                alert('이미 추가된 메뉴입니다.');
                return;
            }
            
            // 빈 메시지 제거
            if (emptyMessage) {
                emptyMessage.remove();
            }
            
            // 메뉴 아이템 추가
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            menuItem.innerHTML = `
                <h5>${recipeData.name}</h5>
                <div class="cost">비용 계산 중...</div>
                <button class="remove-btn" onclick="removeMenuItem('${menuType}', ${recipeData.id})" title="제거">×</button>
            `;
            
            menuContainer.appendChild(menuItem);
            
            // 데이터 저장
            menuData[menuType].push({
                id: recipeData.id,
                name: recipeData.name,
                cost: 0 // 나중에 계산
            });
            
            updateSummary();
        }

        // 메뉴 아이템 제거
        function removeMenuItem(menuType, recipeId) {
            const menuContainer = document.getElementById(`menu-${menuType}`);
            const menuItems = menuContainer.querySelectorAll('.menu-item');
            
            // DOM에서 제거
            menuItems.forEach(item => {
                if (item.querySelector('h5').textContent === menuData[menuType].find(m => m.id == recipeId).name) {
                    item.remove();
                }
            });
            
            // 데이터에서 제거
            menuData[menuType] = menuData[menuType].filter(item => item.id != recipeId);
            
            // 빈 메시지 표시
            if (menuData[menuType].length === 0) {
                menuContainer.innerHTML = '<div class="empty-message">메뉴를 드래그해서 추가하세요</div>';
            }
            
            updateSummary();
        }

        // 요약 정보 업데이트
        function updateSummary() {
            const totalItems = Object.values(menuData).reduce((sum, menus) => sum + menus.length, 0);
            const totalCost = Object.values(menuData).reduce((sum, menus) => 
                sum + menus.reduce((menuSum, item) => menuSum + (item.cost || 0), 0), 0);
            const persons = parseInt(document.getElementById('personsInput').value) || 100;
            const costPerPerson = persons > 0 ? totalCost / persons : 0;
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalCost').textContent = `${totalCost.toLocaleString()}원`;
            document.getElementById('costPerPerson').textContent = `${Math.round(costPerPerson).toLocaleString()}원`;
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ko-KR');
        }

        // 식단표 생성
        async function createDietPlan() {
            const category = document.getElementById('categorySelect').value;
            const date = document.getElementById('dateInput').value;
            const persons = parseInt(document.getElementById('personsInput').value);
            
            if (!date || persons <= 0) {
                alert('날짜와 식수를 올바르게 입력해주세요.');
                return;
            }
            
            const totalItems = Object.values(menuData).reduce((sum, menus) => sum + menus.length, 0);
            if (totalItems === 0) {
                alert('최소 하나의 메뉴를 추가해주세요.');
                return;
            }
            
            try {
                const planData = {
                    category: category,
                    date: date,
                    description: `${category} ${date} 식단표`,
                    persons: persons,
                    menus: menuData
                };
                
                const response = await fetch('/api/create_diet_plan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(planData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`식단표가 생성되었습니다! (ID: ${result.diet_plan_id})`);
                    currentDietPlanId = result.diet_plan_id;
                } else {
                    alert('식단표 생성 중 오류가 발생했습니다.');
                }
                
            } catch (error) {
                console.error('생성 오류:', error);
                alert('식단표 생성 중 오류가 발생했습니다.');
            }
        }

        // 기본 메뉴들 로드 (페이지 로드 시)
        async function loadDefaultRecipes() {
            const recipeList = document.getElementById('recipeList');
            
            try {
                recipeList.innerHTML = '<div class="empty-message">메뉴 목록을 불러오는 중...</div>';
                
                const response = await fetch('/api/search_recipes', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({keyword: '', limit: 50}) // 빈 키워드로 전체 목록 요청
                });
                
                const recipes = await response.json();
                
                if (recipes.length === 0) {
                    recipeList.innerHTML = '<div class="empty-message">등록된 메뉴가 없습니다</div>';
                    return;
                }
                
                // 총 메뉴 수 표시
                const totalCount = recipes.length >= 50 ? '9,447개 메뉴 (상위 50개 표시)' : `${recipes.length}개 메뉴`;
                
                const recipesHTML = `
                    <div style="text-align: center; font-weight: bold; color: #667eea; margin-bottom: 15px; padding: 10px; background: #f0f4ff; border-radius: 8px;">
                        ${totalCount}
                    </div>
                    ${recipes.map(recipe => `
                        <div class="recipe-item" draggable="true" data-recipe-id="${recipe.id}" data-recipe-name="${recipe.name}" onclick="showRecipeDetail(${recipe.id})">
                            <div class="recipe-name">${recipe.name}</div>
                            <div class="recipe-score">평점: ${recipe.score || 0}/5 | 버전: ${recipe.version}</div>
                        </div>
                    `).join('')}
                `;
                
                recipeList.innerHTML = recipesHTML;
                
                // 드래그 이벤트 추가
                addDragEvents();
                
            } catch (error) {
                console.error('메뉴 로드 오류:', error);
                recipeList.innerHTML = '<div class="empty-message">메뉴를 불러오는데 실패했습니다</div>';
            }
        }

        // 레시피 상세정보 표시
        async function showRecipeDetail(recipeId) {
            const modal = document.getElementById('recipeModal');
            
            try {
                // 모달 열기
                modal.style.display = 'block';
                
                // 기본 정보 초기화
                document.getElementById('modalRecipeName').textContent = '레시피 정보 로딩중...';
                document.getElementById('recipeVersion').textContent = '-';
                document.getElementById('recipeScore').textContent = '-';
                document.getElementById('recipeEffectiveDate').textContent = '-';
                document.getElementById('recipeNotes').textContent = '-';
                document.getElementById('nutritionInfo').innerHTML = '<p>영양정보를 불러오는 중...</p>';
                document.getElementById('ingredientsList').innerHTML = '<p>식자재를 불러오는 중...</p>';
                
                // API 호출
                const response = await fetch(`/api/recipe/${recipeId}`);
                const recipe = await response.json();
                
                // 기본 정보 업데이트
                document.getElementById('modalRecipeName').textContent = recipe.name;
                document.getElementById('recipeVersion').textContent = recipe.version;
                document.getElementById('recipeScore').textContent = recipe.evaluation_score;
                document.getElementById('recipeEffectiveDate').textContent = recipe.effective_date;
                document.getElementById('recipeNotes').textContent = recipe.notes;
                
                // 영양정보 표시
                displayNutritionInfo(recipe.nutrition_data);
                
                // 식자재 목록 표시
                displayIngredients(recipe.ingredients, recipe.total_cost_per_person);
                
            } catch (error) {
                console.error('레시피 상세 조회 오류:', error);
                document.getElementById('modalRecipeName').textContent = '오류가 발생했습니다';
                document.getElementById('nutritionInfo').innerHTML = '<p style="color: red;">정보를 불러올 수 없습니다.</p>';
                document.getElementById('ingredientsList').innerHTML = '<p style="color: red;">정보를 불러올 수 없습니다.</p>';
            }
        }

        // 영양정보 표시
        function displayNutritionInfo(nutritionData) {
            const nutritionInfo = document.getElementById('nutritionInfo');
            
            if (!nutritionData || Object.keys(nutritionData).length === 0) {
                nutritionInfo.innerHTML = '<p>등록된 영양정보가 없습니다.</p>';
                return;
            }
            
            let nutritionHTML = '';
            for (const [key, value] of Object.entries(nutritionData)) {
                nutritionHTML += `<p><strong>${key}:</strong> ${value}</p>`;
            }
            
            nutritionInfo.innerHTML = nutritionHTML || '<p>영양정보 형식 오류</p>';
        }

        // 식자재 목록 표시
        function displayIngredients(ingredients, totalCost) {
            const ingredientsList = document.getElementById('ingredientsList');
            
            if (!ingredients || ingredients.length === 0) {
                ingredientsList.innerHTML = '<p>등록된 식자재가 없습니다.</p>';
                return;
            }
            
            let ingredientsHTML = `
                <div style="text-align: center; font-weight: bold; color: #667eea; margin-bottom: 15px; padding: 10px; background: #f0f4ff; border-radius: 8px;">
                    총 ${ingredients.length}개 식자재 | 1인당 예상비용: ${totalCost}원
                </div>
            `;
            
            ingredients.forEach(ingredient => {
                ingredientsHTML += `
                    <div class="ingredient-item-detail">
                        <div><strong>${ingredient.name}</strong></div>
                        <div>${ingredient.quantity} ${ingredient.unit}</div>
                        <div>${ingredient.cost_per_person}원</div>
                    </div>
                `;
            });
            
            ingredientsList.innerHTML = ingredientsHTML;
        }

        // 모달 닫기
        function closeRecipeModal() {
            document.getElementById('recipeModal').style.display = 'none';
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('recipeModal');
            if (event.target === modal) {
                closeRecipeModal();
            }
        }
    </script>
</body>
</html>