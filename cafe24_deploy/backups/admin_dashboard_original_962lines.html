<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ì‹ìì¬ ê´€ë¦¬ ì‹œìŠ¤í…œ - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    
    <!-- ì™¸ë¶€ CSS -->
    <link rel="stylesheet" href="static/css/admin-dashboard-main.css">

    <!-- ì‚¬ìš©ì ê´€ë¦¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ -->
    <style>
        /* ì‚¬ìš©ì ê´€ë¦¬ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .user-info {
            line-height: 1.4;
        }

        .role-badge {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }

        .role-badge.admin {
            background: #ff4444;
            color: white;
        }

        .role-badge.nutritionist {
            background: #44b8ff;
            color: white;
        }

        .role-badge.operator {
            background: #ffaa44;
            color: white;
        }

        .role-badge.viewer {
            background: #aaaaaa;
            color: white;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }

        .status-badge.active {
            background: #44ff44;
            color: #006600;
        }

        .status-badge.inactive {
            background: #ffcccc;
            color: #cc0000;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 2px;
        }

        .btn-icon:hover {
            transform: scale(1.2);
        }

        .btn-danger {
            color: #ff0000;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .pagination button {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        .pagination button.active {
            background: #667eea;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .alert {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>

    <!-- ê°„ë‹¨í•œ ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ëª¨ë“ˆ ë¡œë” ëŒ€ì‹  ê°„ë‹¨í•œ ì´ˆê¸°í™”
        const API_BASE = 'http://127.0.0.1:8009';
        console.log('Admin Dashboard ì‹œì‘');
    </script>
</head>
<body>
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="admin-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ½ï¸ ì‹ìì¬ ê´€ë¦¬</h2>
                <p>ê´€ë¦¬ì ì‹œìŠ¤í…œ</p>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="icon">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <span class="icon">ğŸ‘¥</span>ì‚¬ìš©ì ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="suppliers">
                    <span class="icon">ğŸš›</span>í˜‘ë ¥ì—…ì²´ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="business-locations">
                    <span class="icon">ğŸ¢</span>ì‚¬ì—…ì¥ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="supplier-mapping">
                    <span class="icon">ğŸ”—</span>í˜‘ë ¥ì—…ì²´ ë§¤ì¹­
                </a>
                <a href="#" class="nav-item" data-page="meal-pricing">
                    <span class="icon">ğŸ’°</span>ì‹ë‹¨ê°€ ê´€ë¦¬
                </a>
                <a href="#" class="nav-item" data-page="ingredients">
                    <span class="icon">ğŸ“¦</span>ì‹ìì¬ ê´€ë¦¬
                </a>
            </div>
            
            <div class="sidebar-footer" style="margin-top: auto; padding: 20px;">
                <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px;">
                    <a href="/" class="nav-item" style="background: #e8f5e8; color: #4caf50;">
                        <span class="icon">ğŸ½ï¸</span>ê¸‰ì‹ê´€ë¦¬ë¡œ ì´ë™
                    </a>
                </div>
            </div>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <div class="header">
                <h1 id="page-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                <div class="header-info">
                    <div class="user-info">
                        ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”! | ì˜¤ëŠ˜: <span id="current-date"></span>
                    </div>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <!-- í˜ì´ì§€ë³„ ì»¨í…ì¸  ì˜ì—­ -->
            <div id="content-area">
                <!-- ëŒ€ì‹œë³´ë“œ ê¸°ë³¸ ì»¨í…ì¸  -->
                <div id="dashboard-content" class="page-content active">
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸ‘¥</span>
                                <h3 class="card-title">ì „ì²´ ì‚¬ìš©ì</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-users">-</div>
                                <div class="stat-label">ë“±ë¡ëœ ì‚¬ìš©ì ìˆ˜</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸ¢</span>
                                <h3 class="card-title">ì‚¬ì—…ì¥</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-sites">-</div>
                                <div class="stat-label">ê´€ë¦¬ ì¤‘ì¸ ì‚¬ì—…ì¥</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸ“¦</span>
                                <h3 class="card-title">ì‹ìì¬</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-ingredients">-</div>
                                <div class="stat-label">ë“±ë¡ëœ ì‹ìì¬</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="icon">ğŸš›</span>
                                <h3 class="card-title">í˜‘ë ¥ì—…ì²´</h3>
                            </div>
                            <div class="card-content">
                                <div class="stat-number" id="total-suppliers">-</div>
                                <div class="stat-label">ë“±ë¡ëœ í˜‘ë ¥ì—…ì²´</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìµœê·¼ í™œë™ ë¡œê·¸ -->
                    <div class="activity-log">
                        <h3 style="margin-bottom: 20px;">ğŸ“ˆ ìµœê·¼ í™œë™</h3>
                        <div id="activity-list">
                            <div class="log-item">
                                <div class="log-time">ë¡œë”© ì¤‘...</div>
                                <div class="log-message">ì‹œìŠ¤í…œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë‹¤ë¥¸ í˜ì´ì§€ ì»¨í…ì¸ ë“¤ì€ ë™ì ìœ¼ë¡œ ë¡œë“œ -->
                <div id="users-content" class="page-content">
                    <!-- ì‚¬ìš©ì ê´€ë¦¬ ì»¨í…ì¸  -->
                    <div class="user-management-container">
                        <!-- í†µê³„ ì¹´ë“œ -->
                        <div class="dashboard-grid" id="userStatsGrid">
                            <div class="dashboard-card user-stat-card">
                                <div class="card-header">
                                    <span class="icon">ğŸ‘¥</span>
                                    <span class="card-title">ì „ì²´ ì‚¬ìš©ì</span>
                                </div>
                                <div class="stat-number" id="totalUsers">-</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="dashboard-card user-stat-card">
                                <div class="card-header">
                                    <span class="icon">âœ…</span>
                                    <span class="card-title">í™œì„± ì‚¬ìš©ì</span>
                                </div>
                                <div class="stat-number" id="activeUsers">-</div>
                                <div class="stat-label">Active Users</div>
                            </div>
                            <div class="dashboard-card user-stat-card">
                                <div class="card-header">
                                    <span class="icon">â¸ï¸</span>
                                    <span class="card-title">ë¹„í™œì„± ì‚¬ìš©ì</span>
                                </div>
                                <div class="stat-number" id="inactiveUsers">-</div>
                                <div class="stat-label">Inactive Users</div>
                            </div>
                            <div class="dashboard-card user-stat-card">
                                <div class="card-header">
                                    <span class="icon">ğŸ‘¤</span>
                                    <span class="card-title">ê´€ë¦¬ì</span>
                                </div>
                                <div class="stat-number" id="adminUsers">-</div>
                                <div class="stat-label">Admin Users</div>
                            </div>
                        </div>

                        <!-- ê²€ìƒ‰ ë° í•„í„° ì»¨íŠ¸ë¡¤ -->
                        <div class="controls">
                            <div class="search-container">
                                <input type="text" id="searchInput" placeholder="ì‚¬ìš©ìëª…, ì—°ë½ì²˜, ë¶€ì„œë¡œ ê²€ìƒ‰...">
                            </div>
                            <div class="filter-container">
                                <select id="roleFilter">
                                    <option value="">ëª¨ë“  ê¶Œí•œ</option>
                                    <option value="admin">ê´€ë¦¬ì</option>
                                    <option value="nutritionist">ì˜ì–‘ì‚¬</option>
                                    <option value="operator">ìš´ì˜ì</option>
                                    <option value="viewer">ì¡°íšŒì</option>
                                </select>
                                <button class="btn btn-primary" onclick="UsersManagementFull.loadUsers(1)">ê²€ìƒ‰</button>
                                <button class="btn btn-success" onclick="UsersManagementFull.showAddUserModal()">ì‚¬ìš©ì ì¶”ê°€</button>
                            </div>
                        </div>

                        <!-- ë²Œí¬ ì•¡ì…˜ -->
                        <div id="bulkActions" style="display: none; margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                            <span>ì„ íƒëœ ì‚¬ìš©ì: <strong id="selectedCount">0</strong>ëª…</span>
                            <button class="btn btn-danger" onclick="UsersManagementFull.bulkDelete()" style="margin-left: 10px;">ì„ íƒ ì‚­ì œ</button>
                        </div>

                        <!-- ì‚¬ìš©ì í…Œì´ë¸” -->
                        <div class="table-container">
                            <div id="loadingIndicator" class="loading" style="display: none;">
                                <p>ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>

                            <table id="usersTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAll"></th>
                                        <th>ID</th>
                                        <th>ì‚¬ìš©ìëª…</th>
                                        <th>ê¶Œí•œ</th>
                                        <th>ë¶€ì„œ</th>
                                        <th>ì—°ë½ì²˜</th>
                                        <th>ë“±ë¡ì¼</th>
                                        <th>ìƒíƒœ</th>
                                        <th>ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                                </tbody>
                            </table>

                            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                            <div id="pagination" class="pagination" style="margin-top: 20px; text-align: center;">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                            </div>

                            <div id="emptyState" class="empty-state" style="display: none;">
                                <h3>ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                            </div>
                        </div>

                        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                        <div class="pagination" id="pagination">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>

                        <!-- ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
                        <div id="alertContainer"></div>
                    </div>
                </div>

                <!-- ì‚¬ìš©ì ëª¨ë‹¬ì€ ë™ì ìœ¼ë¡œ ë¡œë“œë¨ (user-modal.html) -->
                <div id="userModalContainer"></div>
                
                <div id="suppliers-content" class="page-content">
                    <!-- í˜‘ë ¥ì—…ì²´ ê´€ë¦¬ -->
                    <div class="content-header">
                        <h2>í˜‘ë ¥ì—…ì²´ ê´€ë¦¬</h2>
                        <button class="btn btn-primary" onclick="SuppliersManagementFull.showAddSupplierModal()">
                            <span>â•</span> ìƒˆ í˜‘ë ¥ì—…ì²´ ì¶”ê°€
                        </button>
                    </div>

                    <!-- í†µê³„ ì¹´ë“œ -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalSuppliers">0</div>
                            <div class="stat-label">ì „ì²´ í˜‘ë ¥ì—…ì²´</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="activeSuppliers">0</div>
                            <div class="stat-label">í™œì„± í˜‘ë ¥ì—…ì²´</div>
                        </div>
                    </div>

                    <!-- ê²€ìƒ‰ ë° í•„í„° -->
                    <div class="search-filter-container">
                        <div class="search-box">
                            <input type="text" id="supplierSearchInput" placeholder="í˜‘ë ¥ì—…ì²´ëª… ë˜ëŠ” ì½”ë“œë¡œ ê²€ìƒ‰...">
                            <button onclick="SuppliersManagementFull.loadSuppliers(1)">ê²€ìƒ‰</button>
                        </div>
                    </div>

                    <!-- ë²Œí¬ ì•¡ì…˜ -->
                    <div id="supplierBulkActions" class="bulk-actions" style="display: none;">
                        <span>ì„ íƒëœ í•­ëª©: <strong id="supplierSelectedCount">0</strong>ê°œ</span>
                        <button class="btn btn-danger" onclick="SuppliersManagementFull.bulkDelete()">
                            ì¼ê´„ ì‚­ì œ
                        </button>
                    </div>

                    <!-- í˜‘ë ¥ì—…ì²´ í…Œì´ë¸” -->
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllSuppliers"></th>
                                    <th>ID</th>
                                    <th>ì—…ì²´ëª…</th>
                                    <th>ì—…ì¢…</th>
                                    <th>ëŒ€í‘œì</th>
                                    <th>ì—°ë½ì²˜</th>
                                    <th>ì´ë©”ì¼</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="suppliersTableBody">
                                <tr>
                                    <td colspan="9" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                    <div id="suppliersPagination" class="pagination"></div>
                </div>
                
                <div id="business-locations-content" class="page-content">
                    <div class="content-header">
                        <h1>ì‚¬ì—…ì¥ ê´€ë¦¬</h1>
                        <button class="btn btn-primary" onclick="showAddSiteModal()">
                            <span>+ ìƒˆ ì‚¬ì—…ì¥ ì¶”ê°€</span>
                        </button>
                    </div>

                    <!-- ì‚¬ì—…ì¥ í†µê³„ ì¹´ë“œ -->
                    <div class="dashboard-grid" id="siteStatsGrid">
                        <div class="dashboard-card site-stat-card">
                            <div class="card-header">
                                <span class="icon">ğŸ¢</span>
                                <span class="card-title">ì „ì²´ ì‚¬ì—…ì¥</span>
                            </div>
                            <div class="stat-number" id="totalSites">4</div>
                            <div class="stat-label">Total Sites</div>
                        </div>

                        <div class="dashboard-card site-stat-card">
                            <div class="card-header">
                                <span class="icon">ğŸ±</span>
                                <span class="card-title">ë„ì‹œë½</span>
                            </div>
                            <div class="stat-number" id="lunchboxSites">1</div>
                            <div class="stat-label">Lunchbox Delivery</div>
                        </div>

                        <div class="dashboard-card site-stat-card">
                            <div class="card-header">
                                <span class="icon">ğŸšš</span>
                                <span class="card-title">ìš´ë°˜</span>
                            </div>
                            <div class="stat-number" id="transportSites">1</div>
                            <div class="stat-label">Transport Service</div>
                        </div>

                        <div class="dashboard-card site-stat-card">
                            <div class="card-header">
                                <span class="icon">ğŸ«</span>
                                <span class="card-title">í•™êµ</span>
                            </div>
                            <div class="stat-number" id="schoolSites">1</div>
                            <div class="stat-label">School Cafeteria</div>
                        </div>

                        <div class="dashboard-card site-stat-card">
                            <div class="card-header">
                                <span class="icon">ğŸ¥</span>
                                <span class="card-title">ìš”ì–‘ì›</span>
                            </div>
                            <div class="stat-number" id="nursingHomeSites">1</div>
                            <div class="stat-label">Nursing Home</div>
                        </div>
                    </div>

                    <!-- ì‚¬ì—…ì¥ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
                    <div class="table-container" style="margin-top: 30px;">
                        <div class="table-header">
                            <h2>ì‚¬ì—…ì¥ ëª©ë¡</h2>
                            <div class="filter-controls">
                                <select id="siteTypeFilter" onchange="filterSitesByType()">
                                    <option value="">ì „ì²´ ì‚¬ì—…ì¥</option>
                                    <option value="ë„ì‹œë½">ë„ì‹œë½</option>
                                    <option value="ìš´ë°˜">ìš´ë°˜</option>
                                    <option value="í•™êµ">í•™êµ</option>
                                    <option value="ìš”ì–‘ì›">ìš”ì–‘ì›</option>
                                </select>
                                <input type="text" id="siteSearchInput" placeholder="ì‚¬ì—…ì¥ ê²€ìƒ‰..." onkeyup="searchSites()">
                            </div>
                        </div>

                        <table id="sitesTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllSites"></th>
                                    <th>ID</th>
                                    <th>ì‚¬ì—…ì¥ëª…</th>
                                    <th>êµ¬ë¶„</th>
                                    <th>ì§€ì—­</th>
                                    <th>ë‹´ë‹¹ì</th>
                                    <th>ì—°ë½ì²˜</th>
                                    <th>ê¸‰ì‹ì¸ì›</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="sitesTableBody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                            </tbody>
                        </table>

                        <div id="sitesEmptyState" class="empty-state" style="display: none;">
                            <h3>ë“±ë¡ëœ ì‚¬ì—…ì¥ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>ìƒˆë¡œìš´ ì‚¬ì—…ì¥ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                        </div>

                        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                        <div class="pagination" id="sitesPagination">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>

                <div id="supplier-mapping-content" class="page-content" style="display: none;">
                    <!-- í˜‘ë ¥ì—…ì²´ ë§¤ì¹­ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>

                <div id="meal-pricing-content" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>ì‹ë‹¨ê°€ ê´€ë¦¬</h2>
                        <p class="page-description">ì‚¬ì—…ì¥ë³„ ì„¸ë¶€ì‹ë‹¨í‘œë¥¼ ê´€ë¦¬í•˜ê³  ë¼ë‹ˆë³„ íŒë§¤ê°€, ëª©í‘œì‹ì¬ë£Œë¹„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </div>

                    <!-- í†µê³„ ì¹´ë“œ (ì»´íŒ©íŠ¸) -->
                    <div class="stats-container" style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div class="stat-box" style="background: white; padding: 10px 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); min-width: 140px;">
                            <div style="font-size: 20px; font-weight: bold; color: #007bff;" id="total-meal-plans-count">-</div>
                            <div style="font-size: 12px; color: #666;">ì „ì²´ ì‹ë‹¨í‘œ</div>
                            <div style="font-size: 11px; color: #888;" id="active-meal-plans-text">í™œì„±: 0ê°œ</div>
                        </div>
                        <div class="stat-box" style="background: white; padding: 10px 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); min-width: 140px;">
                            <div style="font-size: 20px; font-weight: bold; color: #28a745;" id="locations-with-pricing-count">-</div>
                            <div style="font-size: 12px; color: #666;">ìš´ì˜ ì‚¬ì—…ì¥</div>
                        </div>
                        <div class="stat-box" style="background: white; padding: 10px 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); min-width: 140px;">
                            <div style="font-size: 20px; font-weight: bold; color: #17a2b8;" id="average-selling-price">-</div>
                            <div style="font-size: 12px; color: #666;">í‰ê·  íŒë§¤ê°€</div>
                        </div>
                        <div class="stat-box" style="background: white; padding: 10px 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); min-width: 140px;">
                            <div style="font-size: 20px; font-weight: bold; color: #ffc107;" id="average-cost-ratio">-</div>
                            <div style="font-size: 12px; color: #666;">í‰ê·  ì›ê°€ìœ¨</div>
                        </div>
                    </div>

                    <!-- ì‚¬ì—…ì¥ ì„ íƒ -->
                    <div class="filter-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px;">
                        <div class="filter-group" style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #333;">ì‚¬ì—…ì¥ ì„ íƒ:</label>
                            <select id="businessLocationSelect" class="form-control" style="width: 300px; padding: 8px 12px; font-size: 14px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="action-group" style="display: flex; gap: 10px;">
                            <button id="addMealPlanBtn" class="btn btn-primary" onclick="addNewMealPlan()" style="display: none; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; font-size: 14px; cursor: pointer;">
                                <i class="fas fa-plus"></i> ìƒˆ ì‹ë‹¨í‘œ ì¶”ê°€
                            </button>
                            <button id="saveMealPricingBtn" class="btn btn-success" onclick="saveMealPricing()" style="display: none; padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 14px; cursor: pointer;">
                                <i class="fas fa-save"></i> ì €ì¥
                            </button>
                        </div>
                    </div>

                    <!-- ì‹ë‹¨í‘œ ëª©ë¡ -->
                    <div id="mealPlansContainer" class="table-container">
                        <p style="color: #888; text-align: center; padding: 40px;">ì‚¬ì—…ì¥ì„ ì„ íƒí•˜ë©´ ì„¸ë¶€ì‹ë‹¨í‘œ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <div id="ingredients-content" class="page-content" style="display: none;">
                    <!-- ì‹ìì¬ ê´€ë¦¬ ëª¨ë“ˆì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </main>
    </div>

    <!-- ğŸš€ ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ì˜ì¡´ì„± ìë™ ê´€ë¦¬) -->
    <script>
        // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ í—¬í¼ í•¨ìˆ˜
        // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ í—¬í¼ í•¨ìˆ˜
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // ê°œì„ ëœ ModuleLoader ê¸°ë°˜ ì´ˆê¸°í™” (ì•ˆì „ì„± + ë‹¨ìˆœì„±)
        async function initializePage() {
            console.log('ğŸš€ [Admin Dashboard] ê°œì„ ëœ ì´ˆê¸°í™” ì‹œì‘');

            try {
                // âš¡ Phase 1: í•„ìˆ˜ ëª¨ë“ˆ ìˆœì°¨ ë¡œë“œ
                console.log('ğŸ“¦ [Admin Dashboard] í•„ìˆ˜ ëª¨ë“ˆ ë¡œë“œ ì¤‘...');

                // config.js ë¨¼ì € ë¡œë“œ
                if (!window.CONFIG) {
                    console.log('ğŸ”§ config.js ë¡œë”©...');
                    await loadScript('config.js');

                    let attempts = 0;
                    while (!window.CONFIG && attempts < 20) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }

                    if (!window.CONFIG) {
                        throw new Error('config.js ë¡œë“œ ì‹¤íŒ¨');
                    }
                    console.log('âœ… CONFIG ë¡œë“œ ì™„ë£Œ');
                }

                // âš¡ ModuleLoaderëŠ” ì„ íƒì‚¬í•­ - ì§ì ‘ ëª¨ë“ˆ ë¡œë”©ìœ¼ë¡œ ëŒ€ì²´
                console.log('ğŸ”„ ê°„ì†Œí™”ëœ ëª¨ë“œë¡œ ì‘ë™ - ModuleLoader ìƒëµ');
                window.moduleLoader = null;

                // âš¡ Phase 2: ë‚ ì§œ í‘œì‹œ ë“± ê¸°ë³¸ UI
                const currentDateElement = document.getElementById('current-date');
                if (currentDateElement) {
                    currentDateElement.textContent = new Date().toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'short'
                    });
                }

                console.log('âœ… [Admin Dashboard] ê°œì„ ëœ ì´ˆê¸°í™” ì™„ë£Œ');

            } catch (error) {
                console.error('âŒ [Admin Dashboard] ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showInitializationError(error);
            }
        }
        
        /**
         * ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í‘œì‹œ
         */
        function showInitializationError(error) {
            const contentArea = document.getElementById('content-area');
            if (contentArea) {
                contentArea.innerHTML = `
                    <div style="padding: 40px; text-align: center; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #ff6b6b;">âš ï¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨</h2>
                        <p style="color: #666; margin: 20px 0;">ê´€ë¦¬ì ì‹œìŠ¤í…œì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; font-family: monospace; font-size: 12px; color: #333; text-align: left;">
                            ${error.message || error.toString()}
                        </div>
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                            ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button onclick="ModuleLoader.getModuleStatus()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ” ëª¨ë“ˆ ìƒíƒœ í™•ì¸
                        </button>
                    </div>
                `;
            }
        }
        
        /**
         * ì•ˆì „í•œ ë¡œê·¸ì•„ì›ƒ (ì˜ì¡´ì„± í™•ì¸ í›„ ì‹¤í–‰)
         */
        async function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ìºì‹œ ì •ë¦¬
                    if (window.AdminCache) {
                        AdminCache.clearAllCache();
                        console.log('ğŸ—‘ï¸ [Logout] ìºì‹œ ì •ë¦¬ ì™„ë£Œ');
                    }
                    
                    // ëŒ€ì‹œë³´ë“œ ì •ë¦¬
                    if (window.dashboard && typeof window.dashboard.destroy === 'function') {
                        window.dashboard.destroy();
                        console.log('ğŸ§¹ [Logout] ëŒ€ì‹œë³´ë“œ ì •ë¦¬ ì™„ë£Œ');
                    }
                    
                    // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    console.log('ğŸšª [Logout] ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                    window.location.href = '/';
                    
                } catch (error) {
                    console.error('âŒ [Logout] ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ë¡œê·¸ì•„ì›ƒ ì§„í–‰
                    window.location.href = '/';
                }
            }
        }
        
        /**
         * ê°œë°œììš© ë””ë²„ê·¸ í•¨ìˆ˜ë“¤ (ì½˜ì†”ì—ì„œ ì‚¬ìš©)
         */
        window.debugInfo = {
            modules: () => ModuleLoader.getModuleStatus(),
            cache: () => AdminCache ? AdminCache.getCacheStatus() : 'AdminCache not loaded',
            dashboard: () => window.dashboard || 'Dashboard not initialized',
            reload: () => location.reload(),
            clearCache: () => AdminCache ? AdminCache.clearAllCache() : 'AdminCache not available'
        };
        
        console.log('ğŸ”§ [Admin Dashboard] ë””ë²„ê·¸ í•¨ìˆ˜ ì‚¬ìš©ë²•:');
        console.log('  debugInfo.modules()  - ëª¨ë“ˆ ìƒíƒœ í™•ì¸');
        console.log('  debugInfo.cache()    - ìºì‹œ ìƒíƒœ í™•ì¸');
        console.log('  debugInfo.dashboard() - ëŒ€ì‹œë³´ë“œ ìƒíƒœ í™•ì¸');
        console.log('  debugInfo.clearCache() - ìºì‹œ ì´ˆê¸°í™”');
        console.log('  debugInfo.reload()   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
    </script>

    <!-- CONFIG ì„¤ì • -->
    <script src="config.js"></script>

    <!-- ëª¨ë“ˆ ë¡œë“œ -->
    <script src="static/modules/users/users-complete.js"></script>
    <script src="static/modules/sites/sites-complete.js"></script>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
        function setupNavigation() {
            console.log('ğŸ§­ ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ì¤‘...');

            document.querySelectorAll('.nav-item').forEach(navItem => {
                navItem.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('data-page');
                    switchToPage(targetPage);
                });
            });

            // ê¸°ë³¸ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œ í™œì„±í™”
            switchToPage('dashboard');

            // ì´ˆê¸° ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ
            fetch('http://127.0.0.1:8010/api/admin/dashboard-stats')
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const els = {
                            'total-users': data.totalUsers,
                            'total-sites': data.totalSites,
                            'total-ingredients': (data.totalIngredients || 0).toLocaleString(),
                            'total-suppliers': data.totalSuppliers
                        };
                        for (const [id, value] of Object.entries(els)) {
                            const el = document.getElementById(id);
                            if (el) el.textContent = value;
                        }
                    }
                })
                .catch(err => console.error('ì´ˆê¸° ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', err));
        }

        async function switchToPage(pageName) {
            console.log(`ğŸ”„ í˜ì´ì§€ ì „í™˜: ${pageName}`);

            // ë„¤ë¹„ê²Œì´ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const activeNavItem = document.querySelector(`[data-page="${pageName}"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }

            // ëª¨ë“  í˜ì´ì§€ ì½˜í…ì¸  ìˆ¨ê¸°ê¸° - display ì§ì ‘ ì œì–´
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            // ì„ íƒëœ í˜ì´ì§€ë§Œ í‘œì‹œ - display ì§ì ‘ ì œì–´
            const targetContent = document.getElementById(`${pageName}-content`);
            if (targetContent) {
                targetContent.classList.add('active');
                targetContent.style.display = 'block';
                console.log(`âœ… ${pageName} ì½˜í…ì¸  í‘œì‹œ ì™„ë£Œ`);

                // ëª¨ë“ˆ ì´ˆê¸°í™” (ModuleLoader ì„ í˜¸, í´ë°± ì§€ì›)
                await initializePageModule(pageName);
            } else {
                console.error(`âŒ ${pageName}-content ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
            }
        }

        // í˜ì´ì§€ë³„ ëª¨ë“ˆ ì´ˆê¸°í™” (ModuleLoader ìš°ì„ , í´ë°± ì§€ì›)
        async function initializePageModule(pageName) {
            // ëŒ€ì‹œë³´ë“œëŠ” ëª¨ë“ˆ ì´ˆê¸°í™” ë¶ˆí•„ìš”
            if (pageName === 'dashboard') {
                console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ - ëª¨ë“ˆ ì´ˆê¸°í™” ë¶ˆí•„ìš”');
                // ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ
                fetch('http://127.0.0.1:8010/api/admin/dashboard-stats')
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            const els = {
                                'total-users': data.totalUsers,
                                'total-sites': data.totalSites,
                                'total-ingredients': (data.totalIngredients || 0).toLocaleString(),
                                'total-suppliers': data.totalSuppliers
                            };
                            for (const [id, value] of Object.entries(els)) {
                                const el = document.getElementById(id);
                                if (el) el.textContent = value;
                            }
                        }
                    })
                    .catch(err => console.error('ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', err));
                return;
            }

            const fallbackInitialization = {
                'users': async () => {
                    if (!window.UsersManagementFull) {
                        await loadScript('static/modules/users/users-management-full.js');
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    return window.UsersManagementFull?.init?.();
                },
                'suppliers': async () => {
                    if (!window.SupplierManagement) {
                        await loadScript('static/modules/suppliers/suppliers.js');
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    return window.SupplierManagement?.init?.();
                },
                'business-locations': async () => {
                    if (!window.BusinessLocationsModule) {
                        await loadScript('static/modules/sites/sites.js');
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    return window.BusinessLocationsModule?.init?.();
                },
                'business-locations-old': async () => {
                    if (!window.SitesModule) {
                        await loadScript('static/modules/sites/sites-complete.js');
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    return window.SitesModule?.init?.();
                },
                'meal-pricing': async () => {
                    console.log('ğŸ¯ meal-pricing ëª¨ë“ˆ ì´ˆê¸°í™” ì‹œì‘');
                    // Meal Pricing ëª¨ë“ˆ ë¡œë“œ (ìš´ì˜íƒ€ì…/ê³„íšëª… ì§ì ‘ ìˆ˜ì • ë²„ì „)
                    const timestamp = new Date().getTime();
                    await loadScript(`static/modules/meal-pricing/meal-pricing.js?v=${timestamp}`);
                    await new Promise(resolve => setTimeout(resolve, 100));

                    if (window.MealPricingModule) {
                        console.log('ğŸš€ MealPricingModule.init í˜¸ì¶œ');
                        await window.MealPricingModule.init();
                        // ì‚¬ì—…ì¥ ì„ íƒ ì´ë²¤íŠ¸ ì¶”ê°€
                        const select = document.getElementById('businessLocationSelect');
                        if (select) {
                            select.addEventListener('change', window.loadMealPlansForLocation);
                        }
                    } else {
                        console.error('âŒ MealPricingModuleì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    }
                },
                'ingredients': async () => {
                    if (!window.IngredientManagement) {
                        await loadScript('static/modules/ingredients/ingredients.js');
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    return window.IngredientManagement?.init?.();
                },
                'supplier-mapping': async () => {
                    // ê°œì„ ëœ ë§¤í•‘ ëª¨ë“ˆ ì‚¬ìš©
                    if (!window.initEnhancedMapping) {
                        await loadScript('static/modules/mappings/enhanced-mapping.js');
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }

                    // ê°œì„ ëœ ë§¤í•‘ ì´ˆê¸°í™”
                    if (window.initEnhancedMapping) {
                        await window.initEnhancedMapping();
                    }
                }
            };

            // ModuleLoader ë¨¼ì € ì‹œë„
            if (window.moduleLoader) {
                try {
                    console.log(`ğŸ“¦ [ModuleLoader] ${pageName} ëª¨ë“ˆ ë¡œë“œ ì¤‘...`);
                    const moduleObject = await window.moduleLoader.loadModule(pageName);

                    if (moduleObject && typeof moduleObject.init === 'function') {
                        console.log(`ğŸ¯ [ModuleLoader] ${pageName} ëª¨ë“ˆ ì´ˆê¸°í™” ì¤‘...`);
                        await moduleObject.init();
                        console.log(`âœ… [ModuleLoader] ${pageName} ëª¨ë“ˆ ì´ˆê¸°í™” ì™„ë£Œ`);
                        return;
                    }
                } catch (error) {
                    console.warn(`âš ï¸ [ModuleLoader] ${pageName} ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:`, error);
                }
            }

            // í´ë°±: ì§ì ‘ ëª¨ë“ˆ ë¡œë”©
            console.log(`ğŸ”„ [Fallback] ì§ì ‘ ${pageName} ëª¨ë“ˆ ë¡œë“œ ì¤‘...`);
            if (fallbackInitialization[pageName]) {
                try {
                    await fallbackInitialization[pageName]();
                    console.log(`âœ… [Fallback] ${pageName} ëª¨ë“ˆ ì´ˆê¸°í™” ì™„ë£Œ`);
                } catch (fallbackError) {
                    console.error(`âŒ [Fallback] ${pageName} ëª¨ë“ˆ ì´ˆê¸°í™” ì‹¤íŒ¨:`, fallbackError);
                }
            } else {
                console.warn(`âš ï¸ ${pageName} í˜ì´ì§€ì— ëŒ€í•œ ëª¨ë“ˆì´ ì •ì˜ë˜ì§€ ì•ŠìŒ`);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í†µí•© ì´ˆê¸°í™” (ë‹¨ì¼ DOMContentLoaded ì´ë²¤íŠ¸)
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ¯ [Admin Dashboard] í†µí•© ì´ˆê¸°í™” ì‹œì‘');

            try {
                // ê¸°ë³¸ ì´ˆê¸°í™” ì‹¤í–‰ (ModuleLoader ë¡œë“œ í¬í•¨)
                await initializePage();

                // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
                setupNavigation();

                console.log('âœ… [Admin Dashboard] í†µí•© ì´ˆê¸°í™” ì™„ë£Œ');

            } catch (error) {
                console.error('âŒ [Admin Dashboard] í†µí•© ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showInitializationError(error);
            }
        });
    </script>
</body>
</html>