<!-- 간단한 식단관리 페이지 (디버깅용) -->
<div style="padding: 0; margin: 0; background: #f5f5f5; min-height: calc(100vh - 130px);">
    <!-- BOKSILI 스타일 헤더 -->
    <div style="background: white; padding: 20px; margin: 0; border-bottom: 1px solid #e0e0e0;">
        <h1 style="font-size: 24px; color: #333; margin: 0; font-weight: normal;">메뉴관리 시스템</h1>
    </div>

    <!-- 관리자/사업장 선택 영역 -->
    <div style="background: white; padding: 15px 20px; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; gap: 15px;">
        <div style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-user-cog" style="color: #F5881F; font-size: 16px;"></i>
            <span style="font-size: 14px; color: #666;">관리자</span>
        </div>
        
        <div style="margin-left: auto;">
            <select style="background: white; border: 2px solid #F5881F; color: #333; padding: 8px 15px; border-radius: 6px; font-size: 14px; min-width: 150px; cursor: pointer;" id="businessLocationSelect">
                <option value="all">전체 사업장</option>
                <option value="main">본사 (다함푸드)</option>
                <option value="school1">다함초등학교</option>
                <option value="school2">다함중학교</option>
                <option value="school3">다함고등학교</option>
            </select>
        </div>
    </div>

    <!-- 메인 컨텐츠 영역 -->
    <div style="padding: 20px;">
        <!-- 식단 작성 도구 -->
        <div style="display: grid; grid-template-columns: 280px 1fr; gap: 20px; height: calc(100vh - 220px);">
            
            <!-- 좌측 메뉴 선택 패널 -->
            <div style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden;">
                <div style="background: #F5881F; color: white; padding: 15px; font-weight: bold; font-size: 16px;">
                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                    메뉴 선택
                </div>
                
                <!-- 검색 영역 -->
                <div style="padding: 15px; border-bottom: 1px solid #f0f0f0;">
                    <div style="position: relative;">
                        <input type="text" id="menuSearchInput" placeholder="메뉴명을 입력하세요..." 
                               style="width: 100%; padding: 10px 35px 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        <button onclick="searchMenus()" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #F5881F; cursor: pointer; padding: 5px;">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 메뉴 목록 -->
                <div style="max-height: calc(100vh - 400px); overflow-y: auto; padding: 10px;">
                    <div id="menuResults">
                        <div style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
                            <i class="fas fa-spinner fa-spin" style="color: #F5881F;"></i><br>
                            레시피 데이터 로딩 중...<br>
                            <small>(9447개 레시피)</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 우측 식단표 작성 영역 -->
            <div style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 20px;">
                
                <!-- 식단표 헤더 -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                    <div>
                        <h3 style="margin: 0; color: #333; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-clipboard-list" style="color: #F5881F;"></i>
                            식단표 구성
                            <span style="font-size: 14px; color: #666; font-weight: normal;" id="currentDateDisplay">(2025-08-29)</span>
                        </h3>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="saveMealPlan()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-save"></i> 저장
                        </button>
                        <button onclick="clearMealPlan()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-eraser"></i> 지우기
                        </button>
                    </div>
                </div>

                <!-- 간단한 식단 구성 영역 -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- 조식 -->
                    <div style="border: 2px dashed #28a745; border-radius: 8px; padding: 15px; background: rgba(40, 167, 69, 0.05);">
                        <h4 style="color: #28a745; margin-bottom: 12px; font-size: 14px; text-align: center; border-bottom: 1px solid #28a745; padding-bottom: 5px;">
                            <i class="fas fa-sun"></i> 조식
                        </h4>
                        <div id="breakfast-menu" style="min-height: 200px;">
                            <div class="menu-slot" onclick="selectSlot('breakfast', this)" style="border: 1px dashed #ccc; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; color: #999; font-size: 12px; text-align: center;">클릭하여 메뉴 선택</div>
                            <div class="menu-slot" onclick="selectSlot('breakfast', this)" style="border: 1px dashed #ccc; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; color: #999; font-size: 12px; text-align: center;">클릭하여 메뉴 선택</div>
                        </div>
                    </div>

                    <!-- 중식 -->
                    <div style="border: 2px dashed #F5881F; border-radius: 8px; padding: 15px; background: rgba(245, 136, 31, 0.05);">
                        <h4 style="color: #F5881F; margin-bottom: 12px; font-size: 14px; text-align: center; border-bottom: 1px solid #F5881F; padding-bottom: 5px;">
                            <i class="fas fa-sun"></i> 중식
                        </h4>
                        <div id="lunch-menu" style="min-height: 200px;">
                            <div class="menu-slot" onclick="selectSlot('lunch', this)" style="border: 1px dashed #ccc; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; color: #999; font-size: 12px; text-align: center;">클릭하여 메뉴 선택</div>
                            <div class="menu-slot" onclick="selectSlot('lunch', this)" style="border: 1px dashed #ccc; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; color: #999; font-size: 12px; text-align: center;">클릭하여 메뉴 선택</div>
                        </div>
                    </div>

                    <!-- 석식 -->
                    <div style="border: 2px dashed #6f42c1; border-radius: 8px; padding: 15px; background: rgba(111, 66, 193, 0.05);">
                        <h4 style="color: #6f42c1; margin-bottom: 12px; font-size: 14px; text-align: center; border-bottom: 1px solid #6f42c1; padding-bottom: 5px;">
                            <i class="fas fa-moon"></i> 석식
                        </h4>
                        <div id="dinner-menu" style="min-height: 200px;">
                            <div class="menu-slot" onclick="selectSlot('dinner', this)" style="border: 1px dashed #ccc; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; color: #999; font-size: 12px; text-align: center;">클릭하여 메뉴 선택</div>
                            <div class="menu-slot" onclick="selectSlot('dinner', this)" style="border: 1px dashed #ccc; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; color: #999; font-size: 12px; text-align: center;">클릭하여 메뉴 선택</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.menu-item:hover {
    background: #fff8f0 !important;
    border-color: #F5881F !important;
}

.menu-slot:hover {
    background: #f8f9fa !important;
    border-color: #F5881F !important;
}

.menu-slot.selected {
    background: #fff8f0 !important;
    border-color: #F5881F !important;
    border-style: solid !important;
}

/* 반응형 */
@media (max-width: 768px) {
    [style*="grid-template-columns: 280px 1fr"] {
        grid-template-columns: 1fr !important;
        gap: 15px !important;
    }
    
    [style*="grid-template-columns: 1fr 1fr 1fr"] {
        grid-template-columns: 1fr !important;
        gap: 10px !important;
    }
}
</style>

<script>
// 간단한 식단관리 JavaScript (에러 없이 작동)
console.log('간단한 식단관리 페이지 로드됨');

let selectedSlot = null;
let recipesData = [];

// 페이지 초기화 (간단하게)
function mealPlanInit() {
    console.log('식단관리 페이지 초기화됨');
    updateCurrentDate();
    loadRecipesData();
}

// 레시피 데이터 로드
async function loadRecipesData() {
    try {
        console.log('레시피 데이터 로딩 시작...');
        const response = await fetch('/recipes-data');
        recipesData = await response.json();
        
        console.log(`레시피 데이터 로드 완료: ${recipesData.length}개`);
        displayRecipes(recipesData.slice(0, 20)); // 처음 20개만 표시
        
    } catch (error) {
        console.error('레시피 데이터 로드 오류:', error);
        document.getElementById('menuResults').innerHTML = `
            <div style="text-align: center; padding: 20px; color: #dc3545; font-size: 12px;">
                <i class="fas fa-exclamation-triangle"></i><br>
                레시피 데이터 로딩 실패<br>
                <button onclick="loadRecipesData()" style="margin-top: 10px; padding: 5px 10px; background: #F5881F; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                    다시 시도
                </button>
            </div>
        `;
    }
}

// 레시피 목록 표시
function displayRecipes(recipes) {
    const menuResults = document.getElementById('menuResults');
    if (!recipes || recipes.length === 0) {
        menuResults.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">검색 결과가 없습니다.</div>';
        return;
    }
    
    let html = '';
    recipes.forEach(recipe => {
        const categoryColor = getCategoryColor(recipe.ctg_name);
        html += `
            <div class="menu-item" onclick="selectMenu('${recipe.ri_seq}', '${recipe.ri_name}')" 
                 style="background: white; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: pointer; font-size: 13px; display: flex; justify-content: space-between; align-items: center;">
                <div style="flex: 1;">
                    <div style="font-weight: bold; margin-bottom: 2px;">${recipe.ri_name}</div>
                    <div style="font-size: 11px; color: ${categoryColor}; margin-bottom: 1px;">
                        <i class="fas fa-tag" style="margin-right: 3px;"></i>${recipe.ctg_name}
                    </div>
                    <div style="font-size: 10px; color: #999;">
                        담당: ${recipe.mb_name || '미지정'}
                    </div>
                </div>
                <i class="fas fa-plus" style="color: #F5881F;"></i>
            </div>
        `;
    });
    
    menuResults.innerHTML = html;
}

// 카테고리별 색상
function getCategoryColor(category) {
    const colors = {
        '국': '#28a745',
        '찌개': '#dc3545',
        '반찬': '#F5881F',
        '밥': '#6f42c1',
        '면': '#17a2b8',
        '디저트': '#e83e8c',
        '샐러드': '#20c997'
    };
    return colors[category] || '#666';
}

// 현재 날짜 업데이트 (안전하게)
function updateCurrentDate() {
    try {
        const currentDateDisplay = document.getElementById('currentDateDisplay');
        if (currentDateDisplay) {
            const today = new Date();
            today.setDate(today.getDate() + 1); // 내일 날짜
            const dateStr = today.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).replace(/\. /g, '-').replace('.', '');
            
            currentDateDisplay.textContent = `(${dateStr})`;
        }
    } catch (error) {
        console.error('날짜 업데이트 오류:', error);
    }
}

// 메뉴 슬롯 선택
function selectSlot(mealType, element) {
    // 이전 선택 해제
    document.querySelectorAll('.menu-slot').forEach(slot => {
        slot.classList.remove('selected');
    });
    
    // 현재 슬롯 선택
    element.classList.add('selected');
    selectedSlot = element;
    
    console.log('슬롯 선택됨:', mealType);
}

// 메뉴 선택
function selectMenu(menuId, menuName) {
    if (!selectedSlot) {
        alert('먼저 식단표에서 슬롯을 선택해주세요.');
        return;
    }
    
    selectedSlot.innerHTML = `<strong>${menuName}</strong>`;
    selectedSlot.style.color = '#333';
    
    console.log('메뉴 선택됨:', menuName);
    
    // 선택 해제
    selectedSlot.classList.remove('selected');
    selectedSlot = null;
}

// 메뉴 검색
function searchMenus() {
    const keyword = document.getElementById('menuSearchInput').value.trim();
    console.log('메뉴 검색:', keyword);
    
    if (!keyword) {
        // 키워드가 없으면 처음 20개 표시
        displayRecipes(recipesData.slice(0, 20));
        return;
    }
    
    // 레시피 이름으로 검색
    const searchResults = recipesData.filter(recipe => 
        recipe.ri_name.toLowerCase().includes(keyword.toLowerCase()) ||
        recipe.ctg_name.toLowerCase().includes(keyword.toLowerCase())
    );
    
    console.log(`검색 결과: ${searchResults.length}개`);
    displayRecipes(searchResults.slice(0, 50)); // 최대 50개까지 표시
}

// 식단표 저장
function saveMealPlan() {
    alert('식단표 저장 기능은 곧 구현됩니다.');
}

// 식단표 초기화
function clearMealPlan() {
    if (confirm('모든 메뉴를 지우시겠습니까?')) {
        document.querySelectorAll('.menu-slot').forEach(slot => {
            slot.innerHTML = '클릭하여 메뉴 선택';
            slot.style.color = '#999';
            slot.classList.remove('selected');
        });
        
        selectedSlot = null;
        alert('식단표가 초기화되었습니다.');
    }
}

// 엔터키로 검색
document.addEventListener('keypress', function(e) {
    if (e.target.id === 'menuSearchInput' && e.key === 'Enter') {
        searchMenus();
    }
});

// 페이지 로드 완료
console.log('식단관리 스크립트 로드 완료');
</script>